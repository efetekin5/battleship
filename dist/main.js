(()=>{"use strict";const e=(e,t)=>{const o=document.createElement("div");o.classList.add("cell"),"p"===t?(o.id=`${t}${e}`,document.querySelector(".playerBoard").appendChild(o)):"ai"===t&&(o.id=`${t}${e}`,document.querySelector(".aiBoard").appendChild(o))},t=(e,t,o)=>{if(o)for(let o=0;o<100;o+=1)!1!==e[o].storedShip&&!0===e[o].beenHit?document.getElementById(`${t}${o}`).style.backgroundColor="rgb(133, 255, 179)":!1===e[o].storedShip&&!0===e[o].beenHit?document.getElementById(`${t}${o}`).style.backgroundColor="rgb(255, 133, 133)":document.getElementById(`${t}${o}`).style.backgroundColor="white";else for(let o=0;o<100;o+=1)!1!==e[o].storedShip&&!1===e[o].beenHit?document.getElementById(`${t}${o}`).style.backgroundColor="rgb(68, 68, 68)":!1!==e[o].storedShip&&!0===e[o].beenHit?document.getElementById(`${t}${o}`).style.backgroundColor="rgb(133, 255, 179)":!1===e[o].storedShip&&!0===e[o].beenHit?document.getElementById(`${t}${o}`).style.backgroundColor="rgb(255, 133, 133)":document.getElementById(`${t}${o}`).style.backgroundColor="white"},o=(e,t)=>({length:e,hitCount:0,sunk:!1,isVertical:t}),r=(e,t)=>{const r=[...e];if(1===Math.floor(2*Math.random())+1){let e,n;do{e=Math.floor(Math.random()*(10-t+1)),n=10*Math.floor(10*Math.random())}while(r.slice(n+e,n+e+t).some((e=>e.storedShip)));const l=o(t,!1);for(let o=0;o<t;o+=1)r[n+e+o].storedShip=l}else{let e,n,l;do{e=Math.floor(10*Math.random()),n=10*Math.floor(Math.random()*(10-t+1));const o=[];for(let l=n+e;l<e+n+10*t;l+=10)o.push(r[l]);l=o.some((e=>e.storedShip))}while(l);const d=o(t,!0);for(let o=0;o<10*t;o+=10)r[n+e+o].storedShip=d}return r},n=()=>{let o=[];return{board:o,createBoard:t=>{for(let r=0;r<100;r+=1)o[r]={storedShip:!1,beenHit:!1},e(r,t)},placeShip:(e,t)=>{if(e.isVertical)for(let r=t;r<t+10*e.length;r+=10)o[r].storedShip=e;else for(let r=t;r<t+e.length;r+=1)o[r].storedShip=e},receiveAttack:(e,r,n)=>{if(!1!==o[e].storedShip){o[e].beenHit=!0;let l=o[e].storedShip.hitCount;l+=1,o[e].storedShip.hitCount=l,o[e].storedShip.hitCount===o[e].storedShip.length&&(o[e].storedShip.sunk=!0),t(o,r,n)}else o[e].beenHit=!0,t(o,r,n)},allShipsSunk:()=>{for(let e=0;e<100;e+=1)if(!1!==o[e].storedShip&&!1===o[e].beenHit)return!1;return!0},randomShips:(e,n)=>{let l=[...o];for(let e=0;e<100;e+=1)l[e].storedShip=!1;l=r(o,5),l=r(o,4),l=r(o,3),l=r(o,3),l=r(o,2),t(l,e,n),o=l},resetBoard:()=>{for(let e=0;e<100;e+=1)o[e].storedShip=!1,o[e].beenHit=!1}}},l=(e,t)=>({name:e,oppBoard:t,attack:(e,o,r)=>{t.receiveAttack(e,o,r)},aiAttack:()=>{let e;do{e=Math.floor(99*Math.random())}while(t.board[e].beenHit);t.receiveAttack(e,"p",!1)}}),d=(e,o,r)=>{document.querySelector(".winnerText").textContent=r?"You Won Do You Want To Play Again?":"Ai Won Do You Want To Play Again";const n=document.querySelector(".winBackground");n.style.display="flex",document.querySelector(".restartButton").addEventListener("click",(()=>{e.resetBoard(),t(e.board,"p",!1),o.resetBoard(),t(o.board,"ai",!0),document.querySelector(".buttons").style.display="flex",document.querySelector(".startButton").style.display="flex";const r=document.querySelector(".manual");r.style.display="flex",r.style.removeProperty("margin-left");const l=document.querySelector(".random");l.style.display="flex",l.style.removeProperty("margin-left");const d=document.querySelector(".axisButton");null!==d&&(d.style.display="none"),n.style.display="none"}))},i=(e,t,o,r)=>{const n=document.querySelector(".axisButton"),l=Number(e.target.id.slice(1)),d=l%10,i=Math.floor(l/10);if("none"!==document.querySelector(".startButton").style.display)if(o){if("Horizontal"===n.textContent){const e=d-t;if(e>0)for(let o=0;o<t-e;o+=1){const e=document.querySelector(`#p${l+o}`);!1===r[l+o].storedShip&&(e.style.backgroundColor="white")}else for(let e=0;e<t;e+=1){const t=document.querySelector(`#p${l+e}`);!1===r[l+e].storedShip&&(t.style.backgroundColor="white")}}else if("Vertical"===n.textContent){const e=i-t;if(e>0)for(let o=0;o<10*t-10*e;o+=10){const e=document.querySelector(`#p${l+o}`);!1===r[l+o].storedShip&&(e.style.backgroundColor="white")}else for(let e=0;e<10*t;e+=10){const t=document.querySelector(`#p${l+e}`);!1===r[l+e].storedShip&&(t.style.backgroundColor="white")}}}else if("Horizontal"===n.textContent){const e=9-d+1;if(d>9-t+1){for(let e=0;e<t;e+=1)if(!1!==r[l+e].storedShip)return;for(let t=0;t<e;t+=1)document.querySelector(`#p${l+t}`).style.background="rgb(185, 74, 74)"}else for(let e=0;e<t;e+=1){const t=document.querySelector(`#p${l+e}`);!1===r[l+e].storedShip&&(t.style.background="lime")}}else if("Vertical"===n.textContent){const e=9-i+1;if(i>9-t+1)for(let t=0;t<10*e;t+=10){const e=document.querySelector(`#p${l+t}`);!1===r[l+t].storedShip&&(e.style.background="rgb(185, 74, 74)")}else for(let e=0;e<10*t;e+=10){const t=document.querySelector(`#p${l+e}`);!1===r[l+e].storedShip&&(t.style.background="lime")}}},c=n();c.createBoard("p");const a=n();a.createBoard("ai");const s=l("player",a),u=l("ai",c),y=document.querySelector(".random"),p=document.querySelector(".manual");y.addEventListener("click",(()=>{p.style.display="none",y.style.marginLeft="115px",c.randomShips("p",!1)}));const h=e=>{const t=Number(e.target.id.slice(2));!1===a.board[t].beenHit&&(s.attack(t,"ai",!0),a.allShipsSunk()&&(d(c,a,!0),document.querySelectorAll('div.cell[id^="ai"]').forEach((e=>{e.removeEventListener("click",h)}))),u.aiAttack(),c.allShipsSunk()&&(d(c,a,!1),document.querySelectorAll('div.cell[id^="ai"]').forEach((e=>{e.removeEventListener("click",h)}))))},m=document.querySelector(".startButton");m.addEventListener("click",(()=>{let e=0;for(let t=0;t<100;t+=1)!1!==c.board[t].storedShip&&(e+=1);17===e&&(document.querySelector(".buttons").style.display="none",m.style.display="none",a.randomShips("ai",!0),document.querySelectorAll('div.cell[id^="ai"]').forEach((e=>{e.addEventListener("click",h)})))})),p.addEventListener("click",(()=>{if(y.style.display="none",null===document.querySelector(".axisButton")){(()=>{const e=document.createElement("button");e.classList.add("axisButton"),e.textContent="Horizontal",e.addEventListener("click",(()=>{"Vertical"===e.textContent?e.textContent="Horizontal":e.textContent="Vertical"})),document.querySelector(".buttons").appendChild(e)})();const e=document.querySelectorAll('div.cell[id^="p"]');e.forEach((e=>{e.addEventListener("mouseenter",(e=>{let t=0;for(let e=0;e<100;e+=1)!1!==c.board[e].storedShip&&(t+=1);0===t?i(e,5,!1,c.board):5===t?i(e,4,!1,c.board):9===t||12===t?i(e,3,!1,c.board):15===t&&i(e,2,!1,c.board)}))})),e.forEach((e=>{e.addEventListener("mouseleave",(e=>{i(e,5,!0,c.board)}))})),e.forEach((e=>{e.addEventListener("click",(e=>{let r,n;n="Vertical"===document.querySelector(".axisButton").textContent;let l=0;for(let e=0;e<100;e+=1)!1!==c.board[e].storedShip&&(l+=1);0===l?r=o(5,n):5===l?r=o(4,n):9===l||12===l?r=o(3,n):15===l&&(r=o(2,n));const d=Number(e.target.id.slice(1));if(r.isVertical){for(let e=0;e<10*r.length;e+=10)if(!1!==c.board[d+e].storedShip)return}else for(let e=0;e<r.length;e+=1)if(!1!==c.board[d+e].storedShip)return;"rgb(185, 74, 74)"!==document.querySelector(`#p${d}`).style.background&&(c.placeShip(r,d),t(c.board,"p",!1))}))}))}}))})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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YyxLQUFkQSxFQUROakQsRUFBVSxFQUFXLEVBQUdaLEdBR0osS0FBZDZELElBQ05qRCxFQUFVLEVBQVcsRUFBR1osSUFHNUIsTUFBTTRDLEVBQVNDLE9BQU9ILEVBQU1JLE9BQU9qRSxHQUFHNkIsTUFBTSxJQUM1QyxHQUFHRSxFQUFRWixZQUNQLElBQUksSUFBSVAsRUFBSSxFQUFHQSxFQUFxQixHQUFqQm1CLEVBQVFiLE9BQWFOLEdBQUssR0FDekMsSUFBMkMsSUFBeENzQyxFQUFPekMsTUFBTXNELEVBQVNuRCxHQUFHQyxXQUN4QixZQUlSLElBQUksSUFBSUQsRUFBSSxFQUFHQSxFQUFJbUIsRUFBUWIsT0FBUU4sR0FBSyxFQUNwQyxJQUEyQyxJQUF4Q3NDLEVBQU96QyxNQUFNc0QsRUFBU25ELEdBQUdDLFdBQ3hCLE9BTXdCLHFCQURoQlYsU0FBU0ksY0FBYyxLQUFLd0QsS0FDakMvQyxNQUFNc0QsYUFDakJwQixFQUFPZCxVQUFVTCxFQUFTZ0MsR0FDMUIsRUFBWWIsRUFBT3pDLE1BQU8sS0FBSyxHQUNuQyxHQUNILEdBRVQsSSIsInNvdXJjZXMiOlsid2VicGFjazovL2JhdHRsZXNoaXAvLi9zcmMvZGlzcGxheUJvYXJkLmpzIiwid2VicGFjazovL2JhdHRsZXNoaXAvLi9zcmMvdXBkYXRlQm9hcmQuanMiLCJ3ZWJwYWNrOi8vYmF0dGxlc2hpcC8uL3NyYy9jcmVhdGVTaGlwLmpzIiwid2VicGFjazovL2JhdHRsZXNoaXAvLi9zcmMvY3JlYXRlUmFuZG9tU2hpcHMuanMiLCJ3ZWJwYWNrOi8vYmF0dGxlc2hpcC8uL3NyYy9nYW1lQm9hcmQuanMiLCJ3ZWJwYWNrOi8vYmF0dGxlc2hpcC8uL3NyYy9jcmVhdGVQbGF5ZXIuanMiLCJ3ZWJwYWNrOi8vYmF0dGxlc2hpcC8uL3NyYy9lbmRHYW1lLmpzIiwid2VicGFjazovL2JhdHRsZXNoaXAvLi9zcmMvZGlzcGxheU1hbnVhbFNoaXBzLmpzIiwid2VicGFjazovL2JhdHRsZXNoaXAvLi9zcmMvaW5kZXguanMiLCJ3ZWJwYWNrOi8vYmF0dGxlc2hpcC8uL3NyYy9hZGRBeGlzQnV0dG9uLmpzIl0sInNvdXJjZXNDb250ZW50IjpbImNvbnN0IGRpc3BsYXlCb2FyZCA9IChpZCwgcGxheWVyKSA9PiB7XG4gICAgY29uc3QgY2VsbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgIGNlbGwuY2xhc3NMaXN0LmFkZCgnY2VsbCcpO1xuXG4gICAgaWYocGxheWVyID09PSAncCcpIHtcbiAgICAgICAgY2VsbC5pZCA9IGAke3BsYXllcn0ke2lkfWA7XG5cbiAgICAgICAgY29uc3QgcGxheWVyQm9hcmQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcucGxheWVyQm9hcmQnKTtcbiAgICAgICAgcGxheWVyQm9hcmQuYXBwZW5kQ2hpbGQoY2VsbCk7XG4gICAgfSBlbHNlIGlmKHBsYXllciA9PT0gJ2FpJykge1xuICAgICAgICBjZWxsLmlkID0gYCR7cGxheWVyfSR7aWR9YDtcblxuICAgICAgICBjb25zdCBhaUJvYXJkID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmFpQm9hcmQnKTtcbiAgICAgICAgYWlCb2FyZC5hcHBlbmRDaGlsZChjZWxsKTtcbiAgICB9XG59XG5cbmV4cG9ydCBkZWZhdWx0IGRpc3BsYXlCb2FyZDsiLCJjb25zdCB1cGRhdGVCb2FyZCA9IChib2FyZCwgYm9hcmRJZCwgaXNBaUJvYXJkKSA9PiB7XG4gIGlmIChpc0FpQm9hcmQpIHtcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IDEwMDsgaSArPSAxKSB7XG4gICAgICBpZiAoYm9hcmRbaV0uc3RvcmVkU2hpcCAhPT0gZmFsc2UgJiYgYm9hcmRbaV0uYmVlbkhpdCA9PT0gdHJ1ZSkge1xuICAgICAgICBjb25zdCBjZWxsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoYCR7Ym9hcmRJZH0ke2l9YCk7XG4gICAgICAgIGNlbGwuc3R5bGUuYmFja2dyb3VuZENvbG9yID0gXCJyZ2IoMTMzLCAyNTUsIDE3OSlcIjtcbiAgICAgIH0gZWxzZSBpZiAoYm9hcmRbaV0uc3RvcmVkU2hpcCA9PT0gZmFsc2UgJiYgYm9hcmRbaV0uYmVlbkhpdCA9PT0gdHJ1ZSkge1xuICAgICAgICBjb25zdCBjZWxsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoYCR7Ym9hcmRJZH0ke2l9YCk7XG4gICAgICAgIGNlbGwuc3R5bGUuYmFja2dyb3VuZENvbG9yID0gXCJyZ2IoMjU1LCAxMzMsIDEzMylcIjtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGNvbnN0IGNlbGwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChgJHtib2FyZElkfSR7aX1gKTtcbiAgICAgICAgY2VsbC5zdHlsZS5iYWNrZ3JvdW5kQ29sb3IgPSBcIndoaXRlXCI7XG4gICAgICB9XG4gICAgfVxuICB9IGVsc2Uge1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgMTAwOyBpICs9IDEpIHtcbiAgICAgIGlmIChib2FyZFtpXS5zdG9yZWRTaGlwICE9PSBmYWxzZSAmJiBib2FyZFtpXS5iZWVuSGl0ID09PSBmYWxzZSkge1xuICAgICAgICBjb25zdCBjZWxsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoYCR7Ym9hcmRJZH0ke2l9YCk7XG4gICAgICAgIGNlbGwuc3R5bGUuYmFja2dyb3VuZENvbG9yID0gXCJyZ2IoNjgsIDY4LCA2OClcIjtcbiAgICAgIH0gZWxzZSBpZiAoYm9hcmRbaV0uc3RvcmVkU2hpcCAhPT0gZmFsc2UgJiYgYm9hcmRbaV0uYmVlbkhpdCA9PT0gdHJ1ZSkge1xuICAgICAgICBjb25zdCBjZWxsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoYCR7Ym9hcmRJZH0ke2l9YCk7XG4gICAgICAgIGNlbGwuc3R5bGUuYmFja2dyb3VuZENvbG9yID0gXCJyZ2IoMTMzLCAyNTUsIDE3OSlcIjtcbiAgICAgIH0gZWxzZSBpZiAoYm9hcmRbaV0uc3RvcmVkU2hpcCA9PT0gZmFsc2UgJiYgYm9hcmRbaV0uYmVlbkhpdCA9PT0gdHJ1ZSkge1xuICAgICAgICBjb25zdCBjZWxsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoYCR7Ym9hcmRJZH0ke2l9YCk7XG4gICAgICAgIGNlbGwuc3R5bGUuYmFja2dyb3VuZENvbG9yID0gXCJyZ2IoMjU1LCAxMzMsIDEzMylcIjtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGNvbnN0IGNlbGwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChgJHtib2FyZElkfSR7aX1gKTtcbiAgICAgICAgY2VsbC5zdHlsZS5iYWNrZ3JvdW5kQ29sb3IgPSBcIndoaXRlXCI7XG4gICAgICB9XG4gICAgfVxuICB9XG59O1xuXG5leHBvcnQgZGVmYXVsdCB1cGRhdGVCb2FyZDtcbiIsImNvbnN0IGNyZWF0ZVNoaXAgPSAobGVuZ3RoLCBpc1ZlcnRpY2FsKSA9PiB7XG4gIGNvbnN0IGhpdENvdW50ID0gMDtcbiAgY29uc3Qgc3VuayA9IGZhbHNlO1xuXG4gIHJldHVybiB7IGxlbmd0aCwgaGl0Q291bnQsIHN1bmssIGlzVmVydGljYWwgfTtcbn07XG5cbmV4cG9ydCBkZWZhdWx0IGNyZWF0ZVNoaXA7IiwiaW1wb3J0IGNyZWF0ZVNoaXAgZnJvbSBcIi4vY3JlYXRlU2hpcFwiO1xuXG5jb25zdCBjcmVhdGVSYW5kb21TaGlwcyA9IChib2FyZCwgc2hpcExlbmd0aCkgPT4ge1xuICAgIGNvbnN0IGF4aXNEZWNpZGVyID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogMikgKyAxO1xuICAgIGNvbnN0IGJvYXJkQ29weSA9IFsuLi5ib2FyZF07XG5cbiAgICBpZihheGlzRGVjaWRlciA9PT0gMSkge1xuICAgICAgICBsZXQgc3RhcnRpbmdDb2x1bW47XG4gICAgICAgIGxldCBzdGFydGluZ1JvdztcblxuICAgICAgICBkbyB7XG4gICAgICAgICAgICBzdGFydGluZ0NvbHVtbiA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqICgoMTAgLSBzaGlwTGVuZ3RoKSArIDEpKTtcbiAgICAgICAgICAgIHN0YXJ0aW5nUm93ID0gKE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDEwKSkgKiAxMDtcbiAgICAgICAgfSB3aGlsZSAoXG4gICAgICAgICAgICBib2FyZENvcHkuc2xpY2Uoc3RhcnRpbmdSb3cgKyBzdGFydGluZ0NvbHVtbiwgc3RhcnRpbmdSb3cgKyBzdGFydGluZ0NvbHVtbiArIHNoaXBMZW5ndGgpXG4gICAgICAgICAgICAuc29tZShjZWxsID0+IGNlbGwuc3RvcmVkU2hpcClcbiAgICAgICAgKVxuXG4gICAgICAgIGNvbnN0IG5ld1NoaXAgPSBjcmVhdGVTaGlwKHNoaXBMZW5ndGgsIGZhbHNlKTtcbiAgICAgICAgZm9yKGxldCBpID0gMDsgaSA8IHNoaXBMZW5ndGg7IGkgKz0gMSkge1xuICAgICAgICAgICAgYm9hcmRDb3B5W3N0YXJ0aW5nUm93ICsgc3RhcnRpbmdDb2x1bW4gKyBpXS5zdG9yZWRTaGlwID0gbmV3U2hpcDtcbiAgICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICAgIGxldCBzdGFydGluZ0NvbHVtbjtcbiAgICAgICAgbGV0IHN0YXJ0aW5nUm93O1xuICAgICAgICBsZXQgaGFzU3RvcmVkU2hpcFxuXG4gICAgICAgIGRvIHtcbiAgICAgICAgICAgIHN0YXJ0aW5nQ29sdW1uID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogMTApO1xuICAgICAgICAgICAgc3RhcnRpbmdSb3cgPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAoKDEwIC0gc2hpcExlbmd0aCkgKyAxKSkgKiAxMDtcbiAgICAgICAgXG4gICAgICAgICAgICBjb25zdCBzbGljZWRBcnJheSA9IFtdO1xuICAgICAgICAgICAgZm9yIChsZXQgaSA9IHN0YXJ0aW5nUm93ICsgc3RhcnRpbmdDb2x1bW47IGkgPCBzdGFydGluZ0NvbHVtbiArIHN0YXJ0aW5nUm93ICsgKHNoaXBMZW5ndGggKiAxMCk7IGkgKz0gMTApIHtcbiAgICAgICAgICAgICAgICBzbGljZWRBcnJheS5wdXNoKGJvYXJkQ29weVtpXSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICAgICAgaGFzU3RvcmVkU2hpcCA9IHNsaWNlZEFycmF5LnNvbWUoY2VsbCA9PiBjZWxsLnN0b3JlZFNoaXApO1xuICAgICAgICB9IHdoaWxlIChoYXNTdG9yZWRTaGlwKTtcblxuICAgICAgICBjb25zdCBuZXdTaGlwID0gY3JlYXRlU2hpcChzaGlwTGVuZ3RoLCB0cnVlKTtcbiAgICAgICAgZm9yKGxldCBpID0gMDsgaSA8IHNoaXBMZW5ndGggKiAxMDsgaSArPSAxMCkge1xuICAgICAgICAgICAgYm9hcmRDb3B5W3N0YXJ0aW5nUm93ICsgc3RhcnRpbmdDb2x1bW4gKyBpXS5zdG9yZWRTaGlwID0gbmV3U2hpcDtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiBib2FyZENvcHk7XG59XG5cbmV4cG9ydCBkZWZhdWx0IGNyZWF0ZVJhbmRvbVNoaXBzOyIsImltcG9ydCBkaXNwbGF5Qm9hcmQgZnJvbSBcIi4vZGlzcGxheUJvYXJkXCI7XG5pbXBvcnQgdXBkYXRlQm9hcmQgZnJvbSBcIi4vdXBkYXRlQm9hcmRcIjtcbmltcG9ydCBjcmVhdGVSYW5kb21TaGlwcyBmcm9tIFwiLi9jcmVhdGVSYW5kb21TaGlwc1wiO1xuXG5jb25zdCBnYW1lQm9hcmQgPSAoKSA9PiB7XG4gIGxldCBib2FyZCA9IFtdO1xuXG4gIGNvbnN0IGNyZWF0ZUJvYXJkID0gKHBsYXllcikgPT4ge1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgMTAwOyBpICs9IDEpIHtcbiAgICAgIGJvYXJkW2ldID0geyBzdG9yZWRTaGlwOiBmYWxzZSwgYmVlbkhpdDogZmFsc2UgfTtcbiAgICAgIGRpc3BsYXlCb2FyZChpLCBwbGF5ZXIpO1xuICAgIH1cbiAgfTtcblxuICBjb25zdCBwbGFjZVNoaXAgPSAoc2hpcCwgc3RhcnQpID0+IHtcbiAgICBpZiAoc2hpcC5pc1ZlcnRpY2FsKSB7XG4gICAgICBmb3IgKGxldCBpID0gc3RhcnQ7IGkgPCBzdGFydCArIHNoaXAubGVuZ3RoICogMTA7IGkgKz0gMTApIHtcbiAgICAgICAgYm9hcmRbaV0uc3RvcmVkU2hpcCA9IHNoaXA7XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIGZvciAobGV0IGkgPSBzdGFydDsgaSA8IHN0YXJ0ICsgc2hpcC5sZW5ndGg7IGkgKz0gMSkge1xuICAgICAgICBib2FyZFtpXS5zdG9yZWRTaGlwID0gc2hpcDtcbiAgICAgIH1cbiAgICB9XG4gIH07XG5cbiAgY29uc3QgcmFuZG9tU2hpcHMgPSAoYm9hcmRJZCwgaXNBaUJvYXJkKSA9PiB7XG4gICAgbGV0IGJvYXJkQ29weSA9IFsuLi5ib2FyZF07XG5cbiAgICBmb3IobGV0IGkgPSAwOyBpIDwgMTAwOyBpICs9IDEpIHtcbiAgICAgIGJvYXJkQ29weVtpXS5zdG9yZWRTaGlwID0gZmFsc2U7XG4gICAgfVxuXG4gICAgYm9hcmRDb3B5ID0gY3JlYXRlUmFuZG9tU2hpcHMoYm9hcmQsIDUpO1xuICAgIGJvYXJkQ29weSA9IGNyZWF0ZVJhbmRvbVNoaXBzKGJvYXJkLCA0KTtcbiAgICBib2FyZENvcHkgPSBjcmVhdGVSYW5kb21TaGlwcyhib2FyZCwgMyk7XG4gICAgYm9hcmRDb3B5ID0gY3JlYXRlUmFuZG9tU2hpcHMoYm9hcmQsIDMpO1xuICAgIGJvYXJkQ29weSA9IGNyZWF0ZVJhbmRvbVNoaXBzKGJvYXJkLCAyKTtcblxuICAgIHVwZGF0ZUJvYXJkKGJvYXJkQ29weSwgYm9hcmRJZCwgaXNBaUJvYXJkKTtcbiAgICBib2FyZCA9IGJvYXJkQ29weTtcbiAgfVxuXG4gIGNvbnN0IHJlY2VpdmVBdHRhY2sgPSAoY29yZGluYXRlcywgYm9hcmRJZCwgaXNBaUJvYXJkKSA9PiB7XG4gICAgaWYgKGJvYXJkW2NvcmRpbmF0ZXNdLnN0b3JlZFNoaXAgIT09IGZhbHNlKSB7XG4gICAgICBib2FyZFtjb3JkaW5hdGVzXS5iZWVuSGl0ID0gdHJ1ZTtcblxuICAgICAgbGV0IG5ld0hpdENvdW50ID0gYm9hcmRbY29yZGluYXRlc10uc3RvcmVkU2hpcC5oaXRDb3VudDtcbiAgICAgIG5ld0hpdENvdW50ICs9IDE7XG4gICAgICBib2FyZFtjb3JkaW5hdGVzXS5zdG9yZWRTaGlwLmhpdENvdW50ID0gbmV3SGl0Q291bnQ7XG4gICAgICBpZihib2FyZFtjb3JkaW5hdGVzXS5zdG9yZWRTaGlwLmhpdENvdW50ID09PSBib2FyZFtjb3JkaW5hdGVzXS5zdG9yZWRTaGlwLmxlbmd0aCkge1xuICAgICAgICBib2FyZFtjb3JkaW5hdGVzXS5zdG9yZWRTaGlwLnN1bmsgPSB0cnVlO1xuICAgICAgfVxuXG4gICAgICB1cGRhdGVCb2FyZChib2FyZCwgYm9hcmRJZCwgaXNBaUJvYXJkKTtcbiAgICB9IGVsc2Uge1xuICAgICAgYm9hcmRbY29yZGluYXRlc10uYmVlbkhpdCA9IHRydWU7XG4gICAgICB1cGRhdGVCb2FyZChib2FyZCwgYm9hcmRJZCwgaXNBaUJvYXJkKTtcbiAgICB9XG4gIH07XG5cbiAgY29uc3QgYWxsU2hpcHNTdW5rID0gKCkgPT4ge1xuICAgIGZvcihsZXQgaT0wOyBpIDwgMTAwOyBpICs9IDEpIHtcbiAgICAgIGlmKGJvYXJkW2ldLnN0b3JlZFNoaXAgIT09IGZhbHNlICYmIGJvYXJkW2ldLmJlZW5IaXQgPT09IGZhbHNlKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gdHJ1ZTtcbiAgfVxuXG4gIGNvbnN0IHJlc2V0Qm9hcmQgPSAoKSA9PiB7XG4gICAgZm9yKGxldCBpPTA7IGkgPCAxMDA7IGkgKz0gMSkge1xuICAgICAgYm9hcmRbaV0uc3RvcmVkU2hpcCA9IGZhbHNlO1xuICAgICAgYm9hcmRbaV0uYmVlbkhpdCA9IGZhbHNlO1xuICAgIH1cbiAgfVxuXG4gIHJldHVybiB7IGJvYXJkLCBjcmVhdGVCb2FyZCwgcGxhY2VTaGlwLCByZWNlaXZlQXR0YWNrLCBhbGxTaGlwc1N1bmssIHJhbmRvbVNoaXBzLCByZXNldEJvYXJkIH07XG59O1xuXG5leHBvcnQgZGVmYXVsdCBnYW1lQm9hcmQ7IiwiY29uc3QgY3JlYXRlUGxheWVyID0gKG5hbWUsIG9wcEJvYXJkKSA9PiB7XG5cbiAgICBjb25zdCBhdHRhY2sgPSAoY29yZGluYXRlcywgYm9hcmRJZCwgaXNBaUJvYXJkKSA9PiB7XG4gICAgICAgIG9wcEJvYXJkLnJlY2VpdmVBdHRhY2soY29yZGluYXRlcywgYm9hcmRJZCwgaXNBaUJvYXJkKTtcbiAgICB9XG5cbiAgICBjb25zdCBhaUF0dGFjayA9ICgpID0+IHtcbiAgICAgICAgbGV0IHJhbmRvbU51bWJlcjtcbiAgICAgICAgZG8ge1xuICAgICAgICAgICAgcmFuZG9tTnVtYmVyID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogOTkpO1xuICAgICAgICB9IHdoaWxlIChvcHBCb2FyZC5ib2FyZFtyYW5kb21OdW1iZXJdLmJlZW5IaXQpO1xuXG4gICAgICAgIG9wcEJvYXJkLnJlY2VpdmVBdHRhY2socmFuZG9tTnVtYmVyLCAncCcsIGZhbHNlKTtcbiAgICB9XG5cbiAgICByZXR1cm4geyBuYW1lLCBvcHBCb2FyZCwgYXR0YWNrLCBhaUF0dGFjayB9XG59XG5cbmV4cG9ydCBkZWZhdWx0IGNyZWF0ZVBsYXllcjsiLCJpbXBvcnQgdXBkYXRlQm9hcmQgZnJvbSBcIi4vdXBkYXRlQm9hcmRcIjtcblxuY29uc3QgZW5kR2FtZSA9IChwQm9hcmQsIGFpQm9hcmQsIGlzUGxheWVyV29uKSA9PiB7XG4gICAgaWYoaXNQbGF5ZXJXb24pIHtcbiAgICAgICAgY29uc3Qgd2lubmVyVGV4dCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy53aW5uZXJUZXh0Jyk7XG4gICAgICAgIHdpbm5lclRleHQudGV4dENvbnRlbnQgPSAnWW91IFdvbiBEbyBZb3UgV2FudCBUbyBQbGF5IEFnYWluPyc7XG4gICAgfSBlbHNlIHtcbiAgICAgICAgY29uc3Qgd2lubmVyVGV4dCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy53aW5uZXJUZXh0Jyk7XG4gICAgICAgIHdpbm5lclRleHQudGV4dENvbnRlbnQgPSAnQWkgV29uIERvIFlvdSBXYW50IFRvIFBsYXkgQWdhaW4nO1xuICAgIH1cblxuICAgIGNvbnN0IHdpbkJhY2tncm91bmQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcud2luQmFja2dyb3VuZCcpO1xuICAgIHdpbkJhY2tncm91bmQuc3R5bGUuZGlzcGxheSA9ICdmbGV4JztcblxuICAgIGNvbnN0IHJlc3RhcnRCdXR0b24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcucmVzdGFydEJ1dHRvbicpO1xuICAgIHJlc3RhcnRCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7XG4gICAgICAgIHBCb2FyZC5yZXNldEJvYXJkKCk7XG4gICAgICAgIHVwZGF0ZUJvYXJkKHBCb2FyZC5ib2FyZCwgJ3AnLCBmYWxzZSk7XG5cbiAgICAgICAgYWlCb2FyZC5yZXNldEJvYXJkKCk7XG4gICAgICAgIHVwZGF0ZUJvYXJkKGFpQm9hcmQuYm9hcmQsICdhaScsIHRydWUpO1xuXG4gICAgICAgIGNvbnN0IGJ1dHRvbnNEaXYgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuYnV0dG9ucycpO1xuICAgICAgICBidXR0b25zRGl2LnN0eWxlLmRpc3BsYXkgPSAnZmxleCc7XG5cbiAgICAgICAgY29uc3Qgc3RhcnRCdXR0b24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuc3RhcnRCdXR0b24nKTtcbiAgICAgICAgc3RhcnRCdXR0b24uc3R5bGUuZGlzcGxheSA9ICdmbGV4JztcblxuICAgICAgICBjb25zdCBtYW51YWxCdXR0b24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcubWFudWFsJyk7XG4gICAgICAgIG1hbnVhbEJ1dHRvbi5zdHlsZS5kaXNwbGF5ID0gJ2ZsZXgnO1xuICAgICAgICBtYW51YWxCdXR0b24uc3R5bGUucmVtb3ZlUHJvcGVydHkoJ21hcmdpbi1sZWZ0Jyk7XG5cbiAgICAgICAgY29uc3QgcGxhY2VSYW5kb21CdXR0b24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcucmFuZG9tJyk7XG4gICAgICAgIHBsYWNlUmFuZG9tQnV0dG9uLnN0eWxlLmRpc3BsYXkgPSAnZmxleCc7XG4gICAgICAgIHBsYWNlUmFuZG9tQnV0dG9uLnN0eWxlLnJlbW92ZVByb3BlcnR5KCdtYXJnaW4tbGVmdCcpO1xuXG4gICAgICAgIGNvbnN0IGF4aXNCdXR0b24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuYXhpc0J1dHRvbicpO1xuICAgICAgICBpZihheGlzQnV0dG9uICE9PSBudWxsKSB7XG4gICAgICAgICAgICBheGlzQnV0dG9uLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7XG4gICAgICAgIH1cblxuICAgICAgICB3aW5CYWNrZ3JvdW5kLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7XG4gICAgfSlcbn1cblxuZXhwb3J0IGRlZmF1bHQgZW5kR2FtZTsiLCJjb25zdCBkaXNwbGF5TWFudWFsU2hpcHMgPSAoZXZlbnQsIHNoaXBMZW5ndGgsIHJldmVydCwgYm9hcmQpID0+IHtcbiAgICBjb25zdCBheGlzQnV0dG9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmF4aXNCdXR0b24nKTtcbiAgICBjb25zdCBjZWxsSWQgPSBOdW1iZXIoZXZlbnQudGFyZ2V0LmlkLnNsaWNlKDEpKTtcbiAgICBjb25zdCBjb2x1bW5JbmRleCA9IGNlbGxJZCAlIDEwO1xuICAgIGNvbnN0IHJvd0luZGV4ID0gTWF0aC5mbG9vcihjZWxsSWQgLyAxMCk7XG5cbiAgICBjb25zdCBzdGFydEJ1dHRvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5zdGFydEJ1dHRvbicpO1xuICAgIGlmKHN0YXJ0QnV0dG9uLnN0eWxlLmRpc3BsYXkgIT09ICdub25lJykge1xuICAgICAgICBpZihyZXZlcnQpIHtcblxuICAgICAgICAgICAgaWYoYXhpc0J1dHRvbi50ZXh0Q29udGVudCA9PT0gJ0hvcml6b250YWwnKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgdW52YWxpZENlbGxzID0gY29sdW1uSW5kZXggLSBzaGlwTGVuZ3RoO1xuICAgICAgICAgICAgICAgIGlmKHVudmFsaWRDZWxscyA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgZm9yKGxldCBpID0gMDsgaSA8IHNoaXBMZW5ndGggLSB1bnZhbGlkQ2VsbHM7IGkgKz0gMSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgY2VsbFJldmVydCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYCNwJHtjZWxsSWQgKyBpfWApO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYoYm9hcmRbY2VsbElkICsgaV0uc3RvcmVkU2hpcCA9PT0gZmFsc2UpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjZWxsUmV2ZXJ0LnN0eWxlLmJhY2tncm91bmRDb2xvciA9ICd3aGl0ZSc7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBmb3IobGV0IGkgPSAwOyBpIDwgc2hpcExlbmd0aDsgaSArPSAxKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBjZWxsUmV2ZXJ0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihgI3Ake2NlbGxJZCArIGl9YCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZihib2FyZFtjZWxsSWQgKyBpXS5zdG9yZWRTaGlwID09PSBmYWxzZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNlbGxSZXZlcnQuc3R5bGUuYmFja2dyb3VuZENvbG9yID0gJ3doaXRlJztcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gZWxzZSBpZihheGlzQnV0dG9uLnRleHRDb250ZW50ID09PSAnVmVydGljYWwnKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgdW52YWxpZENlbGxzID0gcm93SW5kZXggLSBzaGlwTGVuZ3RoO1xuICAgICAgICAgICAgICAgIGlmKHVudmFsaWRDZWxscyA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgZm9yKGxldCBpID0gMDsgaSA8IChzaGlwTGVuZ3RoICogMTApIC0gKHVudmFsaWRDZWxscyAqIDEwKTsgaSArPSAxMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgY2VsbFJldmVydCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYCNwJHtjZWxsSWQgKyBpfWApO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYoYm9hcmRbY2VsbElkICsgaV0uc3RvcmVkU2hpcCA9PT0gZmFsc2UpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjZWxsUmV2ZXJ0LnN0eWxlLmJhY2tncm91bmRDb2xvciA9ICd3aGl0ZSc7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBmb3IobGV0IGkgPSAwOyBpIDwgKHNoaXBMZW5ndGggKiAxMCk7IGkgKz0gMTApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGNlbGxSZXZlcnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGAjcCR7Y2VsbElkICsgaX1gKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmKGJvYXJkW2NlbGxJZCArIGldLnN0b3JlZFNoaXAgPT09IGZhbHNlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2VsbFJldmVydC5zdHlsZS5iYWNrZ3JvdW5kQ29sb3IgPSAnd2hpdGUnO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgXG4gICAgXG4gICAgICAgIH0gZWxzZSBpZihheGlzQnV0dG9uLnRleHRDb250ZW50ID09PSAnSG9yaXpvbnRhbCcpIHtcbiAgICBcbiAgICAgICAgICAgIGNvbnN0IHVudmFsaWRDZWxscyA9ICg5IC0gY29sdW1uSW5kZXgpICsgMTtcbiAgICAgICAgICAgIGlmKGNvbHVtbkluZGV4ID4gKDkgLSBzaGlwTGVuZ3RoKSArIDEpIHtcbiAgICAgICAgICAgICAgICBmb3IobGV0IGkgPSAwOyBpIDwgc2hpcExlbmd0aDsgaSArPSAxKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmKGJvYXJkW2NlbGxJZCArIGldLnN0b3JlZFNoaXAgIT09IGZhbHNlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgXG4gICAgICAgICAgICAgICAgZm9yKGxldCBpID0gMDsgaSA8IHVudmFsaWRDZWxsczsgaSArPSAxKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGNlbGwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGAjcCR7Y2VsbElkICsgaX1gKTtcbiAgICAgICAgICAgICAgICAgICAgY2VsbC5zdHlsZS5iYWNrZ3JvdW5kID0gJ3JnYigxODUsIDc0LCA3NCknO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgZm9yKGxldCBpID0gMDsgaSA8IHNoaXBMZW5ndGg7IGkgKz0gMSkge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBjZWxsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihgI3Ake2NlbGxJZCArIGl9YCk7XG4gICAgICAgICAgICAgICAgICAgIGlmKGJvYXJkW2NlbGxJZCArIGldLnN0b3JlZFNoaXAgPT09IGZhbHNlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjZWxsLnN0eWxlLmJhY2tncm91bmQgPSAnbGltZSc7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgXG4gICAgICAgIH0gZWxzZSBpZihheGlzQnV0dG9uLnRleHRDb250ZW50ID09PSAnVmVydGljYWwnKXtcbiAgICBcbiAgICAgICAgICAgIGNvbnN0IHVudmFsaWRDZWxscyA9ICg5IC0gcm93SW5kZXgpICsgMTtcbiAgICAgICAgICAgIGlmKHJvd0luZGV4ID4gKDkgLSBzaGlwTGVuZ3RoKSArIDEpIHtcbiAgICAgICAgICAgICAgICBmb3IobGV0IGkgPSAwOyBpIDwgdW52YWxpZENlbGxzICogMTA7IGkgKz0gMTApIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgY2VsbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYCNwJHtjZWxsSWQgKyBpfWApO1xuICAgICAgICAgICAgICAgICAgICBpZihib2FyZFtjZWxsSWQgKyBpXS5zdG9yZWRTaGlwID09PSBmYWxzZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgY2VsbC5zdHlsZS5iYWNrZ3JvdW5kID0gJ3JnYigxODUsIDc0LCA3NCknO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBmb3IobGV0IGkgPSAwOyBpIDwgc2hpcExlbmd0aCAqIDEwOyBpICs9IDEwKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGNlbGwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGAjcCR7Y2VsbElkICsgaX1gKTtcbiAgICAgICAgICAgICAgICAgICAgaWYoYm9hcmRbY2VsbElkICsgaV0uc3RvcmVkU2hpcCA9PT0gZmFsc2UpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNlbGwuc3R5bGUuYmFja2dyb3VuZCA9ICdsaW1lJztcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIFxuICAgICAgICB9XG4gICAgfVxuXG59XG5cbmV4cG9ydCBkZWZhdWx0IGRpc3BsYXlNYW51YWxTaGlwczsiLCJpbXBvcnQgZ2FtZUJvYXJkIGZyb20gXCIuL2dhbWVCb2FyZFwiO1xuaW1wb3J0IGNyZWF0ZVBsYXllciBmcm9tIFwiLi9jcmVhdGVQbGF5ZXJcIjtcbmltcG9ydCBlbmRHYW1lIGZyb20gXCIuL2VuZEdhbWVcIjtcbmltcG9ydCBhZGRBeGlzQnV0dG9uIGZyb20gXCIuL2FkZEF4aXNCdXR0b25cIjtcbmltcG9ydCBkaXNwbGF5TWFudWFsU2hpcHMgZnJvbSBcIi4vZGlzcGxheU1hbnVhbFNoaXBzXCI7XG5pbXBvcnQgY3JlYXRlU2hpcCBmcm9tIFwiLi9jcmVhdGVTaGlwXCI7XG5pbXBvcnQgdXBkYXRlQm9hcmQgZnJvbSBcIi4vdXBkYXRlQm9hcmRcIjtcblxuXG5jb25zdCBwQm9hcmQgPSBnYW1lQm9hcmQoKTtcbnBCb2FyZC5jcmVhdGVCb2FyZCgncCcpO1xuY29uc3QgYWlCb2FyZCA9IGdhbWVCb2FyZCgpO1xuYWlCb2FyZC5jcmVhdGVCb2FyZCgnYWknKTtcblxuY29uc3QgcGxheWVyID0gY3JlYXRlUGxheWVyKCdwbGF5ZXInLCBhaUJvYXJkKTtcbmNvbnN0IGFpID0gY3JlYXRlUGxheWVyKCdhaScsIHBCb2FyZCk7XG5cbmNvbnN0IHBsYWNlUmFuZG9tQnV0dG9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnJhbmRvbScpO1xuY29uc3QgcGxhY2VNYW51YWxseUJ1dHRvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5tYW51YWwnKTtcblxucGxhY2VSYW5kb21CdXR0b24uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7XG4gICAgcGxhY2VNYW51YWxseUJ1dHRvbi5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnO1xuXG4gICAgcGxhY2VSYW5kb21CdXR0b24uc3R5bGUubWFyZ2luTGVmdCA9ICcxMTVweCc7XG5cbiAgICBwQm9hcmQucmFuZG9tU2hpcHMoJ3AnLCBmYWxzZSk7XG59KVxuXG5jb25zdCBoYW5kbGVDbGljayA9IChldmVudCkgPT4ge1xuICAgIGNvbnN0IGluZGV4ID0gTnVtYmVyKGV2ZW50LnRhcmdldC5pZC5zbGljZSgyKSlcbiAgICBcbiAgICBpZihhaUJvYXJkLmJvYXJkW2luZGV4XS5iZWVuSGl0ID09PSBmYWxzZSkge1xuICAgICAgICBwbGF5ZXIuYXR0YWNrKGluZGV4LCAnYWknLCB0cnVlKTtcbiAgICAgICAgY29uc3QgaXNQbGF5ZXJXb24gPSBhaUJvYXJkLmFsbFNoaXBzU3VuaygpO1xuICAgICAgICBpZihpc1BsYXllcldvbikge1xuICAgICAgICAgICAgZW5kR2FtZShwQm9hcmQsIGFpQm9hcmQsIHRydWUpO1xuXG4gICAgICAgICAgICBjb25zdCBhbGxDZWxscyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJ2Rpdi5jZWxsW2lkXj1cImFpXCJdJyk7XG4gICAgICAgICAgICBhbGxDZWxscy5mb3JFYWNoKChjZWxsKSA9PiB7XG4gICAgICAgICAgICAgICAgY2VsbC5yZW1vdmVFdmVudExpc3RlbmVyKCdjbGljaycsIGhhbmRsZUNsaWNrKTtcbiAgICAgICAgICAgIH0pXG4gICAgICAgIH1cblxuICAgICAgICBhaS5haUF0dGFjaygpO1xuICAgICAgICBjb25zdCBpc0FpV29uID0gcEJvYXJkLmFsbFNoaXBzU3VuaygpO1xuICAgICAgICBpZihpc0FpV29uKSB7XG4gICAgICAgICAgICBlbmRHYW1lKHBCb2FyZCwgYWlCb2FyZCwgZmFsc2UpO1xuXG4gICAgICAgICAgICBjb25zdCBhbGxDZWxscyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJ2Rpdi5jZWxsW2lkXj1cImFpXCJdJyk7XG4gICAgICAgICAgICBhbGxDZWxscy5mb3JFYWNoKChjZWxsKSA9PiB7XG4gICAgICAgICAgICAgICAgY2VsbC5yZW1vdmVFdmVudExpc3RlbmVyKCdjbGljaycsIGhhbmRsZUNsaWNrKTtcbiAgICAgICAgICAgIH0pXG4gICAgICAgIH1cbiAgICB9XG59XG5cbmNvbnN0IHN0YXJ0QnV0dG9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnN0YXJ0QnV0dG9uJyk7XG5zdGFydEJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHtcblxuICAgIGxldCBzaGlwQ2VsbHMgPSAwO1xuICAgIGZvcihsZXQgaSA9IDA7IGkgPCAxMDA7IGkgKz0gMSkge1xuICAgICAgICBpZihwQm9hcmQuYm9hcmRbaV0uc3RvcmVkU2hpcCAhPT0gZmFsc2UpIHtcbiAgICAgICAgICAgIHNoaXBDZWxscyArPSAxO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgaWYoc2hpcENlbGxzID09PSAxNykge1xuICAgICAgICBjb25zdCBidXR0b25zRGl2ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmJ1dHRvbnMnKTtcbiAgICAgICAgYnV0dG9uc0Rpdi5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnO1xuICAgICAgICBzdGFydEJ1dHRvbi5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnO1xuXG5cbiAgICAgICAgYWlCb2FyZC5yYW5kb21TaGlwcygnYWknLCB0cnVlKTtcblxuICAgICAgICBjb25zdCBhbGxDZWxscyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJ2Rpdi5jZWxsW2lkXj1cImFpXCJdJyk7XG4gICAgICAgIGFsbENlbGxzLmZvckVhY2goKGNlbGwpID0+IHtcbiAgICAgICAgICAgIGNlbGwuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBoYW5kbGVDbGljayk7XG4gICAgICAgIH0pXG4gICAgfVxufSlcblxucGxhY2VNYW51YWxseUJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHtcblxuICAgIHBsYWNlUmFuZG9tQnV0dG9uLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7XG5cbiAgICBjb25zdCBheGlzQnV0dG9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmF4aXNCdXR0b24nKTtcbiAgICBpZihheGlzQnV0dG9uID09PSBudWxsKSB7XG4gICAgICAgIGFkZEF4aXNCdXR0b24oKTtcblxuICAgICAgICBjb25zdCBhbGxQbGF5ZXJDZWxscyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJ2Rpdi5jZWxsW2lkXj1cInBcIl0nKTtcbiAgICAgICAgYWxsUGxheWVyQ2VsbHMuZm9yRWFjaCgoY2VsbCkgPT4ge1xuICAgICAgICAgICAgY2VsbC5hZGRFdmVudExpc3RlbmVyKCdtb3VzZWVudGVyJywgKGV2ZW50KSA9PiB7XG4gICAgICAgICAgICAgICAgbGV0IHNoaXBDZWxscyA9IDA7XG4gICAgICAgICAgICAgICAgZm9yKGxldCBpID0gMDsgaSA8IDEwMDsgaSArPSAxKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmKHBCb2FyZC5ib2FyZFtpXS5zdG9yZWRTaGlwICE9PSBmYWxzZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgc2hpcENlbGxzICs9IDE7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBpZihzaGlwQ2VsbHMgPT09IDApIHtcbiAgICAgICAgICAgICAgICAgICAgZGlzcGxheU1hbnVhbFNoaXBzKGV2ZW50LCA1LCBmYWxzZSwgcEJvYXJkLmJvYXJkKTtcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYoc2hpcENlbGxzID09PSA1KSB7XG4gICAgICAgICAgICAgICAgICAgIGRpc3BsYXlNYW51YWxTaGlwcyhldmVudCwgNCwgZmFsc2UsIHBCb2FyZC5ib2FyZCk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmKHNoaXBDZWxscyA9PT0gOSkge1xuICAgICAgICAgICAgICAgICAgICBkaXNwbGF5TWFudWFsU2hpcHMoZXZlbnQsIDMsIGZhbHNlLCBwQm9hcmQuYm9hcmQpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSBpZihzaGlwQ2VsbHMgPT09IDEyKSB7XG4gICAgICAgICAgICAgICAgICAgIGRpc3BsYXlNYW51YWxTaGlwcyhldmVudCwgMywgZmFsc2UsIHBCb2FyZC5ib2FyZCk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmKHNoaXBDZWxscyA9PT0gMTUpIHtcbiAgICAgICAgICAgICAgICAgICAgZGlzcGxheU1hbnVhbFNoaXBzKGV2ZW50LCAyLCBmYWxzZSwgcEJvYXJkLmJvYXJkKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KVxuICAgICAgICB9KVxuXG4gICAgICAgIGFsbFBsYXllckNlbGxzLmZvckVhY2goKGNlbGwpID0+IHtcbiAgICAgICAgICAgIGNlbGwuYWRkRXZlbnRMaXN0ZW5lcignbW91c2VsZWF2ZScsIChldmVudCkgPT4ge1xuICAgICAgICAgICAgICAgIGRpc3BsYXlNYW51YWxTaGlwcyhldmVudCwgNSwgdHJ1ZSwgcEJvYXJkLmJvYXJkKTtcbiAgICAgICAgICAgIH0pXG4gICAgICAgIH0pXG5cbiAgICAgICAgYWxsUGxheWVyQ2VsbHMuZm9yRWFjaCgoY2VsbCkgPT4ge1xuICAgICAgICAgICAgY2VsbC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIChldmVudCkgPT4ge1xuICAgICAgICAgICAgICAgIGxldCBuZXdTaGlwO1xuICAgICAgICAgICAgICAgIGxldCBpc1ZlcnRpY2FsO1xuICAgICAgICAgICAgICAgIGNvbnN0IGFkZGVkQXhpc0J1dHRvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5heGlzQnV0dG9uJyk7XG5cbiAgICAgICAgICAgICAgICBpZihhZGRlZEF4aXNCdXR0b24udGV4dENvbnRlbnQgPT09ICdWZXJ0aWNhbCcpIHtcbiAgICAgICAgICAgICAgICAgICAgaXNWZXJ0aWNhbCA9IHRydWU7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgaXNWZXJ0aWNhbCA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGxldCBzaGlwQ2VsbHMgPSAwO1xuICAgICAgICAgICAgICAgIGZvcihsZXQgaSA9IDA7IGkgPCAxMDA7IGkgKz0gMSkge1xuICAgICAgICAgICAgICAgICAgICBpZihwQm9hcmQuYm9hcmRbaV0uc3RvcmVkU2hpcCAhPT0gZmFsc2UpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNoaXBDZWxscyArPSAxO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgaWYoc2hpcENlbGxzID09PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgIG5ld1NoaXAgPSBjcmVhdGVTaGlwKDUsIGlzVmVydGljYWwpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSBpZihzaGlwQ2VsbHMgPT09IDUpIHtcbiAgICAgICAgICAgICAgICAgICAgbmV3U2hpcCA9IGNyZWF0ZVNoaXAoNCwgaXNWZXJ0aWNhbCk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmKHNoaXBDZWxscyA9PT0gOSkge1xuICAgICAgICAgICAgICAgICAgICBuZXdTaGlwID0gY3JlYXRlU2hpcCgzLCBpc1ZlcnRpY2FsKTtcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYoc2hpcENlbGxzID09PSAxMikge1xuICAgICAgICAgICAgICAgICAgICBuZXdTaGlwID0gY3JlYXRlU2hpcCgzLCBpc1ZlcnRpY2FsKTtcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYoc2hpcENlbGxzID09PSAxNSkge1xuICAgICAgICAgICAgICAgICAgICBuZXdTaGlwID0gY3JlYXRlU2hpcCgyLCBpc1ZlcnRpY2FsKTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBjb25zdCBjZWxsSWQgPSBOdW1iZXIoZXZlbnQudGFyZ2V0LmlkLnNsaWNlKDEpKTtcbiAgICAgICAgICAgICAgICBpZihuZXdTaGlwLmlzVmVydGljYWwpIHtcbiAgICAgICAgICAgICAgICAgICAgZm9yKGxldCBpID0gMDsgaSA8IG5ld1NoaXAubGVuZ3RoICogMTA7IGkgKz0gMTApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmKHBCb2FyZC5ib2FyZFtjZWxsSWQgKyBpXS5zdG9yZWRTaGlwICE9PSBmYWxzZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGZvcihsZXQgaSA9IDA7IGkgPCBuZXdTaGlwLmxlbmd0aDsgaSArPSAxKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZihwQm9hcmQuYm9hcmRbY2VsbElkICsgaV0uc3RvcmVkU2hpcCAhPT0gZmFsc2UpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBjb25zdCBjbGlja2VkQ2VsbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYCNwJHtjZWxsSWR9YCk7XG4gICAgICAgICAgICAgICAgaWYoY2xpY2tlZENlbGwuc3R5bGUuYmFja2dyb3VuZCAhPT0gJ3JnYigxODUsIDc0LCA3NCknKSB7XG4gICAgICAgICAgICAgICAgICAgIHBCb2FyZC5wbGFjZVNoaXAobmV3U2hpcCwgY2VsbElkKTtcbiAgICAgICAgICAgICAgICAgICAgdXBkYXRlQm9hcmQocEJvYXJkLmJvYXJkLCAncCcsIGZhbHNlKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KVxuICAgICAgICB9KVxuICAgIH1cbn0pXG4iLCJjb25zdCBhZGRBeGlzQnV0dG9uID0gKCkgPT4ge1xuICAgIGNvbnN0IGJ1dHRvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2J1dHRvbicpO1xuICAgIGJ1dHRvbi5jbGFzc0xpc3QuYWRkKCdheGlzQnV0dG9uJyk7XG4gICAgYnV0dG9uLnRleHRDb250ZW50ID0gJ0hvcml6b250YWwnO1xuXG4gICAgYnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4ge1xuICAgICAgICBpZihidXR0b24udGV4dENvbnRlbnQgPT09ICdWZXJ0aWNhbCcpIHtcbiAgICAgICAgICAgIGJ1dHRvbi50ZXh0Q29udGVudCA9ICdIb3Jpem9udGFsJztcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGJ1dHRvbi50ZXh0Q29udGVudCA9ICdWZXJ0aWNhbCc7XG4gICAgICAgIH1cbiAgICB9KVxuXG4gICAgY29uc3QgYnV0dG9uc0RpdiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5idXR0b25zJyk7XG4gICAgYnV0dG9uc0Rpdi5hcHBlbmRDaGlsZChidXR0b24pO1xufVxuXG5leHBvcnQgZGVmYXVsdCBhZGRBeGlzQnV0dG9uOyJdLCJuYW1lcyI6WyJpZCIsInBsYXllciIsImNlbGwiLCJkb2N1bWVudCIsImNyZWF0ZUVsZW1lbnQiLCJjbGFzc0xpc3QiLCJhZGQiLCJxdWVyeVNlbGVjdG9yIiwiYXBwZW5kQ2hpbGQiLCJib2FyZCIsImJvYXJkSWQiLCJpc0FpQm9hcmQiLCJpIiwic3RvcmVkU2hpcCIsImJlZW5IaXQiLCJnZXRFbGVtZW50QnlJZCIsInN0eWxlIiwiYmFja2dyb3VuZENvbG9yIiwibGVuZ3RoIiwiaXNWZXJ0aWNhbCIsImhpdENvdW50Iiwic3VuayIsInNoaXBMZW5ndGgiLCJib2FyZENvcHkiLCJNYXRoIiwiZmxvb3IiLCJyYW5kb20iLCJzdGFydGluZ0NvbHVtbiIsInN0YXJ0aW5nUm93Iiwic2xpY2UiLCJzb21lIiwibmV3U2hpcCIsImhhc1N0b3JlZFNoaXAiLCJzbGljZWRBcnJheSIsInB1c2giLCJjcmVhdGVCb2FyZCIsInBsYWNlU2hpcCIsInNoaXAiLCJzdGFydCIsInJlY2VpdmVBdHRhY2siLCJjb3JkaW5hdGVzIiwibmV3SGl0Q291bnQiLCJhbGxTaGlwc1N1bmsiLCJyYW5kb21TaGlwcyIsInJlc2V0Qm9hcmQiLCJuYW1lIiwib3BwQm9hcmQiLCJhdHRhY2siLCJhaUF0dGFjayIsInJhbmRvbU51bWJlciIsInBCb2FyZCIsImFpQm9hcmQiLCJpc1BsYXllcldvbiIsInRleHRDb250ZW50Iiwid2luQmFja2dyb3VuZCIsImRpc3BsYXkiLCJhZGRFdmVudExpc3RlbmVyIiwibWFudWFsQnV0dG9uIiwicmVtb3ZlUHJvcGVydHkiLCJwbGFjZVJhbmRvbUJ1dHRvbiIsImF4aXNCdXR0b24iLCJldmVudCIsInJldmVydCIsImNlbGxJZCIsIk51bWJlciIsInRhcmdldCIsImNvbHVtbkluZGV4Iiwicm93SW5kZXgiLCJ1bnZhbGlkQ2VsbHMiLCJjZWxsUmV2ZXJ0IiwiYmFja2dyb3VuZCIsImFpIiwicGxhY2VNYW51YWxseUJ1dHRvbiIsIm1hcmdpbkxlZnQiLCJoYW5kbGVDbGljayIsImluZGV4IiwicXVlcnlTZWxlY3RvckFsbCIsImZvckVhY2giLCJyZW1vdmVFdmVudExpc3RlbmVyIiwic3RhcnRCdXR0b24iLCJzaGlwQ2VsbHMiLCJidXR0b24iLCJhbGxQbGF5ZXJDZWxscyJdLCJzb3VyY2VSb290IjoiIn0=