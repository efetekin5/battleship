(()=>{"use strict";const e=(e,t)=>{const o=document.createElement("div");o.classList.add("cell"),"p"===t?(o.id=`${t}${e}`,document.querySelector(".playerBoard").appendChild(o)):"ai"===t&&(o.id=`${t}${e}`,document.querySelector(".aiBoard").appendChild(o))},t=(e,t,o)=>{if(o)for(let o=0;o<100;o+=1)!1!==e[o].storedShip&&!0===e[o].beenHit?document.getElementById(`${t}${o}`).style.backgroundColor="rgb(133, 255, 179)":!1===e[o].storedShip&&!0===e[o].beenHit?document.getElementById(`${t}${o}`).style.backgroundColor="rgb(255, 133, 133)":document.getElementById(`${t}${o}`).style.backgroundColor="white";else for(let o=0;o<100;o+=1)!1!==e[o].storedShip&&!1===e[o].beenHit?document.getElementById(`${t}${o}`).style.backgroundColor="rgb(68, 68, 68)":!1!==e[o].storedShip&&!0===e[o].beenHit?document.getElementById(`${t}${o}`).style.backgroundColor="rgb(133, 255, 179)":!1===e[o].storedShip&&!0===e[o].beenHit?document.getElementById(`${t}${o}`).style.backgroundColor="rgb(255, 133, 133)":document.getElementById(`${t}${o}`).style.backgroundColor="white"},o=(e,t)=>({length:e,hitCount:0,sunk:!1,isVertical:t}),r=(e,t)=>{const r=[...e];if(1===Math.floor(2*Math.random())+1){let e,l;do{e=Math.floor(Math.random()*(10-t+1)),l=10*Math.floor(10*Math.random())}while(r.slice(l+e,l+e+t).some((e=>e.storedShip)));const n=o(t,!1);for(let o=0;o<t;o+=1)r[l+e+o].storedShip=n}else{let e,l,n;do{e=Math.floor(10*Math.random()),l=10*Math.floor(Math.random()*(10-t+1));const o=[];for(let n=l+e;n<e+l+10*t;n+=10)o.push(r[n]);n=o.some((e=>e.storedShip))}while(n);const d=o(t,!0);for(let o=0;o<10*t;o+=10)r[l+e+o].storedShip=d}return r},l=()=>{let o=[];return{board:o,createBoard:t=>{for(let r=0;r<100;r+=1)o[r]={storedShip:!1,beenHit:!1},e(r,t)},placeShip:(e,t)=>{if(e.isVertical)for(let r=t;r<t+10*e.length;r+=10)o[r].storedShip=e;else for(let r=t;r<t+e.length;r+=1)o[r].storedShip=e},receiveAttack:(e,r,l)=>{if(!1!==o[e].storedShip){o[e].beenHit=!0;let n=o[e].storedShip.hitCount;n+=1,o[e].storedShip.hitCount=n,o[e].storedShip.hitCount===o[e].storedShip.length&&(o[e].storedShip.sunk=!0),t(o,r,l)}else o[e].beenHit=!0,t(o,r,l)},allShipsSunk:()=>{for(let e=0;e<100;e+=1)if(!1!==o[e].storedShip&&!1===o[e].beenHit)return!1;return!0},randomShips:(e,l)=>{let n=[...o];for(let e=0;e<100;e+=1)n[e].storedShip=!1;n=r(o,5),n=r(o,4),n=r(o,3),n=r(o,3),n=r(o,2),t(n,e,l),o=n},resetBoard:()=>{for(let e=0;e<100;e+=1)o[e].storedShip=!1,o[e].beenHit=!1}}},n=(e,t)=>({name:e,oppBoard:t,attack:(e,o,r)=>{t.receiveAttack(e,o,r)},aiAttack:()=>{let e;do{e=Math.floor(99*Math.random())}while(t.board[e].beenHit);t.receiveAttack(e,"p",!1)}}),d=(e,o,r)=>{document.querySelector(".winnerText").textContent=r?"You Won Do You Want To Play Again?":"Ai Won Do You Want To Play Again";const l=document.querySelector(".winBackground");l.style.display="flex",document.querySelector(".restartButton").addEventListener("click",(()=>{e.resetBoard(),t(e.board,"p",!1),o.resetBoard(),t(o.board,"ai",!0),document.querySelector(".buttons").style.display="flex",document.querySelector(".startButton").style.display="flex";const r=document.querySelector(".manual");r.style.display="flex",r.style.removeProperty("margin-left");const n=document.querySelector(".random");n.style.display="flex",n.style.removeProperty("margin-left");const d=document.querySelector(".axisButton");null!==d&&d.remove(),l.style.display="none"}))},i=(e,t,o,r)=>{const l=document.querySelector(".axisButton"),n=Number(e.target.id.slice(1)),d=n%10,i=Math.floor(n/10);if("none"!==document.querySelector(".startButton").style.display)if(o){if("Horizontal"===l.textContent){const e=d-t;if(e>0)for(let o=0;o<t-e;o+=1){const e=document.querySelector(`#p${n+o}`);!1===r[n+o].storedShip&&(e.style.backgroundColor="white")}else for(let e=0;e<t;e+=1){const t=document.querySelector(`#p${n+e}`);!1===r[n+e].storedShip&&(t.style.backgroundColor="white")}}else if("Vertical"===l.textContent){const e=i-t;if(e>0)for(let o=0;o<10*t-10*e;o+=10){const e=document.querySelector(`#p${n+o}`);!1===r[n+o].storedShip&&(e.style.backgroundColor="white")}else for(let e=0;e<10*t;e+=10){const t=document.querySelector(`#p${n+e}`);!1===r[n+e].storedShip&&(t.style.backgroundColor="white")}}}else if("Horizontal"===l.textContent){const e=9-d+1;if(d>9-t+1)for(let t=0;t<e;t+=1){const e=document.querySelector(`#p${n+t}`);!1===r[n+t].storedShip&&(e.style.background="rgb(185, 74, 74)")}else for(let e=0;e<t;e+=1){const t=document.querySelector(`#p${n+e}`);!1===r[n+e].storedShip&&(t.style.background="lime")}}else if("Vertical"===l.textContent){const e=9-i+1;if(i>9-t+1)for(let t=0;t<10*e;t+=10){const e=document.querySelector(`#p${n+t}`);!1===r[n+t].storedShip&&(e.style.background="rgb(185, 74, 74)")}else for(let e=0;e<10*t;e+=10){const t=document.querySelector(`#p${n+e}`);!1===r[n+e].storedShip&&(t.style.background="lime")}}},c=l();c.createBoard("p");const a=l();a.createBoard("ai");const s=n("player",a),u=n("ai",c),p=document.querySelector(".random"),y=document.querySelector(".manual");p.addEventListener("click",(()=>{y.style.display="none",p.style.marginLeft="115px",c.randomShips("p",!1)}));const h=e=>{const t=Number(e.target.id.slice(2));!1===a.board[t].beenHit&&(s.attack(t,"ai",!0),a.allShipsSunk()&&(d(c,a,!0),document.querySelectorAll('div.cell[id^="ai"]').forEach((e=>{e.removeEventListener("click",h)}))),u.aiAttack(),c.allShipsSunk()&&(d(c,a,!1),document.querySelectorAll('div.cell[id^="ai"]').forEach((e=>{e.removeEventListener("click",h)}))))},m=document.querySelector(".startButton");m.addEventListener("click",(()=>{let e=0;for(let t=0;t<100;t+=1)!1!==c.board[t].storedShip&&(e+=1);17===e&&(document.querySelector(".buttons").style.display="none",m.style.display="none",a.randomShips("ai",!0),document.querySelectorAll('div.cell[id^="ai"]').forEach((e=>{e.addEventListener("click",h)})))})),y.addEventListener("click",(()=>{if(p.style.display="none",null===document.querySelector(".axisButton")){(e=>{const t=document.createElement("button");t.classList.add("axisButton"),t.textContent="Horizontal",t.addEventListener("click",(()=>{let o=0;for(let t=0;t<100;t+=1)!1!==e[t].storedShip&&(o+=1);17!==o&&("Vertical"===t.textContent?t.textContent="Horizontal":t.textContent="Vertical")})),document.querySelector(".buttons").appendChild(t)})(c.board);const e=document.querySelectorAll('div.cell[id^="p"]');e.forEach((e=>{e.addEventListener("mouseenter",(e=>{let t=0;for(let e=0;e<100;e+=1)!1!==c.board[e].storedShip&&(t+=1);0===t?i(e,5,!1,c.board):5===t?i(e,4,!1,c.board):9===t||12===t?i(e,3,!1,c.board):15===t&&i(e,2,!1,c.board)}))})),e.forEach((e=>{e.addEventListener("mouseleave",(e=>{i(e,5,!0,c.board)}))})),e.forEach((e=>{e.addEventListener("click",(e=>{let r,l;l="Vertical"===document.querySelector(".axisButton").textContent;let n=0;for(let e=0;e<100;e+=1)!1!==c.board[e].storedShip&&(n+=1);0===n?r=o(5,l):5===n?r=o(4,l):9===n||12===n?r=o(3,l):15===n&&(r=o(2,l));const d=Number(e.target.id.slice(1));if(r.isVertical){for(let e=0;e<10*r.length;e+=10)if(!1!==c.board[d+e].storedShip)return}else for(let e=0;e<r.length;e+=1)if(!1!==c.board[d+e].storedShip)return;"rgb(185, 74, 74)"!==document.querySelector(`#p${d}`).style.background&&(c.placeShip(r,d),t(c.board,"p",!1))}))}))}}))})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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SUosSUFBZEEsRUFDQ2xELEVBQVUsRUFBVyxFQUFHWixHQUNKLElBQWQ4RCxFQUNObEQsRUFBVSxFQUFXLEVBQUdaLEdBQ0osSUFBZDhELEdBRWMsS0FBZEEsRUFETmxELEVBQVUsRUFBVyxFQUFHWixHQUdKLEtBQWQ4RCxJQUNObEQsRUFBVSxFQUFXLEVBQUdaLElBRzVCLE1BQU02QyxFQUFTQyxPQUFPSCxFQUFNSSxPQUFPbEUsR0FBRzZCLE1BQU0sSUFDNUMsR0FBR0UsRUFBUVosWUFDUCxJQUFJLElBQUlQLEVBQUksRUFBR0EsRUFBcUIsR0FBakJtQixFQUFRYixPQUFhTixHQUFLLEdBQ3pDLElBQTJDLElBQXhDc0MsRUFBT3pDLE1BQU11RCxFQUFTcEQsR0FBR0MsV0FDeEIsWUFJUixJQUFJLElBQUlELEVBQUksRUFBR0EsRUFBSW1CLEVBQVFiLE9BQVFOLEdBQUssRUFDcEMsSUFBMkMsSUFBeENzQyxFQUFPekMsTUFBTXVELEVBQVNwRCxHQUFHQyxXQUN4QixPQU13QixxQkFEaEJWLFNBQVNJLGNBQWMsS0FBS3lELEtBQ2pDaEQsTUFBTXVELGFBQ2pCckIsRUFBT2QsVUFBVUwsRUFBU2lDLEdBQzFCLEVBQVlkLEVBQU96QyxNQUFPLEtBQUssR0FDbkMsR0FDSCxHQUVULEkiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9iYXR0bGVzaGlwLy4vc3JjL2Rpc3BsYXlCb2FyZC5qcyIsIndlYnBhY2s6Ly9iYXR0bGVzaGlwLy4vc3JjL3VwZGF0ZUJvYXJkLmpzIiwid2VicGFjazovL2JhdHRsZXNoaXAvLi9zcmMvY3JlYXRlU2hpcC5qcyIsIndlYnBhY2s6Ly9iYXR0bGVzaGlwLy4vc3JjL2NyZWF0ZVJhbmRvbVNoaXBzLmpzIiwid2VicGFjazovL2JhdHRsZXNoaXAvLi9zcmMvZ2FtZUJvYXJkLmpzIiwid2VicGFjazovL2JhdHRsZXNoaXAvLi9zcmMvY3JlYXRlUGxheWVyLmpzIiwid2VicGFjazovL2JhdHRsZXNoaXAvLi9zcmMvZW5kR2FtZS5qcyIsIndlYnBhY2s6Ly9iYXR0bGVzaGlwLy4vc3JjL2Rpc3BsYXlNYW51YWxTaGlwcy5qcyIsIndlYnBhY2s6Ly9iYXR0bGVzaGlwLy4vc3JjL2luZGV4LmpzIiwid2VicGFjazovL2JhdHRsZXNoaXAvLi9zcmMvYWRkQXhpc0J1dHRvbi5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJjb25zdCBkaXNwbGF5Qm9hcmQgPSAoaWQsIHBsYXllcikgPT4ge1xuICAgIGNvbnN0IGNlbGwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICBjZWxsLmNsYXNzTGlzdC5hZGQoJ2NlbGwnKTtcblxuICAgIGlmKHBsYXllciA9PT0gJ3AnKSB7XG4gICAgICAgIGNlbGwuaWQgPSBgJHtwbGF5ZXJ9JHtpZH1gO1xuXG4gICAgICAgIGNvbnN0IHBsYXllckJvYXJkID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnBsYXllckJvYXJkJyk7XG4gICAgICAgIHBsYXllckJvYXJkLmFwcGVuZENoaWxkKGNlbGwpO1xuICAgIH0gZWxzZSBpZihwbGF5ZXIgPT09ICdhaScpIHtcbiAgICAgICAgY2VsbC5pZCA9IGAke3BsYXllcn0ke2lkfWA7XG5cbiAgICAgICAgY29uc3QgYWlCb2FyZCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5haUJvYXJkJyk7XG4gICAgICAgIGFpQm9hcmQuYXBwZW5kQ2hpbGQoY2VsbCk7XG4gICAgfVxufVxuXG5leHBvcnQgZGVmYXVsdCBkaXNwbGF5Qm9hcmQ7IiwiY29uc3QgdXBkYXRlQm9hcmQgPSAoYm9hcmQsIGJvYXJkSWQsIGlzQWlCb2FyZCkgPT4ge1xuICBpZiAoaXNBaUJvYXJkKSB7XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCAxMDA7IGkgKz0gMSkge1xuICAgICAgaWYgKGJvYXJkW2ldLnN0b3JlZFNoaXAgIT09IGZhbHNlICYmIGJvYXJkW2ldLmJlZW5IaXQgPT09IHRydWUpIHtcbiAgICAgICAgY29uc3QgY2VsbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGAke2JvYXJkSWR9JHtpfWApO1xuICAgICAgICBjZWxsLnN0eWxlLmJhY2tncm91bmRDb2xvciA9IFwicmdiKDEzMywgMjU1LCAxNzkpXCI7XG4gICAgICB9IGVsc2UgaWYgKGJvYXJkW2ldLnN0b3JlZFNoaXAgPT09IGZhbHNlICYmIGJvYXJkW2ldLmJlZW5IaXQgPT09IHRydWUpIHtcbiAgICAgICAgY29uc3QgY2VsbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGAke2JvYXJkSWR9JHtpfWApO1xuICAgICAgICBjZWxsLnN0eWxlLmJhY2tncm91bmRDb2xvciA9IFwicmdiKDI1NSwgMTMzLCAxMzMpXCI7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBjb25zdCBjZWxsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoYCR7Ym9hcmRJZH0ke2l9YCk7XG4gICAgICAgIGNlbGwuc3R5bGUuYmFja2dyb3VuZENvbG9yID0gXCJ3aGl0ZVwiO1xuICAgICAgfVxuICAgIH1cbiAgfSBlbHNlIHtcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IDEwMDsgaSArPSAxKSB7XG4gICAgICBpZiAoYm9hcmRbaV0uc3RvcmVkU2hpcCAhPT0gZmFsc2UgJiYgYm9hcmRbaV0uYmVlbkhpdCA9PT0gZmFsc2UpIHtcbiAgICAgICAgY29uc3QgY2VsbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGAke2JvYXJkSWR9JHtpfWApO1xuICAgICAgICBjZWxsLnN0eWxlLmJhY2tncm91bmRDb2xvciA9IFwicmdiKDY4LCA2OCwgNjgpXCI7XG4gICAgICB9IGVsc2UgaWYgKGJvYXJkW2ldLnN0b3JlZFNoaXAgIT09IGZhbHNlICYmIGJvYXJkW2ldLmJlZW5IaXQgPT09IHRydWUpIHtcbiAgICAgICAgY29uc3QgY2VsbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGAke2JvYXJkSWR9JHtpfWApO1xuICAgICAgICBjZWxsLnN0eWxlLmJhY2tncm91bmRDb2xvciA9IFwicmdiKDEzMywgMjU1LCAxNzkpXCI7XG4gICAgICB9IGVsc2UgaWYgKGJvYXJkW2ldLnN0b3JlZFNoaXAgPT09IGZhbHNlICYmIGJvYXJkW2ldLmJlZW5IaXQgPT09IHRydWUpIHtcbiAgICAgICAgY29uc3QgY2VsbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGAke2JvYXJkSWR9JHtpfWApO1xuICAgICAgICBjZWxsLnN0eWxlLmJhY2tncm91bmRDb2xvciA9IFwicmdiKDI1NSwgMTMzLCAxMzMpXCI7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBjb25zdCBjZWxsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoYCR7Ym9hcmRJZH0ke2l9YCk7XG4gICAgICAgIGNlbGwuc3R5bGUuYmFja2dyb3VuZENvbG9yID0gXCJ3aGl0ZVwiO1xuICAgICAgfVxuICAgIH1cbiAgfVxufTtcblxuZXhwb3J0IGRlZmF1bHQgdXBkYXRlQm9hcmQ7XG4iLCJjb25zdCBjcmVhdGVTaGlwID0gKGxlbmd0aCwgaXNWZXJ0aWNhbCkgPT4ge1xuICBjb25zdCBoaXRDb3VudCA9IDA7XG4gIGNvbnN0IHN1bmsgPSBmYWxzZTtcblxuICByZXR1cm4geyBsZW5ndGgsIGhpdENvdW50LCBzdW5rLCBpc1ZlcnRpY2FsIH07XG59O1xuXG5leHBvcnQgZGVmYXVsdCBjcmVhdGVTaGlwOyIsImltcG9ydCBjcmVhdGVTaGlwIGZyb20gXCIuL2NyZWF0ZVNoaXBcIjtcblxuY29uc3QgY3JlYXRlUmFuZG9tU2hpcHMgPSAoYm9hcmQsIHNoaXBMZW5ndGgpID0+IHtcbiAgICBjb25zdCBheGlzRGVjaWRlciA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDIpICsgMTtcbiAgICBjb25zdCBib2FyZENvcHkgPSBbLi4uYm9hcmRdO1xuXG4gICAgaWYoYXhpc0RlY2lkZXIgPT09IDEpIHtcbiAgICAgICAgbGV0IHN0YXJ0aW5nQ29sdW1uO1xuICAgICAgICBsZXQgc3RhcnRpbmdSb3c7XG5cbiAgICAgICAgZG8ge1xuICAgICAgICAgICAgc3RhcnRpbmdDb2x1bW4gPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAoKDEwIC0gc2hpcExlbmd0aCkgKyAxKSk7XG4gICAgICAgICAgICBzdGFydGluZ1JvdyA9IChNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAxMCkpICogMTA7XG4gICAgICAgIH0gd2hpbGUgKFxuICAgICAgICAgICAgYm9hcmRDb3B5LnNsaWNlKHN0YXJ0aW5nUm93ICsgc3RhcnRpbmdDb2x1bW4sIHN0YXJ0aW5nUm93ICsgc3RhcnRpbmdDb2x1bW4gKyBzaGlwTGVuZ3RoKVxuICAgICAgICAgICAgLnNvbWUoY2VsbCA9PiBjZWxsLnN0b3JlZFNoaXApXG4gICAgICAgIClcblxuICAgICAgICBjb25zdCBuZXdTaGlwID0gY3JlYXRlU2hpcChzaGlwTGVuZ3RoLCBmYWxzZSk7XG4gICAgICAgIGZvcihsZXQgaSA9IDA7IGkgPCBzaGlwTGVuZ3RoOyBpICs9IDEpIHtcbiAgICAgICAgICAgIGJvYXJkQ29weVtzdGFydGluZ1JvdyArIHN0YXJ0aW5nQ29sdW1uICsgaV0uc3RvcmVkU2hpcCA9IG5ld1NoaXA7XG4gICAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgICBsZXQgc3RhcnRpbmdDb2x1bW47XG4gICAgICAgIGxldCBzdGFydGluZ1JvdztcbiAgICAgICAgbGV0IGhhc1N0b3JlZFNoaXBcblxuICAgICAgICBkbyB7XG4gICAgICAgICAgICBzdGFydGluZ0NvbHVtbiA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDEwKTtcbiAgICAgICAgICAgIHN0YXJ0aW5nUm93ID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogKCgxMCAtIHNoaXBMZW5ndGgpICsgMSkpICogMTA7XG4gICAgICAgIFxuICAgICAgICAgICAgY29uc3Qgc2xpY2VkQXJyYXkgPSBbXTtcbiAgICAgICAgICAgIGZvciAobGV0IGkgPSBzdGFydGluZ1JvdyArIHN0YXJ0aW5nQ29sdW1uOyBpIDwgc3RhcnRpbmdDb2x1bW4gKyBzdGFydGluZ1JvdyArIChzaGlwTGVuZ3RoICogMTApOyBpICs9IDEwKSB7XG4gICAgICAgICAgICAgICAgc2xpY2VkQXJyYXkucHVzaChib2FyZENvcHlbaV0pO1xuICAgICAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgICAgIGhhc1N0b3JlZFNoaXAgPSBzbGljZWRBcnJheS5zb21lKGNlbGwgPT4gY2VsbC5zdG9yZWRTaGlwKTtcbiAgICAgICAgfSB3aGlsZSAoaGFzU3RvcmVkU2hpcCk7XG5cbiAgICAgICAgY29uc3QgbmV3U2hpcCA9IGNyZWF0ZVNoaXAoc2hpcExlbmd0aCwgdHJ1ZSk7XG4gICAgICAgIGZvcihsZXQgaSA9IDA7IGkgPCBzaGlwTGVuZ3RoICogMTA7IGkgKz0gMTApIHtcbiAgICAgICAgICAgIGJvYXJkQ29weVtzdGFydGluZ1JvdyArIHN0YXJ0aW5nQ29sdW1uICsgaV0uc3RvcmVkU2hpcCA9IG5ld1NoaXA7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gYm9hcmRDb3B5O1xufVxuXG5leHBvcnQgZGVmYXVsdCBjcmVhdGVSYW5kb21TaGlwczsiLCJpbXBvcnQgZGlzcGxheUJvYXJkIGZyb20gXCIuL2Rpc3BsYXlCb2FyZFwiO1xuaW1wb3J0IHVwZGF0ZUJvYXJkIGZyb20gXCIuL3VwZGF0ZUJvYXJkXCI7XG5pbXBvcnQgY3JlYXRlUmFuZG9tU2hpcHMgZnJvbSBcIi4vY3JlYXRlUmFuZG9tU2hpcHNcIjtcblxuY29uc3QgZ2FtZUJvYXJkID0gKCkgPT4ge1xuICBsZXQgYm9hcmQgPSBbXTtcblxuICBjb25zdCBjcmVhdGVCb2FyZCA9IChwbGF5ZXIpID0+IHtcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IDEwMDsgaSArPSAxKSB7XG4gICAgICBib2FyZFtpXSA9IHsgc3RvcmVkU2hpcDogZmFsc2UsIGJlZW5IaXQ6IGZhbHNlIH07XG4gICAgICBkaXNwbGF5Qm9hcmQoaSwgcGxheWVyKTtcbiAgICB9XG4gIH07XG5cbiAgY29uc3QgcGxhY2VTaGlwID0gKHNoaXAsIHN0YXJ0KSA9PiB7XG4gICAgaWYgKHNoaXAuaXNWZXJ0aWNhbCkge1xuICAgICAgZm9yIChsZXQgaSA9IHN0YXJ0OyBpIDwgc3RhcnQgKyBzaGlwLmxlbmd0aCAqIDEwOyBpICs9IDEwKSB7XG4gICAgICAgIGJvYXJkW2ldLnN0b3JlZFNoaXAgPSBzaGlwO1xuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICBmb3IgKGxldCBpID0gc3RhcnQ7IGkgPCBzdGFydCArIHNoaXAubGVuZ3RoOyBpICs9IDEpIHtcbiAgICAgICAgYm9hcmRbaV0uc3RvcmVkU2hpcCA9IHNoaXA7XG4gICAgICB9XG4gICAgfVxuICB9O1xuXG4gIGNvbnN0IHJhbmRvbVNoaXBzID0gKGJvYXJkSWQsIGlzQWlCb2FyZCkgPT4ge1xuICAgIGxldCBib2FyZENvcHkgPSBbLi4uYm9hcmRdO1xuXG4gICAgZm9yKGxldCBpID0gMDsgaSA8IDEwMDsgaSArPSAxKSB7XG4gICAgICBib2FyZENvcHlbaV0uc3RvcmVkU2hpcCA9IGZhbHNlO1xuICAgIH1cblxuICAgIGJvYXJkQ29weSA9IGNyZWF0ZVJhbmRvbVNoaXBzKGJvYXJkLCA1KTtcbiAgICBib2FyZENvcHkgPSBjcmVhdGVSYW5kb21TaGlwcyhib2FyZCwgNCk7XG4gICAgYm9hcmRDb3B5ID0gY3JlYXRlUmFuZG9tU2hpcHMoYm9hcmQsIDMpO1xuICAgIGJvYXJkQ29weSA9IGNyZWF0ZVJhbmRvbVNoaXBzKGJvYXJkLCAzKTtcbiAgICBib2FyZENvcHkgPSBjcmVhdGVSYW5kb21TaGlwcyhib2FyZCwgMik7XG5cbiAgICB1cGRhdGVCb2FyZChib2FyZENvcHksIGJvYXJkSWQsIGlzQWlCb2FyZCk7XG4gICAgYm9hcmQgPSBib2FyZENvcHk7XG4gIH1cblxuICBjb25zdCByZWNlaXZlQXR0YWNrID0gKGNvcmRpbmF0ZXMsIGJvYXJkSWQsIGlzQWlCb2FyZCkgPT4ge1xuICAgIGlmIChib2FyZFtjb3JkaW5hdGVzXS5zdG9yZWRTaGlwICE9PSBmYWxzZSkge1xuICAgICAgYm9hcmRbY29yZGluYXRlc10uYmVlbkhpdCA9IHRydWU7XG5cbiAgICAgIGxldCBuZXdIaXRDb3VudCA9IGJvYXJkW2NvcmRpbmF0ZXNdLnN0b3JlZFNoaXAuaGl0Q291bnQ7XG4gICAgICBuZXdIaXRDb3VudCArPSAxO1xuICAgICAgYm9hcmRbY29yZGluYXRlc10uc3RvcmVkU2hpcC5oaXRDb3VudCA9IG5ld0hpdENvdW50O1xuICAgICAgaWYoYm9hcmRbY29yZGluYXRlc10uc3RvcmVkU2hpcC5oaXRDb3VudCA9PT0gYm9hcmRbY29yZGluYXRlc10uc3RvcmVkU2hpcC5sZW5ndGgpIHtcbiAgICAgICAgYm9hcmRbY29yZGluYXRlc10uc3RvcmVkU2hpcC5zdW5rID0gdHJ1ZTtcbiAgICAgIH1cblxuICAgICAgdXBkYXRlQm9hcmQoYm9hcmQsIGJvYXJkSWQsIGlzQWlCb2FyZCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGJvYXJkW2NvcmRpbmF0ZXNdLmJlZW5IaXQgPSB0cnVlO1xuICAgICAgdXBkYXRlQm9hcmQoYm9hcmQsIGJvYXJkSWQsIGlzQWlCb2FyZCk7XG4gICAgfVxuICB9O1xuXG4gIGNvbnN0IGFsbFNoaXBzU3VuayA9ICgpID0+IHtcbiAgICBmb3IobGV0IGk9MDsgaSA8IDEwMDsgaSArPSAxKSB7XG4gICAgICBpZihib2FyZFtpXS5zdG9yZWRTaGlwICE9PSBmYWxzZSAmJiBib2FyZFtpXS5iZWVuSGl0ID09PSBmYWxzZSkge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIHRydWU7XG4gIH1cblxuICBjb25zdCByZXNldEJvYXJkID0gKCkgPT4ge1xuICAgIGZvcihsZXQgaT0wOyBpIDwgMTAwOyBpICs9IDEpIHtcbiAgICAgIGJvYXJkW2ldLnN0b3JlZFNoaXAgPSBmYWxzZTtcbiAgICAgIGJvYXJkW2ldLmJlZW5IaXQgPSBmYWxzZTtcbiAgICB9XG4gIH1cblxuICByZXR1cm4geyBib2FyZCwgY3JlYXRlQm9hcmQsIHBsYWNlU2hpcCwgcmVjZWl2ZUF0dGFjaywgYWxsU2hpcHNTdW5rLCByYW5kb21TaGlwcywgcmVzZXRCb2FyZCB9O1xufTtcblxuZXhwb3J0IGRlZmF1bHQgZ2FtZUJvYXJkOyIsImNvbnN0IGNyZWF0ZVBsYXllciA9IChuYW1lLCBvcHBCb2FyZCkgPT4ge1xuXG4gICAgY29uc3QgYXR0YWNrID0gKGNvcmRpbmF0ZXMsIGJvYXJkSWQsIGlzQWlCb2FyZCkgPT4ge1xuICAgICAgICBvcHBCb2FyZC5yZWNlaXZlQXR0YWNrKGNvcmRpbmF0ZXMsIGJvYXJkSWQsIGlzQWlCb2FyZCk7XG4gICAgfVxuXG4gICAgY29uc3QgYWlBdHRhY2sgPSAoKSA9PiB7XG4gICAgICAgIGxldCByYW5kb21OdW1iZXI7XG4gICAgICAgIGRvIHtcbiAgICAgICAgICAgIHJhbmRvbU51bWJlciA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDk5KTtcbiAgICAgICAgfSB3aGlsZSAob3BwQm9hcmQuYm9hcmRbcmFuZG9tTnVtYmVyXS5iZWVuSGl0KTtcblxuICAgICAgICBvcHBCb2FyZC5yZWNlaXZlQXR0YWNrKHJhbmRvbU51bWJlciwgJ3AnLCBmYWxzZSk7XG4gICAgfVxuXG4gICAgcmV0dXJuIHsgbmFtZSwgb3BwQm9hcmQsIGF0dGFjaywgYWlBdHRhY2sgfVxufVxuXG5leHBvcnQgZGVmYXVsdCBjcmVhdGVQbGF5ZXI7IiwiaW1wb3J0IHVwZGF0ZUJvYXJkIGZyb20gXCIuL3VwZGF0ZUJvYXJkXCI7XG5cbmNvbnN0IGVuZEdhbWUgPSAocEJvYXJkLCBhaUJvYXJkLCBpc1BsYXllcldvbikgPT4ge1xuICAgIGlmKGlzUGxheWVyV29uKSB7XG4gICAgICAgIGNvbnN0IHdpbm5lclRleHQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcud2lubmVyVGV4dCcpO1xuICAgICAgICB3aW5uZXJUZXh0LnRleHRDb250ZW50ID0gJ1lvdSBXb24gRG8gWW91IFdhbnQgVG8gUGxheSBBZ2Fpbj8nO1xuICAgIH0gZWxzZSB7XG4gICAgICAgIGNvbnN0IHdpbm5lclRleHQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcud2lubmVyVGV4dCcpO1xuICAgICAgICB3aW5uZXJUZXh0LnRleHRDb250ZW50ID0gJ0FpIFdvbiBEbyBZb3UgV2FudCBUbyBQbGF5IEFnYWluJztcbiAgICB9XG5cbiAgICBjb25zdCB3aW5CYWNrZ3JvdW5kID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLndpbkJhY2tncm91bmQnKTtcbiAgICB3aW5CYWNrZ3JvdW5kLnN0eWxlLmRpc3BsYXkgPSAnZmxleCc7XG5cbiAgICBjb25zdCByZXN0YXJ0QnV0dG9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnJlc3RhcnRCdXR0b24nKTtcbiAgICByZXN0YXJ0QnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4ge1xuICAgICAgICBwQm9hcmQucmVzZXRCb2FyZCgpO1xuICAgICAgICB1cGRhdGVCb2FyZChwQm9hcmQuYm9hcmQsICdwJywgZmFsc2UpO1xuXG4gICAgICAgIGFpQm9hcmQucmVzZXRCb2FyZCgpO1xuICAgICAgICB1cGRhdGVCb2FyZChhaUJvYXJkLmJvYXJkLCAnYWknLCB0cnVlKTtcblxuICAgICAgICBjb25zdCBidXR0b25zRGl2ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmJ1dHRvbnMnKTtcbiAgICAgICAgYnV0dG9uc0Rpdi5zdHlsZS5kaXNwbGF5ID0gJ2ZsZXgnO1xuXG4gICAgICAgIGNvbnN0IHN0YXJ0QnV0dG9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnN0YXJ0QnV0dG9uJyk7XG4gICAgICAgIHN0YXJ0QnV0dG9uLnN0eWxlLmRpc3BsYXkgPSAnZmxleCc7XG5cbiAgICAgICAgY29uc3QgbWFudWFsQnV0dG9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLm1hbnVhbCcpO1xuICAgICAgICBtYW51YWxCdXR0b24uc3R5bGUuZGlzcGxheSA9ICdmbGV4JztcbiAgICAgICAgbWFudWFsQnV0dG9uLnN0eWxlLnJlbW92ZVByb3BlcnR5KCdtYXJnaW4tbGVmdCcpO1xuXG4gICAgICAgIGNvbnN0IHBsYWNlUmFuZG9tQnV0dG9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnJhbmRvbScpO1xuICAgICAgICBwbGFjZVJhbmRvbUJ1dHRvbi5zdHlsZS5kaXNwbGF5ID0gJ2ZsZXgnO1xuICAgICAgICBwbGFjZVJhbmRvbUJ1dHRvbi5zdHlsZS5yZW1vdmVQcm9wZXJ0eSgnbWFyZ2luLWxlZnQnKTtcblxuICAgICAgICBjb25zdCBheGlzQnV0dG9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmF4aXNCdXR0b24nKTtcbiAgICAgICAgaWYoYXhpc0J1dHRvbiAhPT0gbnVsbCkge1xuICAgICAgICAgICAgYXhpc0J1dHRvbi5yZW1vdmUoKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHdpbkJhY2tncm91bmQuc3R5bGUuZGlzcGxheSA9ICdub25lJztcbiAgICB9KVxufVxuXG5leHBvcnQgZGVmYXVsdCBlbmRHYW1lOyIsImNvbnN0IGRpc3BsYXlNYW51YWxTaGlwcyA9IChldmVudCwgc2hpcExlbmd0aCwgcmV2ZXJ0LCBib2FyZCkgPT4ge1xuICAgIGNvbnN0IGF4aXNCdXR0b24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuYXhpc0J1dHRvbicpO1xuICAgIGNvbnN0IGNlbGxJZCA9IE51bWJlcihldmVudC50YXJnZXQuaWQuc2xpY2UoMSkpO1xuICAgIGNvbnN0IGNvbHVtbkluZGV4ID0gY2VsbElkICUgMTA7XG4gICAgY29uc3Qgcm93SW5kZXggPSBNYXRoLmZsb29yKGNlbGxJZCAvIDEwKTtcblxuICAgIGNvbnN0IHN0YXJ0QnV0dG9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnN0YXJ0QnV0dG9uJyk7XG4gICAgaWYoc3RhcnRCdXR0b24uc3R5bGUuZGlzcGxheSAhPT0gJ25vbmUnKSB7XG4gICAgICAgIGlmKHJldmVydCkge1xuXG4gICAgICAgICAgICBpZihheGlzQnV0dG9uLnRleHRDb250ZW50ID09PSAnSG9yaXpvbnRhbCcpIHtcbiAgICAgICAgICAgICAgICBjb25zdCB1bnZhbGlkQ2VsbHMgPSBjb2x1bW5JbmRleCAtIHNoaXBMZW5ndGg7XG4gICAgICAgICAgICAgICAgaWYodW52YWxpZENlbGxzID4gMCkge1xuICAgICAgICAgICAgICAgICAgICBmb3IobGV0IGkgPSAwOyBpIDwgc2hpcExlbmd0aCAtIHVudmFsaWRDZWxsczsgaSArPSAxKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBjZWxsUmV2ZXJ0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihgI3Ake2NlbGxJZCArIGl9YCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZihib2FyZFtjZWxsSWQgKyBpXS5zdG9yZWRTaGlwID09PSBmYWxzZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNlbGxSZXZlcnQuc3R5bGUuYmFja2dyb3VuZENvbG9yID0gJ3doaXRlJztcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGZvcihsZXQgaSA9IDA7IGkgPCBzaGlwTGVuZ3RoOyBpICs9IDEpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGNlbGxSZXZlcnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGAjcCR7Y2VsbElkICsgaX1gKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmKGJvYXJkW2NlbGxJZCArIGldLnN0b3JlZFNoaXAgPT09IGZhbHNlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2VsbFJldmVydC5zdHlsZS5iYWNrZ3JvdW5kQ29sb3IgPSAnd2hpdGUnO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSBlbHNlIGlmKGF4aXNCdXR0b24udGV4dENvbnRlbnQgPT09ICdWZXJ0aWNhbCcpIHtcbiAgICAgICAgICAgICAgICBjb25zdCB1bnZhbGlkQ2VsbHMgPSByb3dJbmRleCAtIHNoaXBMZW5ndGg7XG4gICAgICAgICAgICAgICAgaWYodW52YWxpZENlbGxzID4gMCkge1xuICAgICAgICAgICAgICAgICAgICBmb3IobGV0IGkgPSAwOyBpIDwgKHNoaXBMZW5ndGggKiAxMCkgLSAodW52YWxpZENlbGxzICogMTApOyBpICs9IDEwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBjZWxsUmV2ZXJ0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihgI3Ake2NlbGxJZCArIGl9YCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZihib2FyZFtjZWxsSWQgKyBpXS5zdG9yZWRTaGlwID09PSBmYWxzZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNlbGxSZXZlcnQuc3R5bGUuYmFja2dyb3VuZENvbG9yID0gJ3doaXRlJztcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGZvcihsZXQgaSA9IDA7IGkgPCAoc2hpcExlbmd0aCAqIDEwKTsgaSArPSAxMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgY2VsbFJldmVydCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYCNwJHtjZWxsSWQgKyBpfWApO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYoYm9hcmRbY2VsbElkICsgaV0uc3RvcmVkU2hpcCA9PT0gZmFsc2UpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjZWxsUmV2ZXJ0LnN0eWxlLmJhY2tncm91bmRDb2xvciA9ICd3aGl0ZSc7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBcbiAgICBcbiAgICAgICAgfSBlbHNlIGlmKGF4aXNCdXR0b24udGV4dENvbnRlbnQgPT09ICdIb3Jpem9udGFsJykge1xuICAgIFxuICAgICAgICAgICAgY29uc3QgdW52YWxpZENlbGxzID0gKDkgLSBjb2x1bW5JbmRleCkgKyAxO1xuICAgICAgICAgICAgaWYoY29sdW1uSW5kZXggPiAoOSAtIHNoaXBMZW5ndGgpICsgMSkge1xuICAgICAgICAgICAgICAgIFxuICAgIFxuICAgICAgICAgICAgICAgIGZvcihsZXQgaSA9IDA7IGkgPCB1bnZhbGlkQ2VsbHM7IGkgKz0gMSkge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBjZWxsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihgI3Ake2NlbGxJZCArIGl9YCk7XG4gICAgICAgICAgICAgICAgICAgIGlmKGJvYXJkW2NlbGxJZCArIGldLnN0b3JlZFNoaXAgPT09IGZhbHNlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjZWxsLnN0eWxlLmJhY2tncm91bmQgPSAncmdiKDE4NSwgNzQsIDc0KSc7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGZvcihsZXQgaSA9IDA7IGkgPCBzaGlwTGVuZ3RoOyBpICs9IDEpIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgY2VsbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYCNwJHtjZWxsSWQgKyBpfWApO1xuICAgICAgICAgICAgICAgICAgICBpZihib2FyZFtjZWxsSWQgKyBpXS5zdG9yZWRTaGlwID09PSBmYWxzZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgY2VsbC5zdHlsZS5iYWNrZ3JvdW5kID0gJ2xpbWUnO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgIFxuICAgICAgICB9IGVsc2UgaWYoYXhpc0J1dHRvbi50ZXh0Q29udGVudCA9PT0gJ1ZlcnRpY2FsJyl7XG4gICAgXG4gICAgICAgICAgICBjb25zdCB1bnZhbGlkQ2VsbHMgPSAoOSAtIHJvd0luZGV4KSArIDE7XG4gICAgICAgICAgICBpZihyb3dJbmRleCA+ICg5IC0gc2hpcExlbmd0aCkgKyAxKSB7XG4gICAgICAgICAgICAgICAgZm9yKGxldCBpID0gMDsgaSA8IHVudmFsaWRDZWxscyAqIDEwOyBpICs9IDEwKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGNlbGwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGAjcCR7Y2VsbElkICsgaX1gKTtcbiAgICAgICAgICAgICAgICAgICAgaWYoYm9hcmRbY2VsbElkICsgaV0uc3RvcmVkU2hpcCA9PT0gZmFsc2UpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNlbGwuc3R5bGUuYmFja2dyb3VuZCA9ICdyZ2IoMTg1LCA3NCwgNzQpJztcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgZm9yKGxldCBpID0gMDsgaSA8IHNoaXBMZW5ndGggKiAxMDsgaSArPSAxMCkge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBjZWxsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihgI3Ake2NlbGxJZCArIGl9YCk7XG4gICAgICAgICAgICAgICAgICAgIGlmKGJvYXJkW2NlbGxJZCArIGldLnN0b3JlZFNoaXAgPT09IGZhbHNlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjZWxsLnN0eWxlLmJhY2tncm91bmQgPSAnbGltZSc7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBcbiAgICAgICAgfVxuICAgIH1cblxufVxuXG5leHBvcnQgZGVmYXVsdCBkaXNwbGF5TWFudWFsU2hpcHM7IiwiaW1wb3J0IGdhbWVCb2FyZCBmcm9tIFwiLi9nYW1lQm9hcmRcIjtcbmltcG9ydCBjcmVhdGVQbGF5ZXIgZnJvbSBcIi4vY3JlYXRlUGxheWVyXCI7XG5pbXBvcnQgZW5kR2FtZSBmcm9tIFwiLi9lbmRHYW1lXCI7XG5pbXBvcnQgYWRkQXhpc0J1dHRvbiBmcm9tIFwiLi9hZGRBeGlzQnV0dG9uXCI7XG5pbXBvcnQgZGlzcGxheU1hbnVhbFNoaXBzIGZyb20gXCIuL2Rpc3BsYXlNYW51YWxTaGlwc1wiO1xuaW1wb3J0IGNyZWF0ZVNoaXAgZnJvbSBcIi4vY3JlYXRlU2hpcFwiO1xuaW1wb3J0IHVwZGF0ZUJvYXJkIGZyb20gXCIuL3VwZGF0ZUJvYXJkXCI7XG5cblxuY29uc3QgcEJvYXJkID0gZ2FtZUJvYXJkKCk7XG5wQm9hcmQuY3JlYXRlQm9hcmQoJ3AnKTtcbmNvbnN0IGFpQm9hcmQgPSBnYW1lQm9hcmQoKTtcbmFpQm9hcmQuY3JlYXRlQm9hcmQoJ2FpJyk7XG5cbmNvbnN0IHBsYXllciA9IGNyZWF0ZVBsYXllcigncGxheWVyJywgYWlCb2FyZCk7XG5jb25zdCBhaSA9IGNyZWF0ZVBsYXllcignYWknLCBwQm9hcmQpO1xuXG5jb25zdCBwbGFjZVJhbmRvbUJ1dHRvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5yYW5kb20nKTtcbmNvbnN0IHBsYWNlTWFudWFsbHlCdXR0b24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcubWFudWFsJyk7XG5cbnBsYWNlUmFuZG9tQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4ge1xuICAgIHBsYWNlTWFudWFsbHlCdXR0b24uc3R5bGUuZGlzcGxheSA9ICdub25lJztcblxuICAgIHBsYWNlUmFuZG9tQnV0dG9uLnN0eWxlLm1hcmdpbkxlZnQgPSAnMTE1cHgnO1xuXG4gICAgcEJvYXJkLnJhbmRvbVNoaXBzKCdwJywgZmFsc2UpO1xufSlcblxuY29uc3QgaGFuZGxlQ2xpY2sgPSAoZXZlbnQpID0+IHtcbiAgICBjb25zdCBpbmRleCA9IE51bWJlcihldmVudC50YXJnZXQuaWQuc2xpY2UoMikpXG4gICAgXG4gICAgaWYoYWlCb2FyZC5ib2FyZFtpbmRleF0uYmVlbkhpdCA9PT0gZmFsc2UpIHtcbiAgICAgICAgcGxheWVyLmF0dGFjayhpbmRleCwgJ2FpJywgdHJ1ZSk7XG4gICAgICAgIGNvbnN0IGlzUGxheWVyV29uID0gYWlCb2FyZC5hbGxTaGlwc1N1bmsoKTtcbiAgICAgICAgaWYoaXNQbGF5ZXJXb24pIHtcbiAgICAgICAgICAgIGVuZEdhbWUocEJvYXJkLCBhaUJvYXJkLCB0cnVlKTtcblxuICAgICAgICAgICAgY29uc3QgYWxsQ2VsbHMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCdkaXYuY2VsbFtpZF49XCJhaVwiXScpO1xuICAgICAgICAgICAgYWxsQ2VsbHMuZm9yRWFjaCgoY2VsbCkgPT4ge1xuICAgICAgICAgICAgICAgIGNlbGwucmVtb3ZlRXZlbnRMaXN0ZW5lcignY2xpY2snLCBoYW5kbGVDbGljayk7XG4gICAgICAgICAgICB9KVxuICAgICAgICB9XG5cbiAgICAgICAgYWkuYWlBdHRhY2soKTtcbiAgICAgICAgY29uc3QgaXNBaVdvbiA9IHBCb2FyZC5hbGxTaGlwc1N1bmsoKTtcbiAgICAgICAgaWYoaXNBaVdvbikge1xuICAgICAgICAgICAgZW5kR2FtZShwQm9hcmQsIGFpQm9hcmQsIGZhbHNlKTtcblxuICAgICAgICAgICAgY29uc3QgYWxsQ2VsbHMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCdkaXYuY2VsbFtpZF49XCJhaVwiXScpO1xuICAgICAgICAgICAgYWxsQ2VsbHMuZm9yRWFjaCgoY2VsbCkgPT4ge1xuICAgICAgICAgICAgICAgIGNlbGwucmVtb3ZlRXZlbnRMaXN0ZW5lcignY2xpY2snLCBoYW5kbGVDbGljayk7XG4gICAgICAgICAgICB9KVxuICAgICAgICB9XG4gICAgfVxufVxuXG5jb25zdCBzdGFydEJ1dHRvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5zdGFydEJ1dHRvbicpO1xuc3RhcnRCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7XG5cbiAgICBsZXQgc2hpcENlbGxzID0gMDtcbiAgICBmb3IobGV0IGkgPSAwOyBpIDwgMTAwOyBpICs9IDEpIHtcbiAgICAgICAgaWYocEJvYXJkLmJvYXJkW2ldLnN0b3JlZFNoaXAgIT09IGZhbHNlKSB7XG4gICAgICAgICAgICBzaGlwQ2VsbHMgKz0gMTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGlmKHNoaXBDZWxscyA9PT0gMTcpIHtcbiAgICAgICAgY29uc3QgYnV0dG9uc0RpdiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5idXR0b25zJyk7XG4gICAgICAgIGJ1dHRvbnNEaXYuc3R5bGUuZGlzcGxheSA9ICdub25lJztcbiAgICAgICAgc3RhcnRCdXR0b24uc3R5bGUuZGlzcGxheSA9ICdub25lJztcblxuXG4gICAgICAgIGFpQm9hcmQucmFuZG9tU2hpcHMoJ2FpJywgdHJ1ZSk7XG5cbiAgICAgICAgY29uc3QgYWxsQ2VsbHMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCdkaXYuY2VsbFtpZF49XCJhaVwiXScpO1xuICAgICAgICBhbGxDZWxscy5mb3JFYWNoKChjZWxsKSA9PiB7XG4gICAgICAgICAgICBjZWxsLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgaGFuZGxlQ2xpY2spO1xuICAgICAgICB9KVxuICAgIH1cbn0pXG5cbnBsYWNlTWFudWFsbHlCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7XG5cbiAgICBwbGFjZVJhbmRvbUJ1dHRvbi5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnO1xuXG4gICAgY29uc3QgYXhpc0J1dHRvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5heGlzQnV0dG9uJyk7XG4gICAgaWYoYXhpc0J1dHRvbiA9PT0gbnVsbCkge1xuICAgICAgICBhZGRBeGlzQnV0dG9uKHBCb2FyZC5ib2FyZCk7XG5cbiAgICAgICAgY29uc3QgYWxsUGxheWVyQ2VsbHMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCdkaXYuY2VsbFtpZF49XCJwXCJdJyk7XG4gICAgICAgIGFsbFBsYXllckNlbGxzLmZvckVhY2goKGNlbGwpID0+IHtcbiAgICAgICAgICAgIGNlbGwuYWRkRXZlbnRMaXN0ZW5lcignbW91c2VlbnRlcicsIChldmVudCkgPT4ge1xuICAgICAgICAgICAgICAgIGxldCBzaGlwQ2VsbHMgPSAwO1xuICAgICAgICAgICAgICAgIGZvcihsZXQgaSA9IDA7IGkgPCAxMDA7IGkgKz0gMSkge1xuICAgICAgICAgICAgICAgICAgICBpZihwQm9hcmQuYm9hcmRbaV0uc3RvcmVkU2hpcCAhPT0gZmFsc2UpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNoaXBDZWxscyArPSAxO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgaWYoc2hpcENlbGxzID09PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgIGRpc3BsYXlNYW51YWxTaGlwcyhldmVudCwgNSwgZmFsc2UsIHBCb2FyZC5ib2FyZCk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmKHNoaXBDZWxscyA9PT0gNSkge1xuICAgICAgICAgICAgICAgICAgICBkaXNwbGF5TWFudWFsU2hpcHMoZXZlbnQsIDQsIGZhbHNlLCBwQm9hcmQuYm9hcmQpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSBpZihzaGlwQ2VsbHMgPT09IDkpIHtcbiAgICAgICAgICAgICAgICAgICAgZGlzcGxheU1hbnVhbFNoaXBzKGV2ZW50LCAzLCBmYWxzZSwgcEJvYXJkLmJvYXJkKTtcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYoc2hpcENlbGxzID09PSAxMikge1xuICAgICAgICAgICAgICAgICAgICBkaXNwbGF5TWFudWFsU2hpcHMoZXZlbnQsIDMsIGZhbHNlLCBwQm9hcmQuYm9hcmQpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSBpZihzaGlwQ2VsbHMgPT09IDE1KSB7XG4gICAgICAgICAgICAgICAgICAgIGRpc3BsYXlNYW51YWxTaGlwcyhldmVudCwgMiwgZmFsc2UsIHBCb2FyZC5ib2FyZCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSlcbiAgICAgICAgfSlcblxuICAgICAgICBhbGxQbGF5ZXJDZWxscy5mb3JFYWNoKChjZWxsKSA9PiB7XG4gICAgICAgICAgICBjZWxsLmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNlbGVhdmUnLCAoZXZlbnQpID0+IHtcbiAgICAgICAgICAgICAgICBkaXNwbGF5TWFudWFsU2hpcHMoZXZlbnQsIDUsIHRydWUsIHBCb2FyZC5ib2FyZCk7XG4gICAgICAgICAgICB9KVxuICAgICAgICB9KVxuXG4gICAgICAgIGFsbFBsYXllckNlbGxzLmZvckVhY2goKGNlbGwpID0+IHtcbiAgICAgICAgICAgIGNlbGwuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoZXZlbnQpID0+IHtcbiAgICAgICAgICAgICAgICBsZXQgbmV3U2hpcDtcbiAgICAgICAgICAgICAgICBsZXQgaXNWZXJ0aWNhbDtcbiAgICAgICAgICAgICAgICBjb25zdCBhZGRlZEF4aXNCdXR0b24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuYXhpc0J1dHRvbicpO1xuXG4gICAgICAgICAgICAgICAgaWYoYWRkZWRBeGlzQnV0dG9uLnRleHRDb250ZW50ID09PSAnVmVydGljYWwnKSB7XG4gICAgICAgICAgICAgICAgICAgIGlzVmVydGljYWwgPSB0cnVlO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGlzVmVydGljYWwgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBsZXQgc2hpcENlbGxzID0gMDtcbiAgICAgICAgICAgICAgICBmb3IobGV0IGkgPSAwOyBpIDwgMTAwOyBpICs9IDEpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYocEJvYXJkLmJvYXJkW2ldLnN0b3JlZFNoaXAgIT09IGZhbHNlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzaGlwQ2VsbHMgKz0gMTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGlmKHNoaXBDZWxscyA9PT0gMCkge1xuICAgICAgICAgICAgICAgICAgICBuZXdTaGlwID0gY3JlYXRlU2hpcCg1LCBpc1ZlcnRpY2FsKTtcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYoc2hpcENlbGxzID09PSA1KSB7XG4gICAgICAgICAgICAgICAgICAgIG5ld1NoaXAgPSBjcmVhdGVTaGlwKDQsIGlzVmVydGljYWwpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSBpZihzaGlwQ2VsbHMgPT09IDkpIHtcbiAgICAgICAgICAgICAgICAgICAgbmV3U2hpcCA9IGNyZWF0ZVNoaXAoMywgaXNWZXJ0aWNhbCk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmKHNoaXBDZWxscyA9PT0gMTIpIHtcbiAgICAgICAgICAgICAgICAgICAgbmV3U2hpcCA9IGNyZWF0ZVNoaXAoMywgaXNWZXJ0aWNhbCk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmKHNoaXBDZWxscyA9PT0gMTUpIHtcbiAgICAgICAgICAgICAgICAgICAgbmV3U2hpcCA9IGNyZWF0ZVNoaXAoMiwgaXNWZXJ0aWNhbCk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgY29uc3QgY2VsbElkID0gTnVtYmVyKGV2ZW50LnRhcmdldC5pZC5zbGljZSgxKSk7XG4gICAgICAgICAgICAgICAgaWYobmV3U2hpcC5pc1ZlcnRpY2FsKSB7XG4gICAgICAgICAgICAgICAgICAgIGZvcihsZXQgaSA9IDA7IGkgPCBuZXdTaGlwLmxlbmd0aCAqIDEwOyBpICs9IDEwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZihwQm9hcmQuYm9hcmRbY2VsbElkICsgaV0uc3RvcmVkU2hpcCAhPT0gZmFsc2UpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBmb3IobGV0IGkgPSAwOyBpIDwgbmV3U2hpcC5sZW5ndGg7IGkgKz0gMSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYocEJvYXJkLmJvYXJkW2NlbGxJZCArIGldLnN0b3JlZFNoaXAgIT09IGZhbHNlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgY29uc3QgY2xpY2tlZENlbGwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGAjcCR7Y2VsbElkfWApO1xuICAgICAgICAgICAgICAgIGlmKGNsaWNrZWRDZWxsLnN0eWxlLmJhY2tncm91bmQgIT09ICdyZ2IoMTg1LCA3NCwgNzQpJykge1xuICAgICAgICAgICAgICAgICAgICBwQm9hcmQucGxhY2VTaGlwKG5ld1NoaXAsIGNlbGxJZCk7XG4gICAgICAgICAgICAgICAgICAgIHVwZGF0ZUJvYXJkKHBCb2FyZC5ib2FyZCwgJ3AnLCBmYWxzZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSlcbiAgICAgICAgfSlcbiAgICB9XG59KVxuIiwiY29uc3QgYWRkQXhpc0J1dHRvbiA9IChib2FyZCkgPT4ge1xuICAgIGNvbnN0IGJ1dHRvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2J1dHRvbicpO1xuICAgIGJ1dHRvbi5jbGFzc0xpc3QuYWRkKCdheGlzQnV0dG9uJyk7XG4gICAgYnV0dG9uLnRleHRDb250ZW50ID0gJ0hvcml6b250YWwnO1xuXG4gICAgYnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4ge1xuICAgICAgICBsZXQgdG90YWxTaGlwcyA9IDA7XG4gICAgICAgIGZvcihsZXQgaSA9IDA7IGkgPCAxMDA7IGkgKz0gMSkge1xuICAgICAgICAgICAgaWYoYm9hcmRbaV0uc3RvcmVkU2hpcCAhPT0gZmFsc2UpIHtcbiAgICAgICAgICAgICAgICB0b3RhbFNoaXBzICs9IDE7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgaWYodG90YWxTaGlwcyAhPT0gMTcpIHtcbiAgICAgICAgICAgIGlmKGJ1dHRvbi50ZXh0Q29udGVudCA9PT0gJ1ZlcnRpY2FsJykge1xuICAgICAgICAgICAgICAgIGJ1dHRvbi50ZXh0Q29udGVudCA9ICdIb3Jpem9udGFsJztcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgYnV0dG9uLnRleHRDb250ZW50ID0gJ1ZlcnRpY2FsJztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH0pXG5cbiAgICBjb25zdCBidXR0b25zRGl2ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmJ1dHRvbnMnKTtcbiAgICBidXR0b25zRGl2LmFwcGVuZENoaWxkKGJ1dHRvbik7XG59XG5cbmV4cG9ydCBkZWZhdWx0IGFkZEF4aXNCdXR0b247Il0sIm5hbWVzIjpbImlkIiwicGxheWVyIiwiY2VsbCIsImRvY3VtZW50IiwiY3JlYXRlRWxlbWVudCIsImNsYXNzTGlzdCIsImFkZCIsInF1ZXJ5U2VsZWN0b3IiLCJhcHBlbmRDaGlsZCIsImJvYXJkIiwiYm9hcmRJZCIsImlzQWlCb2FyZCIsImkiLCJzdG9yZWRTaGlwIiwiYmVlbkhpdCIsImdldEVsZW1lbnRCeUlkIiwic3R5bGUiLCJiYWNrZ3JvdW5kQ29sb3IiLCJsZW5ndGgiLCJpc1ZlcnRpY2FsIiwiaGl0Q291bnQiLCJzdW5rIiwic2hpcExlbmd0aCIsImJvYXJkQ29weSIsIk1hdGgiLCJmbG9vciIsInJhbmRvbSIsInN0YXJ0aW5nQ29sdW1uIiwic3RhcnRpbmdSb3ciLCJzbGljZSIsInNvbWUiLCJuZXdTaGlwIiwiaGFzU3RvcmVkU2hpcCIsInNsaWNlZEFycmF5IiwicHVzaCIsImNyZWF0ZUJvYXJkIiwicGxhY2VTaGlwIiwic2hpcCIsInN0YXJ0IiwicmVjZWl2ZUF0dGFjayIsImNvcmRpbmF0ZXMiLCJuZXdIaXRDb3VudCIsImFsbFNoaXBzU3VuayIsInJhbmRvbVNoaXBzIiwicmVzZXRCb2FyZCIsIm5hbWUiLCJvcHBCb2FyZCIsImF0dGFjayIsImFpQXR0YWNrIiwicmFuZG9tTnVtYmVyIiwicEJvYXJkIiwiYWlCb2FyZCIsImlzUGxheWVyV29uIiwidGV4dENvbnRlbnQiLCJ3aW5CYWNrZ3JvdW5kIiwiZGlzcGxheSIsImFkZEV2ZW50TGlzdGVuZXIiLCJtYW51YWxCdXR0b24iLCJyZW1vdmVQcm9wZXJ0eSIsInBsYWNlUmFuZG9tQnV0dG9uIiwiYXhpc0J1dHRvbiIsInJlbW92ZSIsImV2ZW50IiwicmV2ZXJ0IiwiY2VsbElkIiwiTnVtYmVyIiwidGFyZ2V0IiwiY29sdW1uSW5kZXgiLCJyb3dJbmRleCIsInVudmFsaWRDZWxscyIsImNlbGxSZXZlcnQiLCJiYWNrZ3JvdW5kIiwiYWkiLCJwbGFjZU1hbnVhbGx5QnV0dG9uIiwibWFyZ2luTGVmdCIsImhhbmRsZUNsaWNrIiwiaW5kZXgiLCJxdWVyeVNlbGVjdG9yQWxsIiwiZm9yRWFjaCIsInJlbW92ZUV2ZW50TGlzdGVuZXIiLCJzdGFydEJ1dHRvbiIsInNoaXBDZWxscyIsImJ1dHRvbiIsInRvdGFsU2hpcHMiLCJhbGxQbGF5ZXJDZWxscyJdLCJzb3VyY2VSb290IjoiIn0=