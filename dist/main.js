(()=>{"use strict";const e=(e,t)=>{const o=document.createElement("div");o.classList.add("cell"),"p"===t?(o.id=`${t}${e}`,document.querySelector(".playerBoard").appendChild(o)):"ai"===t&&(o.id=`${t}${e}`,document.querySelector(".aiBoard").appendChild(o))},t=(e,t,o)=>{if(o)for(let o=0;o<100;o+=1)!1!==e[o].storedShip&&!0===e[o].beenHit?document.getElementById(`${t}${o}`).style.backgroundColor="rgb(133, 255, 179)":!1===e[o].storedShip&&!0===e[o].beenHit?document.getElementById(`${t}${o}`).style.backgroundColor="rgb(255, 133, 133)":document.getElementById(`${t}${o}`).style.backgroundColor="white";else for(let o=0;o<100;o+=1)!1!==e[o].storedShip&&!1===e[o].beenHit?document.getElementById(`${t}${o}`).style.backgroundColor="rgb(68, 68, 68)":!1!==e[o].storedShip&&!0===e[o].beenHit?document.getElementById(`${t}${o}`).style.backgroundColor="rgb(133, 255, 179)":!1===e[o].storedShip&&!0===e[o].beenHit?document.getElementById(`${t}${o}`).style.backgroundColor="rgb(255, 133, 133)":document.getElementById(`${t}${o}`).style.backgroundColor="white"},o=(e,t)=>({length:e,hitCount:0,sunk:!1,hit:(e,t)=>{const o=t[e].storedShip;return o.hitCount<o.length&&(o.hitCount+=1,o.hitCount===o.length&&(o.sunk=!0)),0},isVertical:t}),r=(e,t)=>{const r=[...e];if(1===Math.floor(2*Math.random())+1){let e,n;do{e=Math.floor(Math.random()*(10-t+1)),n=10*Math.floor(10*Math.random())}while(r.slice(n+e,n+e+t).some((e=>e.storedShip)));const l=o(t,!1);for(let o=0;o<t;o+=1)r[n+e+o].storedShip=l}else{let e,n,l;do{e=Math.floor(10*Math.random()),n=10*Math.floor(Math.random()*(10-t+1));const o=[];for(let l=n+e;l<e+n+10*t;l+=10)o.push(r[l]);l=o.some((e=>e.storedShip))}while(l);const d=o(t,!0);for(let o=0;o<10*t;o+=10)r[n+e+o].storedShip=d}return r},n=()=>{let o=[];return{board:o,createBoard:t=>{for(let r=0;r<100;r+=1)o[r]={storedShip:!1,beenHit:!1},e(r,t)},placeShip:(e,t)=>{if(e.isVertical)for(let r=t;r<t+10*e.length;r+=10)o[r].storedShip=e;else for(let r=t;r<t+e.length;r+=1)o[r].storedShip=e},receiveAttack:(e,r,n)=>{!1!==o[e].storedShip?(o[e].beenHit=!0,o[e].storedShip.hit(e,o),t(o,r,n)):(o[e].beenHit=!0,t(o,r,n))},allShipsSunk:()=>{for(let e=0;e<100;e+=1)if(!1!==o[e].storedShip&&!1===o[e].beenHit)return!1;return!0},randomShips:(e,n)=>{let l=[...o];for(let e=0;e<100;e+=1)l[e].storedShip=!1;l=r(o,5),l=r(o,4),l=r(o,3),l=r(o,3),l=r(o,2),t(l,e,n),o=l},resetBoard:()=>{for(let e=0;e<100;e+=1)o[e].storedShip=!1,o[e].beenHit=!1}}},l=(e,t)=>({name:e,oppBoard:t,attack:(e,o,r)=>{t.receiveAttack(e,o,r)},aiAttack:()=>{let e;do{e=Math.floor(99*Math.random())}while(t.board[e].beenHit);t.receiveAttack(e,"p",!1)}}),d=(e,o,r)=>{document.querySelector(".winnerText").textContent=r?"You Won Do You Want To Play Again?":"Ai Won Do You Want To Play Again";const n=document.querySelector(".winBackground");n.style.display="flex",document.querySelector(".restartButton").addEventListener("click",(()=>{e.resetBoard(),t(e.board,"p",!1),o.resetBoard(),t(o.board,"ai",!0),document.querySelector(".buttons").style.display="flex",document.querySelector(".startButton").style.display="flex";const r=document.querySelector(".manual");r.style.display="flex",r.style.removeProperty("margin-left");const l=document.querySelector(".random");l.style.display="flex",l.style.removeProperty("margin-left"),document.querySelector(".axisButton").remove(),n.style.display="none"}))},i=(e,t,o,r)=>{const n=document.querySelector(".axisButton"),l=Number(e.target.id.slice(1)),d=l%10,i=Math.floor(l/10);if(o){if("Horizontal"===n.textContent){const e=d-t;if(e>0)for(let o=0;o<t-e;o+=1){const e=document.querySelector(`#p${l+o}`);!1===r[l+o].storedShip&&(e.style.backgroundColor="white")}else for(let e=0;e<t;e+=1){const t=document.querySelector(`#p${l+e}`);!1===r[l+e].storedShip&&(t.style.backgroundColor="white")}}else if("Vertical"===n.textContent){const e=i-t;if(e>0)for(let o=0;o<10*t-10*e;o+=10){const e=document.querySelector(`#p${l+o}`);!1===r[l+o].storedShip&&(e.style.backgroundColor="white")}else for(let e=0;e<10*t;e+=10){const t=document.querySelector(`#p${l+e}`);!1===r[l+e].storedShip&&(t.style.backgroundColor="white")}}}else if("Horizontal"===n.textContent){const e=9-d+1;if(d>9-t+1){for(let e=0;e<t;e+=1)if(!1!==r[l+e].storedShip)return;for(let t=0;t<e;t+=1)document.querySelector(`#p${l+t}`).style.background="rgb(185, 74, 74)"}else for(let e=0;e<t;e+=1){const t=document.querySelector(`#p${l+e}`);!1===r[l+e].storedShip&&(t.style.background="lime")}}else if("Vertical"===n.textContent){const e=9-i+1;if(i>9-t+1)for(let t=0;t<10*e;t+=10){const e=document.querySelector(`#p${l+t}`);!1===r[l+t].storedShip&&(e.style.background="rgb(185, 74, 74)")}else for(let e=0;e<10*t;e+=10){const t=document.querySelector(`#p${l+e}`);!1===r[l+e].storedShip&&(t.style.background="lime")}}},c=n();c.createBoard("p");const a=n();a.createBoard("ai");const s=l("player",a),u=l("ai",c),h=document.querySelector(".random"),y=document.querySelector(".manual");h.addEventListener("click",(()=>{y.style.display="none",h.style.marginLeft="115px",c.randomShips("p",!1)}));const p=e=>{const t=Number(e.target.id.slice(2));s.attack(t,"ai",!0),a.allShipsSunk()&&(d(c,a,!0),document.querySelectorAll('div.cell[id^="ai"]').forEach((e=>{e.removeEventListener("click",p)}))),u.aiAttack(),c.allShipsSunk()&&(d(c,a,!1),document.querySelectorAll('div.cell[id^="ai"]').forEach((e=>{e.removeEventListener("click",p)})))},m=document.querySelector(".startButton");m.addEventListener("click",(()=>{let e=0;for(let t=0;t<100;t+=1)!1!==c.board[t].storedShip&&(e+=1);17===e&&(document.querySelector(".buttons").style.display="none",m.style.display="none",a.randomShips("ai",!0),document.querySelectorAll('div.cell[id^="ai"]').forEach((e=>{e.addEventListener("click",p)})))})),y.addEventListener("click",(()=>{if(h.style.display="none",null===document.querySelector(".axisButton")){(()=>{const e=document.createElement("button");e.classList.add("axisButton"),e.textContent="Horizontal",e.addEventListener("click",(()=>{"Vertical"===e.textContent?e.textContent="Horizontal":e.textContent="Vertical"})),document.querySelector(".buttons").appendChild(e)})();const e=document.querySelectorAll('div.cell[id^="p"]');e.forEach((e=>{e.addEventListener("mouseenter",(e=>{let t=0;for(let e=0;e<100;e+=1)!1!==c.board[e].storedShip&&(t+=1);0===t?i(e,5,!1,c.board):5===t?i(e,4,!1,c.board):9===t||12===t?i(e,3,!1,c.board):15===t&&i(e,2,!1,c.board)}))})),e.forEach((e=>{e.addEventListener("mouseleave",(e=>{i(e,5,!0,c.board)}))})),e.forEach((e=>{e.addEventListener("click",(e=>{let r,n;n="Vertical"===document.querySelector(".axisButton").textContent;let l=0;for(let e=0;e<100;e+=1)!1!==c.board[e].storedShip&&(l+=1);0===l?r=o(5,n):5===l?r=o(4,n):9===l||12===l?r=o(3,n):15===l&&(r=o(2,n));const d=Number(e.target.id.slice(1));if(r.isVertical){for(let e=0;e<10*r.length;e+=10)if(!1!==c.board[d+e].storedShip)return}else for(let e=0;e<r.length;e+=1)if(!1!==c.board[d+e].storedShip)return;"rgb(185, 74, 74)"!==document.querySelector(`#p${d}`).style.background&&(c.placeShip(r,d),t(c.board,"p",!1))}))}))}}))})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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RUFBTUssT0FBT3BFLEdBQUdnQyxNQUFNLElBQzVDLEdBQUdFLEVBQVFmLFlBQ1AsSUFBSSxJQUFJUCxFQUFJLEVBQUdBLEVBQXFCLEdBQWpCc0IsRUFBUWhCLE9BQWFOLEdBQUssR0FDekMsSUFBMkMsSUFBeEN3QyxFQUFPM0MsTUFBTXlELEVBQVN0RCxHQUFHQyxXQUN4QixZQUlSLElBQUksSUFBSUQsRUFBSSxFQUFHQSxFQUFJc0IsRUFBUWhCLE9BQVFOLEdBQUssRUFDcEMsSUFBMkMsSUFBeEN3QyxFQUFPM0MsTUFBTXlELEVBQVN0RCxHQUFHQyxXQUN4QixPQU13QixxQkFEaEJWLFNBQVNJLGNBQWMsS0FBSzJELEtBQ2pDbEQsTUFBTXlELGFBQ2pCckIsRUFBT2IsVUFBVUwsRUFBU2dDLEdBQzFCLEVBQVlkLEVBQU8zQyxNQUFPLEtBQUssR0FDbkMsR0FDSCxHQUVULEkiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9iYXR0bGVzaGlwLy4vc3JjL2Rpc3BsYXlCb2FyZC5qcyIsIndlYnBhY2s6Ly9iYXR0bGVzaGlwLy4vc3JjL3VwZGF0ZUJvYXJkLmpzIiwid2VicGFjazovL2JhdHRsZXNoaXAvLi9zcmMvY3JlYXRlU2hpcC5qcyIsIndlYnBhY2s6Ly9iYXR0bGVzaGlwLy4vc3JjL2NyZWF0ZVJhbmRvbVNoaXBzLmpzIiwid2VicGFjazovL2JhdHRsZXNoaXAvLi9zcmMvZ2FtZUJvYXJkLmpzIiwid2VicGFjazovL2JhdHRsZXNoaXAvLi9zcmMvY3JlYXRlUGxheWVyLmpzIiwid2VicGFjazovL2JhdHRsZXNoaXAvLi9zcmMvZW5kR2FtZS5qcyIsIndlYnBhY2s6Ly9iYXR0bGVzaGlwLy4vc3JjL2Rpc3BsYXlNYW51YWxTaGlwcy5qcyIsIndlYnBhY2s6Ly9iYXR0bGVzaGlwLy4vc3JjL2luZGV4LmpzIiwid2VicGFjazovL2JhdHRsZXNoaXAvLi9zcmMvYWRkQXhpc0J1dHRvbi5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJjb25zdCBkaXNwbGF5Qm9hcmQgPSAoaWQsIHBsYXllcikgPT4ge1xuICAgIGNvbnN0IGNlbGwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICBjZWxsLmNsYXNzTGlzdC5hZGQoJ2NlbGwnKTtcblxuICAgIGlmKHBsYXllciA9PT0gJ3AnKSB7XG4gICAgICAgIGNlbGwuaWQgPSBgJHtwbGF5ZXJ9JHtpZH1gO1xuXG4gICAgICAgIGNvbnN0IHBsYXllckJvYXJkID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnBsYXllckJvYXJkJyk7XG4gICAgICAgIHBsYXllckJvYXJkLmFwcGVuZENoaWxkKGNlbGwpO1xuICAgIH0gZWxzZSBpZihwbGF5ZXIgPT09ICdhaScpIHtcbiAgICAgICAgY2VsbC5pZCA9IGAke3BsYXllcn0ke2lkfWA7XG5cbiAgICAgICAgY29uc3QgYWlCb2FyZCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5haUJvYXJkJyk7XG4gICAgICAgIGFpQm9hcmQuYXBwZW5kQ2hpbGQoY2VsbCk7XG4gICAgfVxufVxuXG5leHBvcnQgZGVmYXVsdCBkaXNwbGF5Qm9hcmQ7IiwiY29uc3QgdXBkYXRlQm9hcmQgPSAoYm9hcmQsIGJvYXJkSWQsIGlzQWlCb2FyZCkgPT4ge1xuICBpZiAoaXNBaUJvYXJkKSB7XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCAxMDA7IGkgKz0gMSkge1xuICAgICAgaWYgKGJvYXJkW2ldLnN0b3JlZFNoaXAgIT09IGZhbHNlICYmIGJvYXJkW2ldLmJlZW5IaXQgPT09IHRydWUpIHtcbiAgICAgICAgY29uc3QgY2VsbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGAke2JvYXJkSWR9JHtpfWApO1xuICAgICAgICBjZWxsLnN0eWxlLmJhY2tncm91bmRDb2xvciA9IFwicmdiKDEzMywgMjU1LCAxNzkpXCI7XG4gICAgICB9IGVsc2UgaWYgKGJvYXJkW2ldLnN0b3JlZFNoaXAgPT09IGZhbHNlICYmIGJvYXJkW2ldLmJlZW5IaXQgPT09IHRydWUpIHtcbiAgICAgICAgY29uc3QgY2VsbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGAke2JvYXJkSWR9JHtpfWApO1xuICAgICAgICBjZWxsLnN0eWxlLmJhY2tncm91bmRDb2xvciA9IFwicmdiKDI1NSwgMTMzLCAxMzMpXCI7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBjb25zdCBjZWxsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoYCR7Ym9hcmRJZH0ke2l9YCk7XG4gICAgICAgIGNlbGwuc3R5bGUuYmFja2dyb3VuZENvbG9yID0gXCJ3aGl0ZVwiO1xuICAgICAgfVxuICAgIH1cbiAgfSBlbHNlIHtcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IDEwMDsgaSArPSAxKSB7XG4gICAgICBpZiAoYm9hcmRbaV0uc3RvcmVkU2hpcCAhPT0gZmFsc2UgJiYgYm9hcmRbaV0uYmVlbkhpdCA9PT0gZmFsc2UpIHtcbiAgICAgICAgY29uc3QgY2VsbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGAke2JvYXJkSWR9JHtpfWApO1xuICAgICAgICBjZWxsLnN0eWxlLmJhY2tncm91bmRDb2xvciA9IFwicmdiKDY4LCA2OCwgNjgpXCI7XG4gICAgICB9IGVsc2UgaWYgKGJvYXJkW2ldLnN0b3JlZFNoaXAgIT09IGZhbHNlICYmIGJvYXJkW2ldLmJlZW5IaXQgPT09IHRydWUpIHtcbiAgICAgICAgY29uc3QgY2VsbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGAke2JvYXJkSWR9JHtpfWApO1xuICAgICAgICBjZWxsLnN0eWxlLmJhY2tncm91bmRDb2xvciA9IFwicmdiKDEzMywgMjU1LCAxNzkpXCI7XG4gICAgICB9IGVsc2UgaWYgKGJvYXJkW2ldLnN0b3JlZFNoaXAgPT09IGZhbHNlICYmIGJvYXJkW2ldLmJlZW5IaXQgPT09IHRydWUpIHtcbiAgICAgICAgY29uc3QgY2VsbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGAke2JvYXJkSWR9JHtpfWApO1xuICAgICAgICBjZWxsLnN0eWxlLmJhY2tncm91bmRDb2xvciA9IFwicmdiKDI1NSwgMTMzLCAxMzMpXCI7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBjb25zdCBjZWxsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoYCR7Ym9hcmRJZH0ke2l9YCk7XG4gICAgICAgIGNlbGwuc3R5bGUuYmFja2dyb3VuZENvbG9yID0gXCJ3aGl0ZVwiO1xuICAgICAgfVxuICAgIH1cbiAgfVxufTtcblxuZXhwb3J0IGRlZmF1bHQgdXBkYXRlQm9hcmQ7XG4iLCJjb25zdCBjcmVhdGVTaGlwID0gKGxlbmd0aCwgaXNWZXJ0aWNhbCkgPT4ge1xuICBjb25zdCBoaXRDb3VudCA9IDA7XG4gIGNvbnN0IHN1bmsgPSBmYWxzZTtcblxuICBjb25zdCBoaXQgPSAoaW5kZXgsIGJvYXJkKSA9PiB7XG4gICAgY29uc3QgaGl0U2hpcCA9IGJvYXJkW2luZGV4XS5zdG9yZWRTaGlwO1xuXG4gICAgaWYgKGhpdFNoaXAuaGl0Q291bnQgPCBoaXRTaGlwLmxlbmd0aCkge1xuICAgICAgICBoaXRTaGlwLmhpdENvdW50ICs9IDE7XG4gICAgICAgIGlmIChoaXRTaGlwLmhpdENvdW50ID09PSBoaXRTaGlwLmxlbmd0aCkge1xuICAgICAgICAgICAgaGl0U2hpcC5zdW5rID0gdHJ1ZTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiBoaXRDb3VudDtcbiAgfTtcblxuICByZXR1cm4geyBsZW5ndGgsIGhpdENvdW50LCBzdW5rLCBoaXQsIGlzVmVydGljYWx9O1xufTtcblxuZXhwb3J0IGRlZmF1bHQgY3JlYXRlU2hpcDsiLCJpbXBvcnQgY3JlYXRlU2hpcCBmcm9tIFwiLi9jcmVhdGVTaGlwXCI7XG5cbmNvbnN0IGNyZWF0ZVJhbmRvbVNoaXBzID0gKGJvYXJkLCBzaGlwTGVuZ3RoKSA9PiB7XG4gICAgY29uc3QgYXhpc0RlY2lkZXIgPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAyKSArIDE7XG4gICAgY29uc3QgYm9hcmRDb3B5ID0gWy4uLmJvYXJkXTtcblxuICAgIGlmKGF4aXNEZWNpZGVyID09PSAxKSB7XG4gICAgICAgIGxldCBzdGFydGluZ0NvbHVtbjtcbiAgICAgICAgbGV0IHN0YXJ0aW5nUm93O1xuXG4gICAgICAgIGRvIHtcbiAgICAgICAgICAgIHN0YXJ0aW5nQ29sdW1uID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogKCgxMCAtIHNoaXBMZW5ndGgpICsgMSkpO1xuICAgICAgICAgICAgc3RhcnRpbmdSb3cgPSAoTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogMTApKSAqIDEwO1xuICAgICAgICB9IHdoaWxlIChcbiAgICAgICAgICAgIGJvYXJkQ29weS5zbGljZShzdGFydGluZ1JvdyArIHN0YXJ0aW5nQ29sdW1uLCBzdGFydGluZ1JvdyArIHN0YXJ0aW5nQ29sdW1uICsgc2hpcExlbmd0aClcbiAgICAgICAgICAgIC5zb21lKGNlbGwgPT4gY2VsbC5zdG9yZWRTaGlwKVxuICAgICAgICApXG5cbiAgICAgICAgY29uc3QgbmV3U2hpcCA9IGNyZWF0ZVNoaXAoc2hpcExlbmd0aCwgZmFsc2UpO1xuICAgICAgICBmb3IobGV0IGkgPSAwOyBpIDwgc2hpcExlbmd0aDsgaSArPSAxKSB7XG4gICAgICAgICAgICBib2FyZENvcHlbc3RhcnRpbmdSb3cgKyBzdGFydGluZ0NvbHVtbiArIGldLnN0b3JlZFNoaXAgPSBuZXdTaGlwO1xuICAgICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgICAgbGV0IHN0YXJ0aW5nQ29sdW1uO1xuICAgICAgICBsZXQgc3RhcnRpbmdSb3c7XG4gICAgICAgIGxldCBoYXNTdG9yZWRTaGlwXG5cbiAgICAgICAgZG8ge1xuICAgICAgICAgICAgc3RhcnRpbmdDb2x1bW4gPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAxMCk7XG4gICAgICAgICAgICBzdGFydGluZ1JvdyA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqICgoMTAgLSBzaGlwTGVuZ3RoKSArIDEpKSAqIDEwO1xuICAgICAgICBcbiAgICAgICAgICAgIGNvbnN0IHNsaWNlZEFycmF5ID0gW107XG4gICAgICAgICAgICBmb3IgKGxldCBpID0gc3RhcnRpbmdSb3cgKyBzdGFydGluZ0NvbHVtbjsgaSA8IHN0YXJ0aW5nQ29sdW1uICsgc3RhcnRpbmdSb3cgKyAoc2hpcExlbmd0aCAqIDEwKTsgaSArPSAxMCkge1xuICAgICAgICAgICAgICAgIHNsaWNlZEFycmF5LnB1c2goYm9hcmRDb3B5W2ldKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgICAgICBoYXNTdG9yZWRTaGlwID0gc2xpY2VkQXJyYXkuc29tZShjZWxsID0+IGNlbGwuc3RvcmVkU2hpcCk7XG4gICAgICAgIH0gd2hpbGUgKGhhc1N0b3JlZFNoaXApO1xuXG4gICAgICAgIGNvbnN0IG5ld1NoaXAgPSBjcmVhdGVTaGlwKHNoaXBMZW5ndGgsIHRydWUpO1xuICAgICAgICBmb3IobGV0IGkgPSAwOyBpIDwgc2hpcExlbmd0aCAqIDEwOyBpICs9IDEwKSB7XG4gICAgICAgICAgICBib2FyZENvcHlbc3RhcnRpbmdSb3cgKyBzdGFydGluZ0NvbHVtbiArIGldLnN0b3JlZFNoaXAgPSBuZXdTaGlwO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIGJvYXJkQ29weTtcbn1cblxuZXhwb3J0IGRlZmF1bHQgY3JlYXRlUmFuZG9tU2hpcHM7IiwiaW1wb3J0IGRpc3BsYXlCb2FyZCBmcm9tIFwiLi9kaXNwbGF5Qm9hcmRcIjtcbmltcG9ydCB1cGRhdGVCb2FyZCBmcm9tIFwiLi91cGRhdGVCb2FyZFwiO1xuaW1wb3J0IGNyZWF0ZVJhbmRvbVNoaXBzIGZyb20gXCIuL2NyZWF0ZVJhbmRvbVNoaXBzXCI7XG5cbmNvbnN0IGdhbWVCb2FyZCA9ICgpID0+IHtcbiAgbGV0IGJvYXJkID0gW107XG5cbiAgY29uc3QgY3JlYXRlQm9hcmQgPSAocGxheWVyKSA9PiB7XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCAxMDA7IGkgKz0gMSkge1xuICAgICAgYm9hcmRbaV0gPSB7IHN0b3JlZFNoaXA6IGZhbHNlLCBiZWVuSGl0OiBmYWxzZSB9O1xuICAgICAgZGlzcGxheUJvYXJkKGksIHBsYXllcik7XG4gICAgfVxuICB9O1xuXG4gIGNvbnN0IHBsYWNlU2hpcCA9IChzaGlwLCBzdGFydCkgPT4ge1xuICAgIGlmIChzaGlwLmlzVmVydGljYWwpIHtcbiAgICAgIGZvciAobGV0IGkgPSBzdGFydDsgaSA8IHN0YXJ0ICsgc2hpcC5sZW5ndGggKiAxMDsgaSArPSAxMCkge1xuICAgICAgICBib2FyZFtpXS5zdG9yZWRTaGlwID0gc2hpcDtcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgZm9yIChsZXQgaSA9IHN0YXJ0OyBpIDwgc3RhcnQgKyBzaGlwLmxlbmd0aDsgaSArPSAxKSB7XG4gICAgICAgIGJvYXJkW2ldLnN0b3JlZFNoaXAgPSBzaGlwO1xuICAgICAgfVxuICAgIH1cbiAgfTtcblxuICBjb25zdCByYW5kb21TaGlwcyA9IChib2FyZElkLCBpc0FpQm9hcmQpID0+IHtcbiAgICBsZXQgYm9hcmRDb3B5ID0gWy4uLmJvYXJkXTtcblxuICAgIGZvcihsZXQgaSA9IDA7IGkgPCAxMDA7IGkgKz0gMSkge1xuICAgICAgYm9hcmRDb3B5W2ldLnN0b3JlZFNoaXAgPSBmYWxzZTtcbiAgICB9XG5cbiAgICBib2FyZENvcHkgPSBjcmVhdGVSYW5kb21TaGlwcyhib2FyZCwgNSk7XG4gICAgYm9hcmRDb3B5ID0gY3JlYXRlUmFuZG9tU2hpcHMoYm9hcmQsIDQpO1xuICAgIGJvYXJkQ29weSA9IGNyZWF0ZVJhbmRvbVNoaXBzKGJvYXJkLCAzKTtcbiAgICBib2FyZENvcHkgPSBjcmVhdGVSYW5kb21TaGlwcyhib2FyZCwgMyk7XG4gICAgYm9hcmRDb3B5ID0gY3JlYXRlUmFuZG9tU2hpcHMoYm9hcmQsIDIpO1xuXG4gICAgdXBkYXRlQm9hcmQoYm9hcmRDb3B5LCBib2FyZElkLCBpc0FpQm9hcmQpO1xuICAgIGJvYXJkID0gYm9hcmRDb3B5O1xuICB9XG5cbiAgY29uc3QgcmVjZWl2ZUF0dGFjayA9IChjb3JkaW5hdGVzLCBib2FyZElkLCBpc0FpQm9hcmQpID0+IHtcbiAgICBpZiAoYm9hcmRbY29yZGluYXRlc10uc3RvcmVkU2hpcCAhPT0gZmFsc2UpIHtcbiAgICAgIGJvYXJkW2NvcmRpbmF0ZXNdLmJlZW5IaXQgPSB0cnVlO1xuICAgICAgYm9hcmRbY29yZGluYXRlc10uc3RvcmVkU2hpcC5oaXQoY29yZGluYXRlcywgYm9hcmQpO1xuICAgICAgdXBkYXRlQm9hcmQoYm9hcmQsIGJvYXJkSWQsIGlzQWlCb2FyZCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGJvYXJkW2NvcmRpbmF0ZXNdLmJlZW5IaXQgPSB0cnVlO1xuICAgICAgdXBkYXRlQm9hcmQoYm9hcmQsIGJvYXJkSWQsIGlzQWlCb2FyZCk7XG4gICAgfVxuICB9O1xuXG4gIGNvbnN0IGFsbFNoaXBzU3VuayA9ICgpID0+IHtcbiAgICBmb3IobGV0IGk9MDsgaSA8IDEwMDsgaSArPSAxKSB7XG4gICAgICBpZihib2FyZFtpXS5zdG9yZWRTaGlwICE9PSBmYWxzZSAmJiBib2FyZFtpXS5iZWVuSGl0ID09PSBmYWxzZSkge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIHRydWU7XG4gIH1cblxuICBjb25zdCByZXNldEJvYXJkID0gKCkgPT4ge1xuICAgIGZvcihsZXQgaT0wOyBpIDwgMTAwOyBpICs9IDEpIHtcbiAgICAgIGJvYXJkW2ldLnN0b3JlZFNoaXAgPSBmYWxzZTtcbiAgICAgIGJvYXJkW2ldLmJlZW5IaXQgPSBmYWxzZTtcbiAgICB9XG4gIH1cblxuICByZXR1cm4geyBib2FyZCwgY3JlYXRlQm9hcmQsIHBsYWNlU2hpcCwgcmVjZWl2ZUF0dGFjaywgYWxsU2hpcHNTdW5rLCByYW5kb21TaGlwcywgcmVzZXRCb2FyZCB9O1xufTtcblxuZXhwb3J0IGRlZmF1bHQgZ2FtZUJvYXJkOyIsImNvbnN0IGNyZWF0ZVBsYXllciA9IChuYW1lLCBvcHBCb2FyZCkgPT4ge1xuXG4gICAgY29uc3QgYXR0YWNrID0gKGNvcmRpbmF0ZXMsIGJvYXJkSWQsIGlzQWlCb2FyZCkgPT4ge1xuICAgICAgICBvcHBCb2FyZC5yZWNlaXZlQXR0YWNrKGNvcmRpbmF0ZXMsIGJvYXJkSWQsIGlzQWlCb2FyZCk7XG4gICAgfVxuXG4gICAgY29uc3QgYWlBdHRhY2sgPSAoKSA9PiB7XG4gICAgICAgIGxldCByYW5kb21OdW1iZXI7XG4gICAgICAgIGRvIHtcbiAgICAgICAgICAgIHJhbmRvbU51bWJlciA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDk5KTtcbiAgICAgICAgfSB3aGlsZSAob3BwQm9hcmQuYm9hcmRbcmFuZG9tTnVtYmVyXS5iZWVuSGl0KTtcblxuICAgICAgICBvcHBCb2FyZC5yZWNlaXZlQXR0YWNrKHJhbmRvbU51bWJlciwgJ3AnLCBmYWxzZSk7XG4gICAgfVxuXG4gICAgcmV0dXJuIHsgbmFtZSwgb3BwQm9hcmQsIGF0dGFjaywgYWlBdHRhY2sgfVxufVxuXG5leHBvcnQgZGVmYXVsdCBjcmVhdGVQbGF5ZXI7IiwiaW1wb3J0IHVwZGF0ZUJvYXJkIGZyb20gXCIuL3VwZGF0ZUJvYXJkXCI7XG5cbmNvbnN0IGVuZEdhbWUgPSAocEJvYXJkLCBhaUJvYXJkLCBpc1BsYXllcldvbikgPT4ge1xuICAgIGlmKGlzUGxheWVyV29uKSB7XG4gICAgICAgIGNvbnN0IHdpbm5lclRleHQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcud2lubmVyVGV4dCcpO1xuICAgICAgICB3aW5uZXJUZXh0LnRleHRDb250ZW50ID0gJ1lvdSBXb24gRG8gWW91IFdhbnQgVG8gUGxheSBBZ2Fpbj8nO1xuICAgIH0gZWxzZSB7XG4gICAgICAgIGNvbnN0IHdpbm5lclRleHQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcud2lubmVyVGV4dCcpO1xuICAgICAgICB3aW5uZXJUZXh0LnRleHRDb250ZW50ID0gJ0FpIFdvbiBEbyBZb3UgV2FudCBUbyBQbGF5IEFnYWluJztcbiAgICB9XG5cbiAgICBjb25zdCB3aW5CYWNrZ3JvdW5kID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLndpbkJhY2tncm91bmQnKTtcbiAgICB3aW5CYWNrZ3JvdW5kLnN0eWxlLmRpc3BsYXkgPSAnZmxleCc7XG5cbiAgICBjb25zdCByZXN0YXJ0QnV0dG9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnJlc3RhcnRCdXR0b24nKTtcbiAgICByZXN0YXJ0QnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4ge1xuICAgICAgICBwQm9hcmQucmVzZXRCb2FyZCgpO1xuICAgICAgICB1cGRhdGVCb2FyZChwQm9hcmQuYm9hcmQsICdwJywgZmFsc2UpO1xuXG4gICAgICAgIGFpQm9hcmQucmVzZXRCb2FyZCgpO1xuICAgICAgICB1cGRhdGVCb2FyZChhaUJvYXJkLmJvYXJkLCAnYWknLCB0cnVlKTtcblxuICAgICAgICBjb25zdCBidXR0b25zRGl2ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmJ1dHRvbnMnKTtcbiAgICAgICAgYnV0dG9uc0Rpdi5zdHlsZS5kaXNwbGF5ID0gJ2ZsZXgnO1xuXG4gICAgICAgIGNvbnN0IHN0YXJ0QnV0dG9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnN0YXJ0QnV0dG9uJyk7XG4gICAgICAgIHN0YXJ0QnV0dG9uLnN0eWxlLmRpc3BsYXkgPSAnZmxleCc7XG5cbiAgICAgICAgY29uc3QgbWFudWFsQnV0dG9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLm1hbnVhbCcpO1xuICAgICAgICBtYW51YWxCdXR0b24uc3R5bGUuZGlzcGxheSA9ICdmbGV4JztcbiAgICAgICAgbWFudWFsQnV0dG9uLnN0eWxlLnJlbW92ZVByb3BlcnR5KCdtYXJnaW4tbGVmdCcpO1xuXG4gICAgICAgIGNvbnN0IHBsYWNlUmFuZG9tQnV0dG9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnJhbmRvbScpO1xuICAgICAgICBwbGFjZVJhbmRvbUJ1dHRvbi5zdHlsZS5kaXNwbGF5ID0gJ2ZsZXgnO1xuICAgICAgICBwbGFjZVJhbmRvbUJ1dHRvbi5zdHlsZS5yZW1vdmVQcm9wZXJ0eSgnbWFyZ2luLWxlZnQnKTtcblxuICAgICAgICBjb25zdCBheGlzQnV0dG9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmF4aXNCdXR0b24nKTtcbiAgICAgICAgYXhpc0J1dHRvbi5yZW1vdmUoKTtcblxuICAgICAgICB3aW5CYWNrZ3JvdW5kLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7XG4gICAgfSlcbn1cblxuZXhwb3J0IGRlZmF1bHQgZW5kR2FtZTsiLCJjb25zdCBkaXNwbGF5TWFudWFsU2hpcHMgPSAoZXZlbnQsIHNoaXBMZW5ndGgsIHJldmVydCwgYm9hcmQpID0+IHtcbiAgICBjb25zdCBheGlzQnV0dG9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmF4aXNCdXR0b24nKTtcbiAgICBjb25zdCBjZWxsSWQgPSBOdW1iZXIoZXZlbnQudGFyZ2V0LmlkLnNsaWNlKDEpKTtcbiAgICBjb25zdCBjb2x1bW5JbmRleCA9IGNlbGxJZCAlIDEwO1xuICAgIGNvbnN0IHJvd0luZGV4ID0gTWF0aC5mbG9vcihjZWxsSWQgLyAxMCk7XG5cbiAgICBpZihyZXZlcnQpIHtcblxuICAgICAgICBpZihheGlzQnV0dG9uLnRleHRDb250ZW50ID09PSAnSG9yaXpvbnRhbCcpIHtcbiAgICAgICAgICAgIGNvbnN0IHVudmFsaWRDZWxscyA9IGNvbHVtbkluZGV4IC0gc2hpcExlbmd0aDtcbiAgICAgICAgICAgIGlmKHVudmFsaWRDZWxscyA+IDApIHtcbiAgICAgICAgICAgICAgICBmb3IobGV0IGkgPSAwOyBpIDwgc2hpcExlbmd0aCAtIHVudmFsaWRDZWxsczsgaSArPSAxKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGNlbGxSZXZlcnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGAjcCR7Y2VsbElkICsgaX1gKTtcbiAgICAgICAgICAgICAgICAgICAgaWYoYm9hcmRbY2VsbElkICsgaV0uc3RvcmVkU2hpcCA9PT0gZmFsc2UpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNlbGxSZXZlcnQuc3R5bGUuYmFja2dyb3VuZENvbG9yID0gJ3doaXRlJztcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgZm9yKGxldCBpID0gMDsgaSA8IHNoaXBMZW5ndGg7IGkgKz0gMSkge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBjZWxsUmV2ZXJ0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihgI3Ake2NlbGxJZCArIGl9YCk7XG4gICAgICAgICAgICAgICAgICAgIGlmKGJvYXJkW2NlbGxJZCArIGldLnN0b3JlZFNoaXAgPT09IGZhbHNlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjZWxsUmV2ZXJ0LnN0eWxlLmJhY2tncm91bmRDb2xvciA9ICd3aGl0ZSc7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSBpZihheGlzQnV0dG9uLnRleHRDb250ZW50ID09PSAnVmVydGljYWwnKSB7XG4gICAgICAgICAgICBjb25zdCB1bnZhbGlkQ2VsbHMgPSByb3dJbmRleCAtIHNoaXBMZW5ndGg7XG4gICAgICAgICAgICBpZih1bnZhbGlkQ2VsbHMgPiAwKSB7XG4gICAgICAgICAgICAgICAgZm9yKGxldCBpID0gMDsgaSA8IChzaGlwTGVuZ3RoICogMTApIC0gKHVudmFsaWRDZWxscyAqIDEwKTsgaSArPSAxMCkge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBjZWxsUmV2ZXJ0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihgI3Ake2NlbGxJZCArIGl9YCk7XG4gICAgICAgICAgICAgICAgICAgIGlmKGJvYXJkW2NlbGxJZCArIGldLnN0b3JlZFNoaXAgPT09IGZhbHNlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjZWxsUmV2ZXJ0LnN0eWxlLmJhY2tncm91bmRDb2xvciA9ICd3aGl0ZSc7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGZvcihsZXQgaSA9IDA7IGkgPCAoc2hpcExlbmd0aCAqIDEwKTsgaSArPSAxMCkge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBjZWxsUmV2ZXJ0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihgI3Ake2NlbGxJZCArIGl9YCk7XG4gICAgICAgICAgICAgICAgICAgIGlmKGJvYXJkW2NlbGxJZCArIGldLnN0b3JlZFNoaXAgPT09IGZhbHNlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjZWxsUmV2ZXJ0LnN0eWxlLmJhY2tncm91bmRDb2xvciA9ICd3aGl0ZSc7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgXG5cbiAgICB9IGVsc2UgaWYoYXhpc0J1dHRvbi50ZXh0Q29udGVudCA9PT0gJ0hvcml6b250YWwnKSB7XG5cbiAgICAgICAgY29uc3QgdW52YWxpZENlbGxzID0gKDkgLSBjb2x1bW5JbmRleCkgKyAxO1xuICAgICAgICBpZihjb2x1bW5JbmRleCA+ICg5IC0gc2hpcExlbmd0aCkgKyAxKSB7XG4gICAgICAgICAgICBmb3IobGV0IGkgPSAwOyBpIDwgc2hpcExlbmd0aDsgaSArPSAxKSB7XG4gICAgICAgICAgICAgICAgaWYoYm9hcmRbY2VsbElkICsgaV0uc3RvcmVkU2hpcCAhPT0gZmFsc2UpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgZm9yKGxldCBpID0gMDsgaSA8IHVudmFsaWRDZWxsczsgaSArPSAxKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgY2VsbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYCNwJHtjZWxsSWQgKyBpfWApO1xuICAgICAgICAgICAgICAgIGNlbGwuc3R5bGUuYmFja2dyb3VuZCA9ICdyZ2IoMTg1LCA3NCwgNzQpJztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGZvcihsZXQgaSA9IDA7IGkgPCBzaGlwTGVuZ3RoOyBpICs9IDEpIHtcbiAgICAgICAgICAgICAgICBjb25zdCBjZWxsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihgI3Ake2NlbGxJZCArIGl9YCk7XG4gICAgICAgICAgICAgICAgaWYoYm9hcmRbY2VsbElkICsgaV0uc3RvcmVkU2hpcCA9PT0gZmFsc2UpIHtcbiAgICAgICAgICAgICAgICAgICAgY2VsbC5zdHlsZS5iYWNrZ3JvdW5kID0gJ2xpbWUnO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgfSBlbHNlIGlmKGF4aXNCdXR0b24udGV4dENvbnRlbnQgPT09ICdWZXJ0aWNhbCcpe1xuXG4gICAgICAgIGNvbnN0IHVudmFsaWRDZWxscyA9ICg5IC0gcm93SW5kZXgpICsgMTtcbiAgICAgICAgaWYocm93SW5kZXggPiAoOSAtIHNoaXBMZW5ndGgpICsgMSkge1xuICAgICAgICAgICAgZm9yKGxldCBpID0gMDsgaSA8IHVudmFsaWRDZWxscyAqIDEwOyBpICs9IDEwKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgY2VsbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYCNwJHtjZWxsSWQgKyBpfWApO1xuICAgICAgICAgICAgICAgIGlmKGJvYXJkW2NlbGxJZCArIGldLnN0b3JlZFNoaXAgPT09IGZhbHNlKSB7XG4gICAgICAgICAgICAgICAgICAgIGNlbGwuc3R5bGUuYmFja2dyb3VuZCA9ICdyZ2IoMTg1LCA3NCwgNzQpJztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBmb3IobGV0IGkgPSAwOyBpIDwgc2hpcExlbmd0aCAqIDEwOyBpICs9IDEwKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgY2VsbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYCNwJHtjZWxsSWQgKyBpfWApO1xuICAgICAgICAgICAgICAgIGlmKGJvYXJkW2NlbGxJZCArIGldLnN0b3JlZFNoaXAgPT09IGZhbHNlKSB7XG4gICAgICAgICAgICAgICAgICAgIGNlbGwuc3R5bGUuYmFja2dyb3VuZCA9ICdsaW1lJztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgfVxuXG59XG5cbmV4cG9ydCBkZWZhdWx0IGRpc3BsYXlNYW51YWxTaGlwczsiLCJpbXBvcnQgZ2FtZUJvYXJkIGZyb20gXCIuL2dhbWVCb2FyZFwiO1xuaW1wb3J0IGNyZWF0ZVBsYXllciBmcm9tIFwiLi9jcmVhdGVQbGF5ZXJcIjtcbmltcG9ydCBlbmRHYW1lIGZyb20gXCIuL2VuZEdhbWVcIjtcbmltcG9ydCBhZGRBeGlzQnV0dG9uIGZyb20gXCIuL2FkZEF4aXNCdXR0b25cIjtcbmltcG9ydCBkaXNwbGF5TWFudWFsU2hpcHMgZnJvbSBcIi4vZGlzcGxheU1hbnVhbFNoaXBzXCI7XG5pbXBvcnQgY3JlYXRlU2hpcCBmcm9tIFwiLi9jcmVhdGVTaGlwXCI7XG5pbXBvcnQgdXBkYXRlQm9hcmQgZnJvbSBcIi4vdXBkYXRlQm9hcmRcIjtcblxuXG5jb25zdCBwQm9hcmQgPSBnYW1lQm9hcmQoKTtcbnBCb2FyZC5jcmVhdGVCb2FyZCgncCcpO1xuY29uc3QgYWlCb2FyZCA9IGdhbWVCb2FyZCgpO1xuYWlCb2FyZC5jcmVhdGVCb2FyZCgnYWknKTtcblxuY29uc3QgcGxheWVyID0gY3JlYXRlUGxheWVyKCdwbGF5ZXInLCBhaUJvYXJkKTtcbmNvbnN0IGFpID0gY3JlYXRlUGxheWVyKCdhaScsIHBCb2FyZCk7XG5cbmNvbnN0IHBsYWNlUmFuZG9tQnV0dG9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnJhbmRvbScpO1xuY29uc3QgcGxhY2VNYW51YWxseUJ1dHRvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5tYW51YWwnKTtcblxucGxhY2VSYW5kb21CdXR0b24uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7XG4gICAgcGxhY2VNYW51YWxseUJ1dHRvbi5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnO1xuXG4gICAgcGxhY2VSYW5kb21CdXR0b24uc3R5bGUubWFyZ2luTGVmdCA9ICcxMTVweCc7XG5cbiAgICBwQm9hcmQucmFuZG9tU2hpcHMoJ3AnLCBmYWxzZSk7XG59KVxuXG5jb25zdCBoYW5kbGVDbGljayA9IChldmVudCkgPT4ge1xuICAgIGNvbnN0IGluZGV4ID0gTnVtYmVyKGV2ZW50LnRhcmdldC5pZC5zbGljZSgyKSlcbiAgICBcbiAgICBwbGF5ZXIuYXR0YWNrKGluZGV4LCAnYWknLCB0cnVlKTtcbiAgICBjb25zdCBpc1BsYXllcldvbiA9IGFpQm9hcmQuYWxsU2hpcHNTdW5rKCk7XG4gICAgaWYoaXNQbGF5ZXJXb24pIHtcbiAgICAgICAgZW5kR2FtZShwQm9hcmQsIGFpQm9hcmQsIHRydWUpO1xuXG4gICAgICAgIGNvbnN0IGFsbENlbGxzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnZGl2LmNlbGxbaWRePVwiYWlcIl0nKTtcbiAgICAgICAgYWxsQ2VsbHMuZm9yRWFjaCgoY2VsbCkgPT4ge1xuICAgICAgICAgICAgY2VsbC5yZW1vdmVFdmVudExpc3RlbmVyKCdjbGljaycsIGhhbmRsZUNsaWNrKTtcbiAgICAgICAgfSlcbiAgICB9XG5cbiAgICBhaS5haUF0dGFjaygpO1xuICAgIGNvbnN0IGlzQWlXb24gPSBwQm9hcmQuYWxsU2hpcHNTdW5rKCk7XG4gICAgaWYoaXNBaVdvbikge1xuICAgICAgICBlbmRHYW1lKHBCb2FyZCwgYWlCb2FyZCwgZmFsc2UpO1xuXG4gICAgICAgIGNvbnN0IGFsbENlbGxzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnZGl2LmNlbGxbaWRePVwiYWlcIl0nKTtcbiAgICAgICAgYWxsQ2VsbHMuZm9yRWFjaCgoY2VsbCkgPT4ge1xuICAgICAgICAgICAgY2VsbC5yZW1vdmVFdmVudExpc3RlbmVyKCdjbGljaycsIGhhbmRsZUNsaWNrKTtcbiAgICAgICAgfSlcbiAgICB9XG59XG5cbmNvbnN0IHN0YXJ0QnV0dG9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnN0YXJ0QnV0dG9uJyk7XG5zdGFydEJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHtcbiAgICBsZXQgc2hpcENlbGxzID0gMDtcbiAgICBmb3IobGV0IGkgPSAwOyBpIDwgMTAwOyBpICs9IDEpIHtcbiAgICAgICAgaWYocEJvYXJkLmJvYXJkW2ldLnN0b3JlZFNoaXAgIT09IGZhbHNlKSB7XG4gICAgICAgICAgICBzaGlwQ2VsbHMgKz0gMTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGlmKHNoaXBDZWxscyA9PT0gMTcpIHtcbiAgICAgICAgY29uc3QgYnV0dG9uc0RpdiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5idXR0b25zJyk7XG4gICAgICAgIGJ1dHRvbnNEaXYuc3R5bGUuZGlzcGxheSA9ICdub25lJztcbiAgICAgICAgc3RhcnRCdXR0b24uc3R5bGUuZGlzcGxheSA9ICdub25lJztcblxuXG4gICAgICAgIGFpQm9hcmQucmFuZG9tU2hpcHMoJ2FpJywgdHJ1ZSk7XG5cbiAgICAgICAgY29uc3QgYWxsQ2VsbHMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCdkaXYuY2VsbFtpZF49XCJhaVwiXScpO1xuICAgICAgICBhbGxDZWxscy5mb3JFYWNoKChjZWxsKSA9PiB7XG4gICAgICAgICAgICBjZWxsLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgaGFuZGxlQ2xpY2spO1xuICAgICAgICB9KVxuICAgIH1cbn0pXG5cbnBsYWNlTWFudWFsbHlCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7XG4gICAgcGxhY2VSYW5kb21CdXR0b24uc3R5bGUuZGlzcGxheSA9ICdub25lJztcblxuICAgIGNvbnN0IGF4aXNCdXR0b24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuYXhpc0J1dHRvbicpO1xuICAgIGlmKGF4aXNCdXR0b24gPT09IG51bGwpIHtcbiAgICAgICAgYWRkQXhpc0J1dHRvbigpO1xuXG4gICAgICAgIGNvbnN0IGFsbFBsYXllckNlbGxzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnZGl2LmNlbGxbaWRePVwicFwiXScpO1xuICAgICAgICBhbGxQbGF5ZXJDZWxscy5mb3JFYWNoKChjZWxsKSA9PiB7XG4gICAgICAgICAgICBjZWxsLmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNlZW50ZXInLCAoZXZlbnQpID0+IHtcbiAgICAgICAgICAgICAgICBsZXQgc2hpcENlbGxzID0gMDtcbiAgICAgICAgICAgICAgICBmb3IobGV0IGkgPSAwOyBpIDwgMTAwOyBpICs9IDEpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYocEJvYXJkLmJvYXJkW2ldLnN0b3JlZFNoaXAgIT09IGZhbHNlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzaGlwQ2VsbHMgKz0gMTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGlmKHNoaXBDZWxscyA9PT0gMCkge1xuICAgICAgICAgICAgICAgICAgICBkaXNwbGF5TWFudWFsU2hpcHMoZXZlbnQsIDUsIGZhbHNlLCBwQm9hcmQuYm9hcmQpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSBpZihzaGlwQ2VsbHMgPT09IDUpIHtcbiAgICAgICAgICAgICAgICAgICAgZGlzcGxheU1hbnVhbFNoaXBzKGV2ZW50LCA0LCBmYWxzZSwgcEJvYXJkLmJvYXJkKTtcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYoc2hpcENlbGxzID09PSA5KSB7XG4gICAgICAgICAgICAgICAgICAgIGRpc3BsYXlNYW51YWxTaGlwcyhldmVudCwgMywgZmFsc2UsIHBCb2FyZC5ib2FyZCk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmKHNoaXBDZWxscyA9PT0gMTIpIHtcbiAgICAgICAgICAgICAgICAgICAgZGlzcGxheU1hbnVhbFNoaXBzKGV2ZW50LCAzLCBmYWxzZSwgcEJvYXJkLmJvYXJkKTtcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYoc2hpcENlbGxzID09PSAxNSkge1xuICAgICAgICAgICAgICAgICAgICBkaXNwbGF5TWFudWFsU2hpcHMoZXZlbnQsIDIsIGZhbHNlLCBwQm9hcmQuYm9hcmQpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pXG4gICAgICAgIH0pXG5cbiAgICAgICAgYWxsUGxheWVyQ2VsbHMuZm9yRWFjaCgoY2VsbCkgPT4ge1xuICAgICAgICAgICAgY2VsbC5hZGRFdmVudExpc3RlbmVyKCdtb3VzZWxlYXZlJywgKGV2ZW50KSA9PiB7XG4gICAgICAgICAgICAgICAgZGlzcGxheU1hbnVhbFNoaXBzKGV2ZW50LCA1LCB0cnVlLCBwQm9hcmQuYm9hcmQpO1xuICAgICAgICAgICAgfSlcbiAgICAgICAgfSlcblxuICAgICAgICBhbGxQbGF5ZXJDZWxscy5mb3JFYWNoKChjZWxsKSA9PiB7XG4gICAgICAgICAgICBjZWxsLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKGV2ZW50KSA9PiB7XG4gICAgICAgICAgICAgICAgbGV0IG5ld1NoaXA7XG4gICAgICAgICAgICAgICAgbGV0IGlzVmVydGljYWw7XG4gICAgICAgICAgICAgICAgY29uc3QgYWRkZWRBeGlzQnV0dG9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmF4aXNCdXR0b24nKTtcblxuICAgICAgICAgICAgICAgIGlmKGFkZGVkQXhpc0J1dHRvbi50ZXh0Q29udGVudCA9PT0gJ1ZlcnRpY2FsJykge1xuICAgICAgICAgICAgICAgICAgICBpc1ZlcnRpY2FsID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBpc1ZlcnRpY2FsID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgbGV0IHNoaXBDZWxscyA9IDA7XG4gICAgICAgICAgICAgICAgZm9yKGxldCBpID0gMDsgaSA8IDEwMDsgaSArPSAxKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmKHBCb2FyZC5ib2FyZFtpXS5zdG9yZWRTaGlwICE9PSBmYWxzZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgc2hpcENlbGxzICs9IDE7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBpZihzaGlwQ2VsbHMgPT09IDApIHtcbiAgICAgICAgICAgICAgICAgICAgbmV3U2hpcCA9IGNyZWF0ZVNoaXAoNSwgaXNWZXJ0aWNhbCk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmKHNoaXBDZWxscyA9PT0gNSkge1xuICAgICAgICAgICAgICAgICAgICBuZXdTaGlwID0gY3JlYXRlU2hpcCg0LCBpc1ZlcnRpY2FsKTtcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYoc2hpcENlbGxzID09PSA5KSB7XG4gICAgICAgICAgICAgICAgICAgIG5ld1NoaXAgPSBjcmVhdGVTaGlwKDMsIGlzVmVydGljYWwpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSBpZihzaGlwQ2VsbHMgPT09IDEyKSB7XG4gICAgICAgICAgICAgICAgICAgIG5ld1NoaXAgPSBjcmVhdGVTaGlwKDMsIGlzVmVydGljYWwpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSBpZihzaGlwQ2VsbHMgPT09IDE1KSB7XG4gICAgICAgICAgICAgICAgICAgIG5ld1NoaXAgPSBjcmVhdGVTaGlwKDIsIGlzVmVydGljYWwpO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGNvbnN0IGNlbGxJZCA9IE51bWJlcihldmVudC50YXJnZXQuaWQuc2xpY2UoMSkpO1xuICAgICAgICAgICAgICAgIGlmKG5ld1NoaXAuaXNWZXJ0aWNhbCkge1xuICAgICAgICAgICAgICAgICAgICBmb3IobGV0IGkgPSAwOyBpIDwgbmV3U2hpcC5sZW5ndGggKiAxMDsgaSArPSAxMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYocEJvYXJkLmJvYXJkW2NlbGxJZCArIGldLnN0b3JlZFNoaXAgIT09IGZhbHNlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgZm9yKGxldCBpID0gMDsgaSA8IG5ld1NoaXAubGVuZ3RoOyBpICs9IDEpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmKHBCb2FyZC5ib2FyZFtjZWxsSWQgKyBpXS5zdG9yZWRTaGlwICE9PSBmYWxzZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGNvbnN0IGNsaWNrZWRDZWxsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihgI3Ake2NlbGxJZH1gKTtcbiAgICAgICAgICAgICAgICBpZihjbGlja2VkQ2VsbC5zdHlsZS5iYWNrZ3JvdW5kICE9PSAncmdiKDE4NSwgNzQsIDc0KScpIHtcbiAgICAgICAgICAgICAgICAgICAgcEJvYXJkLnBsYWNlU2hpcChuZXdTaGlwLCBjZWxsSWQpO1xuICAgICAgICAgICAgICAgICAgICB1cGRhdGVCb2FyZChwQm9hcmQuYm9hcmQsICdwJywgZmFsc2UpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pXG4gICAgICAgIH0pXG4gICAgfVxufSlcbiIsImNvbnN0IGFkZEF4aXNCdXR0b24gPSAoKSA9PiB7XG4gICAgY29uc3QgYnV0dG9uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYnV0dG9uJyk7XG4gICAgYnV0dG9uLmNsYXNzTGlzdC5hZGQoJ2F4aXNCdXR0b24nKTtcbiAgICBidXR0b24udGV4dENvbnRlbnQgPSAnSG9yaXpvbnRhbCc7XG5cbiAgICBidXR0b24uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7XG4gICAgICAgIGlmKGJ1dHRvbi50ZXh0Q29udGVudCA9PT0gJ1ZlcnRpY2FsJykge1xuICAgICAgICAgICAgYnV0dG9uLnRleHRDb250ZW50ID0gJ0hvcml6b250YWwnO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgYnV0dG9uLnRleHRDb250ZW50ID0gJ1ZlcnRpY2FsJztcbiAgICAgICAgfVxuICAgIH0pXG5cbiAgICBjb25zdCBidXR0b25zRGl2ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmJ1dHRvbnMnKTtcbiAgICBidXR0b25zRGl2LmFwcGVuZENoaWxkKGJ1dHRvbik7XG59XG5cbmV4cG9ydCBkZWZhdWx0IGFkZEF4aXNCdXR0b247Il0sIm5hbWVzIjpbImlkIiwicGxheWVyIiwiY2VsbCIsImRvY3VtZW50IiwiY3JlYXRlRWxlbWVudCIsImNsYXNzTGlzdCIsImFkZCIsInF1ZXJ5U2VsZWN0b3IiLCJhcHBlbmRDaGlsZCIsImJvYXJkIiwiYm9hcmRJZCIsImlzQWlCb2FyZCIsImkiLCJzdG9yZWRTaGlwIiwiYmVlbkhpdCIsImdldEVsZW1lbnRCeUlkIiwic3R5bGUiLCJiYWNrZ3JvdW5kQ29sb3IiLCJsZW5ndGgiLCJpc1ZlcnRpY2FsIiwiaGl0Q291bnQiLCJzdW5rIiwiaGl0IiwiaW5kZXgiLCJoaXRTaGlwIiwic2hpcExlbmd0aCIsImJvYXJkQ29weSIsIk1hdGgiLCJmbG9vciIsInJhbmRvbSIsInN0YXJ0aW5nQ29sdW1uIiwic3RhcnRpbmdSb3ciLCJzbGljZSIsInNvbWUiLCJuZXdTaGlwIiwiaGFzU3RvcmVkU2hpcCIsInNsaWNlZEFycmF5IiwicHVzaCIsImNyZWF0ZUJvYXJkIiwicGxhY2VTaGlwIiwic2hpcCIsInN0YXJ0IiwicmVjZWl2ZUF0dGFjayIsImNvcmRpbmF0ZXMiLCJhbGxTaGlwc1N1bmsiLCJyYW5kb21TaGlwcyIsInJlc2V0Qm9hcmQiLCJuYW1lIiwib3BwQm9hcmQiLCJhdHRhY2siLCJhaUF0dGFjayIsInJhbmRvbU51bWJlciIsInBCb2FyZCIsImFpQm9hcmQiLCJpc1BsYXllcldvbiIsInRleHRDb250ZW50Iiwid2luQmFja2dyb3VuZCIsImRpc3BsYXkiLCJhZGRFdmVudExpc3RlbmVyIiwibWFudWFsQnV0dG9uIiwicmVtb3ZlUHJvcGVydHkiLCJwbGFjZVJhbmRvbUJ1dHRvbiIsInJlbW92ZSIsImV2ZW50IiwicmV2ZXJ0IiwiYXhpc0J1dHRvbiIsImNlbGxJZCIsIk51bWJlciIsInRhcmdldCIsImNvbHVtbkluZGV4Iiwicm93SW5kZXgiLCJ1bnZhbGlkQ2VsbHMiLCJjZWxsUmV2ZXJ0IiwiYmFja2dyb3VuZCIsImFpIiwicGxhY2VNYW51YWxseUJ1dHRvbiIsIm1hcmdpbkxlZnQiLCJoYW5kbGVDbGljayIsInF1ZXJ5U2VsZWN0b3JBbGwiLCJmb3JFYWNoIiwicmVtb3ZlRXZlbnRMaXN0ZW5lciIsInN0YXJ0QnV0dG9uIiwic2hpcENlbGxzIiwiYnV0dG9uIiwiYWxsUGxheWVyQ2VsbHMiXSwic291cmNlUm9vdCI6IiJ9