(()=>{"use strict";const e=(e,t)=>{const o=document.createElement("div");o.classList.add("cell"),"p"===t?(o.id=`${t}${e}`,document.querySelector(".playerBoard").appendChild(o)):"ai"===t&&(o.id=`${t}${e}`,document.querySelector(".aiBoard").appendChild(o))},t=(e,t,o)=>{if(o)for(let o=0;o<100;o+=1)!1!==e[o].storedShip&&!0===e[o].beenHit?document.getElementById(`${t}${o}`).style.backgroundColor="rgb(133, 255, 179)":!1===e[o].storedShip&&!0===e[o].beenHit?document.getElementById(`${t}${o}`).style.backgroundColor="rgb(255, 133, 133)":document.getElementById(`${t}${o}`).style.backgroundColor="white";else for(let o=0;o<100;o+=1)!1!==e[o].storedShip&&!1===e[o].beenHit?document.getElementById(`${t}${o}`).style.backgroundColor="rgb(68, 68, 68)":!1!==e[o].storedShip&&!0===e[o].beenHit?document.getElementById(`${t}${o}`).style.backgroundColor="rgb(133, 255, 179)":!1===e[o].storedShip&&!0===e[o].beenHit?document.getElementById(`${t}${o}`).style.backgroundColor="rgb(255, 133, 133)":document.getElementById(`${t}${o}`).style.backgroundColor="white"},o=(e,t)=>({length:e,hitCount:0,sunk:!1,hit:(e,t)=>{const o=t[e].storedShip;return o.hitCount<o.length&&(o.hitCount+=1,o.hitCount===o.length&&(o.sunk=!0)),0},isVertical:t}),r=()=>{let r=[];return{board:r,createBoard:t=>{for(let o=0;o<100;o+=1)r[o]={storedShip:!1,beenHit:!1},e(o,t)},placeShip:(e,t)=>{if(e.isVertical)for(let o=t;o<t+10*e.length;o+=10)r[o].storedShip=e;else for(let o=t;o<t+e.length;o+=1)r[o].storedShip=e},receiveAttack:(e,o,n)=>{!1!==r[e].storedShip?(r[e].beenHit=!0,r[e].storedShip.hit(e,r),t(r,o,n)):(r[e].beenHit=!0,t(r,o,n))},allShipsSunk:()=>{for(let e=0;e<100;e+=1)if(!1!==r[e].storedShip&&!1===r[e].beenHit)return!1;return!0},randomShips:(e,n)=>{let l=[...r];for(let e=0;e<100;e+=1)l[e].storedShip=!1;l=((e,t)=>{const r=[...e];if(1===Math.floor(2*Math.random())+1){let e,n;do{e=Math.floor(Math.random()*(10-t+1)),n=10*Math.floor(10*Math.random())}while(r.slice(n+e,n+e+t).some((e=>e.storedShip)));const l=o(t,!1);for(let o=0;o<t;o+=1)r[n+e+o].storedShip=l}else{let e,n,l;do{e=Math.floor(10*Math.random()),n=10*Math.floor(Math.random()*(10-t+1));const o=[];for(let l=n+e;l<e+n+10*t;l+=10)o.push(r[l]);l=o.some((e=>e.storedShip))}while(l);const d=o(t,!0);for(let o=0;o<10*t;o+=10)r[n+e+o].storedShip=d}return r})(r,5),t(l,e,n),r=l},resetBoard:()=>{for(let e=0;e<100;e+=1)r[e].storedShip=!1,r[e].beenHit=!1}}},n=(e,t)=>({name:e,oppBoard:t,attack:(e,o,r)=>{t.receiveAttack(e,o,r)},aiAttack:()=>{let e;do{e=Math.floor(99*Math.random())}while(t.board[e].beenHit);t.receiveAttack(e,"p",!1)}}),l=(e,o,r)=>{document.querySelector(".winnerText").textContent=r?"You Won Do You Want To Play Again?":"Ai Won Do You Want To Play Again";const n=document.querySelector(".winBackground");n.style.display="flex",document.querySelector(".restartButton").addEventListener("click",(()=>{e.resetBoard(),t(e.board,"p",!1),o.resetBoard(),t(o.board,"ai",!0),document.querySelector(".buttons").style.display="flex",document.querySelector(".startButton").style.display="flex";const r=document.querySelector(".manual");r.style.display="flex",r.style.removeProperty("margin-left");const l=document.querySelector(".random");l.style.display="flex",l.style.removeProperty("margin-left"),n.style.display="none"}))},d=(e,t,o)=>{const r=document.querySelector(".axisButton"),n=Number(e.target.id.slice(1)),l=n%10,d=Math.floor(n/10);if(o){if("Horizontal"===r.textContent)for(let e=0;e<t;e+=1)document.querySelector(`#p${n+e}`).style.backgroundColor="white";else if("Vertical"===r.textContent)for(let e=0;e<10*t;e+=10)document.querySelector(`#p${n+e}`).style.backgroundColor="white"}else if("Horizontal"===r.textContent){const e=l-t;if(l>9-t+1)for(let o=0;o<t-e;o+=1)document.querySelector(`#p${n+o}`).style.background="rgb(185, 74, 74)";else for(let e=0;e<t;e+=1)document.querySelector(`#p${n+e}`).style.background="lime"}else if("Vertical"===r.textContent)if(d>9-t+1)for(let e=0;e<10*t;e+=10)document.querySelector(`#p${n+e}`).style.background="rgb(185, 74, 74)";else for(let e=0;e<10*t;e+=10)document.querySelector(`#p${n+e}`).style.background="lime"},i=r();i.createBoard("p");const a=r();a.createBoard("ai");const c=n("player",a),s=n("ai",i),u=document.querySelector(".random"),y=document.querySelector(".manual");u.addEventListener("click",(()=>{y.style.display="none",u.style.marginLeft="115px",i.randomShips("p",!1)}));const m=e=>{const t=Number(e.target.id.slice(2));c.attack(t,"ai",!0),a.allShipsSunk()&&(l(i,a,!0),document.querySelectorAll('div.cell[id^="ai"]').forEach((e=>{e.removeEventListener("click",m)}))),s.aiAttack(),i.allShipsSunk()&&(l(i,a,!1),document.querySelectorAll('div.cell[id^="ai"]').forEach((e=>{e.removeEventListener("click",m)})))},h=document.querySelector(".startButton");h.addEventListener("click",(()=>{let e=0;for(let t=0;t<100;t+=1)!1!==i.board[t].storedShip&&(e+=1);5===e&&(document.querySelector(".buttons").style.display="none",h.style.display="none",a.randomShips("ai",!0),document.querySelectorAll('div.cell[id^="ai"]').forEach((e=>{e.addEventListener("click",m)})))})),y.addEventListener("click",(()=>{if(u.style.display="none",null===document.querySelector(".axisButton")){(()=>{const e=document.createElement("button");e.classList.add("axisButton"),e.textContent="Horizontal",e.addEventListener("click",(()=>{"Vertical"===e.textContent?e.textContent="Horizontal":e.textContent="Vertical"})),document.querySelector(".buttons").appendChild(e)})();const e=document.querySelectorAll('div.cell[id^="p"]');e.forEach((e=>{e.addEventListener("mouseenter",(e=>{d(e,5,!1)}))})),e.forEach((e=>{e.addEventListener("mouseleave",(e=>{d(e,5,!0)}))}))}}))})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QUcsRUFBTSxHQUN0QyxJQUdMb0IsRUFBZUwsU0FBUzNFLElBQ3BCQSxFQUFLd0QsaUJBQWlCLGNBQWVJLElBQ2pDLEVBQW1CQSxFQUFPLEdBQUcsRUFBSyxHQUNyQyxHQUVULEkiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9iYXR0bGVzaGlwLy4vc3JjL2Rpc3BsYXlCb2FyZC5qcyIsIndlYnBhY2s6Ly9iYXR0bGVzaGlwLy4vc3JjL3VwZGF0ZUJvYXJkLmpzIiwid2VicGFjazovL2JhdHRsZXNoaXAvLi9zcmMvY3JlYXRlU2hpcC5qcyIsIndlYnBhY2s6Ly9iYXR0bGVzaGlwLy4vc3JjL2dhbWVCb2FyZC5qcyIsIndlYnBhY2s6Ly9iYXR0bGVzaGlwLy4vc3JjL2NyZWF0ZVJhbmRvbVNoaXBzLmpzIiwid2VicGFjazovL2JhdHRsZXNoaXAvLi9zcmMvY3JlYXRlUGxheWVyLmpzIiwid2VicGFjazovL2JhdHRsZXNoaXAvLi9zcmMvZW5kR2FtZS5qcyIsIndlYnBhY2s6Ly9iYXR0bGVzaGlwLy4vc3JjL2Rpc3BsYXlNYW51YWxTaGlwcy5qcyIsIndlYnBhY2s6Ly9iYXR0bGVzaGlwLy4vc3JjL2luZGV4LmpzIiwid2VicGFjazovL2JhdHRsZXNoaXAvLi9zcmMvYWRkQXhpc0J1dHRvbi5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJjb25zdCBkaXNwbGF5Qm9hcmQgPSAoaWQsIHBsYXllcikgPT4ge1xuICAgIGNvbnN0IGNlbGwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICBjZWxsLmNsYXNzTGlzdC5hZGQoJ2NlbGwnKTtcblxuICAgIGlmKHBsYXllciA9PT0gJ3AnKSB7XG4gICAgICAgIGNlbGwuaWQgPSBgJHtwbGF5ZXJ9JHtpZH1gO1xuXG4gICAgICAgIGNvbnN0IHBsYXllckJvYXJkID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnBsYXllckJvYXJkJyk7XG4gICAgICAgIHBsYXllckJvYXJkLmFwcGVuZENoaWxkKGNlbGwpO1xuICAgIH0gZWxzZSBpZihwbGF5ZXIgPT09ICdhaScpIHtcbiAgICAgICAgY2VsbC5pZCA9IGAke3BsYXllcn0ke2lkfWA7XG5cbiAgICAgICAgY29uc3QgYWlCb2FyZCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5haUJvYXJkJyk7XG4gICAgICAgIGFpQm9hcmQuYXBwZW5kQ2hpbGQoY2VsbCk7XG4gICAgfVxufVxuXG5leHBvcnQgZGVmYXVsdCBkaXNwbGF5Qm9hcmQ7IiwiY29uc3QgdXBkYXRlQm9hcmQgPSAoYm9hcmQsIGJvYXJkSWQsIGlzQWlCb2FyZCkgPT4ge1xuICBpZiAoaXNBaUJvYXJkKSB7XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCAxMDA7IGkgKz0gMSkge1xuICAgICAgaWYgKGJvYXJkW2ldLnN0b3JlZFNoaXAgIT09IGZhbHNlICYmIGJvYXJkW2ldLmJlZW5IaXQgPT09IHRydWUpIHtcbiAgICAgICAgY29uc3QgY2VsbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGAke2JvYXJkSWR9JHtpfWApO1xuICAgICAgICBjZWxsLnN0eWxlLmJhY2tncm91bmRDb2xvciA9IFwicmdiKDEzMywgMjU1LCAxNzkpXCI7XG4gICAgICB9IGVsc2UgaWYgKGJvYXJkW2ldLnN0b3JlZFNoaXAgPT09IGZhbHNlICYmIGJvYXJkW2ldLmJlZW5IaXQgPT09IHRydWUpIHtcbiAgICAgICAgY29uc3QgY2VsbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGAke2JvYXJkSWR9JHtpfWApO1xuICAgICAgICBjZWxsLnN0eWxlLmJhY2tncm91bmRDb2xvciA9IFwicmdiKDI1NSwgMTMzLCAxMzMpXCI7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBjb25zdCBjZWxsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoYCR7Ym9hcmRJZH0ke2l9YCk7XG4gICAgICAgIGNlbGwuc3R5bGUuYmFja2dyb3VuZENvbG9yID0gXCJ3aGl0ZVwiO1xuICAgICAgfVxuICAgIH1cbiAgfSBlbHNlIHtcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IDEwMDsgaSArPSAxKSB7XG4gICAgICBpZiAoYm9hcmRbaV0uc3RvcmVkU2hpcCAhPT0gZmFsc2UgJiYgYm9hcmRbaV0uYmVlbkhpdCA9PT0gZmFsc2UpIHtcbiAgICAgICAgY29uc3QgY2VsbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGAke2JvYXJkSWR9JHtpfWApO1xuICAgICAgICBjZWxsLnN0eWxlLmJhY2tncm91bmRDb2xvciA9IFwicmdiKDY4LCA2OCwgNjgpXCI7XG4gICAgICB9IGVsc2UgaWYgKGJvYXJkW2ldLnN0b3JlZFNoaXAgIT09IGZhbHNlICYmIGJvYXJkW2ldLmJlZW5IaXQgPT09IHRydWUpIHtcbiAgICAgICAgY29uc3QgY2VsbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGAke2JvYXJkSWR9JHtpfWApO1xuICAgICAgICBjZWxsLnN0eWxlLmJhY2tncm91bmRDb2xvciA9IFwicmdiKDEzMywgMjU1LCAxNzkpXCI7XG4gICAgICB9IGVsc2UgaWYgKGJvYXJkW2ldLnN0b3JlZFNoaXAgPT09IGZhbHNlICYmIGJvYXJkW2ldLmJlZW5IaXQgPT09IHRydWUpIHtcbiAgICAgICAgY29uc3QgY2VsbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGAke2JvYXJkSWR9JHtpfWApO1xuICAgICAgICBjZWxsLnN0eWxlLmJhY2tncm91bmRDb2xvciA9IFwicmdiKDI1NSwgMTMzLCAxMzMpXCI7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBjb25zdCBjZWxsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoYCR7Ym9hcmRJZH0ke2l9YCk7XG4gICAgICAgIGNlbGwuc3R5bGUuYmFja2dyb3VuZENvbG9yID0gXCJ3aGl0ZVwiO1xuICAgICAgfVxuICAgIH1cbiAgfVxufTtcblxuZXhwb3J0IGRlZmF1bHQgdXBkYXRlQm9hcmQ7XG4iLCJjb25zdCBjcmVhdGVTaGlwID0gKGxlbmd0aCwgaXNWZXJ0aWNhbCkgPT4ge1xuICBjb25zdCBoaXRDb3VudCA9IDA7XG4gIGNvbnN0IHN1bmsgPSBmYWxzZTtcblxuICBjb25zdCBoaXQgPSAoaW5kZXgsIGJvYXJkKSA9PiB7XG4gICAgY29uc3QgaGl0U2hpcCA9IGJvYXJkW2luZGV4XS5zdG9yZWRTaGlwO1xuXG4gICAgaWYgKGhpdFNoaXAuaGl0Q291bnQgPCBoaXRTaGlwLmxlbmd0aCkge1xuICAgICAgICBoaXRTaGlwLmhpdENvdW50ICs9IDE7XG4gICAgICAgIGlmIChoaXRTaGlwLmhpdENvdW50ID09PSBoaXRTaGlwLmxlbmd0aCkge1xuICAgICAgICAgICAgaGl0U2hpcC5zdW5rID0gdHJ1ZTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiBoaXRDb3VudDtcbiAgfTtcblxuICByZXR1cm4geyBsZW5ndGgsIGhpdENvdW50LCBzdW5rLCBoaXQsIGlzVmVydGljYWx9O1xufTtcblxuZXhwb3J0IGRlZmF1bHQgY3JlYXRlU2hpcDsiLCJpbXBvcnQgZGlzcGxheUJvYXJkIGZyb20gXCIuL2Rpc3BsYXlCb2FyZFwiO1xuaW1wb3J0IHVwZGF0ZUJvYXJkIGZyb20gXCIuL3VwZGF0ZUJvYXJkXCI7XG5pbXBvcnQgY3JlYXRlUmFuZG9tU2hpcHMgZnJvbSBcIi4vY3JlYXRlUmFuZG9tU2hpcHNcIjtcblxuY29uc3QgZ2FtZUJvYXJkID0gKCkgPT4ge1xuICBsZXQgYm9hcmQgPSBbXTtcblxuICBjb25zdCBjcmVhdGVCb2FyZCA9IChwbGF5ZXIpID0+IHtcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IDEwMDsgaSArPSAxKSB7XG4gICAgICBib2FyZFtpXSA9IHsgc3RvcmVkU2hpcDogZmFsc2UsIGJlZW5IaXQ6IGZhbHNlIH07XG4gICAgICBkaXNwbGF5Qm9hcmQoaSwgcGxheWVyKTtcbiAgICB9XG4gIH07XG5cbiAgY29uc3QgcGxhY2VTaGlwID0gKHNoaXAsIHN0YXJ0KSA9PiB7XG4gICAgaWYgKHNoaXAuaXNWZXJ0aWNhbCkge1xuICAgICAgZm9yIChsZXQgaSA9IHN0YXJ0OyBpIDwgc3RhcnQgKyBzaGlwLmxlbmd0aCAqIDEwOyBpICs9IDEwKSB7XG4gICAgICAgIGJvYXJkW2ldLnN0b3JlZFNoaXAgPSBzaGlwO1xuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICBmb3IgKGxldCBpID0gc3RhcnQ7IGkgPCBzdGFydCArIHNoaXAubGVuZ3RoOyBpICs9IDEpIHtcbiAgICAgICAgYm9hcmRbaV0uc3RvcmVkU2hpcCA9IHNoaXA7XG4gICAgICB9XG4gICAgfVxuICB9O1xuXG4gIGNvbnN0IHJhbmRvbVNoaXBzID0gKGJvYXJkSWQsIGlzQWlCb2FyZCkgPT4ge1xuICAgIGxldCBib2FyZENvcHkgPSBbLi4uYm9hcmRdO1xuXG4gICAgZm9yKGxldCBpID0gMDsgaSA8IDEwMDsgaSArPSAxKSB7XG4gICAgICBib2FyZENvcHlbaV0uc3RvcmVkU2hpcCA9IGZhbHNlO1xuICAgIH1cblxuICAgIGJvYXJkQ29weSA9IGNyZWF0ZVJhbmRvbVNoaXBzKGJvYXJkLCA1KTtcbiAgICAvKlxuICAgIGJvYXJkQ29weSA9IGNyZWF0ZVJhbmRvbVNoaXBzKGJvYXJkLCA0KTtcbiAgICBib2FyZENvcHkgPSBjcmVhdGVSYW5kb21TaGlwcyhib2FyZCwgMyk7XG4gICAgYm9hcmRDb3B5ID0gY3JlYXRlUmFuZG9tU2hpcHMoYm9hcmQsIDMpO1xuICAgIGJvYXJkQ29weSA9IGNyZWF0ZVJhbmRvbVNoaXBzKGJvYXJkLCAyKTtcbiAgICAqL1xuXG4gICAgdXBkYXRlQm9hcmQoYm9hcmRDb3B5LCBib2FyZElkLCBpc0FpQm9hcmQpO1xuICAgIGJvYXJkID0gYm9hcmRDb3B5O1xuICB9XG5cbiAgY29uc3QgcmVjZWl2ZUF0dGFjayA9IChjb3JkaW5hdGVzLCBib2FyZElkLCBpc0FpQm9hcmQpID0+IHtcbiAgICBpZiAoYm9hcmRbY29yZGluYXRlc10uc3RvcmVkU2hpcCAhPT0gZmFsc2UpIHtcbiAgICAgIGJvYXJkW2NvcmRpbmF0ZXNdLmJlZW5IaXQgPSB0cnVlO1xuICAgICAgYm9hcmRbY29yZGluYXRlc10uc3RvcmVkU2hpcC5oaXQoY29yZGluYXRlcywgYm9hcmQpO1xuICAgICAgdXBkYXRlQm9hcmQoYm9hcmQsIGJvYXJkSWQsIGlzQWlCb2FyZCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGJvYXJkW2NvcmRpbmF0ZXNdLmJlZW5IaXQgPSB0cnVlO1xuICAgICAgdXBkYXRlQm9hcmQoYm9hcmQsIGJvYXJkSWQsIGlzQWlCb2FyZCk7XG4gICAgfVxuICB9O1xuXG4gIGNvbnN0IGFsbFNoaXBzU3VuayA9ICgpID0+IHtcbiAgICBmb3IobGV0IGk9MDsgaSA8IDEwMDsgaSArPSAxKSB7XG4gICAgICBpZihib2FyZFtpXS5zdG9yZWRTaGlwICE9PSBmYWxzZSAmJiBib2FyZFtpXS5iZWVuSGl0ID09PSBmYWxzZSkge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIHRydWU7XG4gIH1cblxuICBjb25zdCByZXNldEJvYXJkID0gKCkgPT4ge1xuICAgIGZvcihsZXQgaT0wOyBpIDwgMTAwOyBpICs9IDEpIHtcbiAgICAgIGJvYXJkW2ldLnN0b3JlZFNoaXAgPSBmYWxzZTtcbiAgICAgIGJvYXJkW2ldLmJlZW5IaXQgPSBmYWxzZTtcbiAgICB9XG4gIH1cblxuICByZXR1cm4geyBib2FyZCwgY3JlYXRlQm9hcmQsIHBsYWNlU2hpcCwgcmVjZWl2ZUF0dGFjaywgYWxsU2hpcHNTdW5rLCByYW5kb21TaGlwcywgcmVzZXRCb2FyZCB9O1xufTtcblxuZXhwb3J0IGRlZmF1bHQgZ2FtZUJvYXJkOyIsImltcG9ydCBjcmVhdGVTaGlwIGZyb20gXCIuL2NyZWF0ZVNoaXBcIjtcblxuY29uc3QgY3JlYXRlUmFuZG9tU2hpcHMgPSAoYm9hcmQsIHNoaXBMZW5ndGgpID0+IHtcbiAgICBjb25zdCBheGlzRGVjaWRlciA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDIpICsgMTtcbiAgICBjb25zdCBib2FyZENvcHkgPSBbLi4uYm9hcmRdO1xuXG4gICAgaWYoYXhpc0RlY2lkZXIgPT09IDEpIHtcbiAgICAgICAgbGV0IHN0YXJ0aW5nQ29sdW1uO1xuICAgICAgICBsZXQgc3RhcnRpbmdSb3c7XG5cbiAgICAgICAgZG8ge1xuICAgICAgICAgICAgc3RhcnRpbmdDb2x1bW4gPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAoKDEwIC0gc2hpcExlbmd0aCkgKyAxKSk7XG4gICAgICAgICAgICBzdGFydGluZ1JvdyA9IChNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAxMCkpICogMTA7XG4gICAgICAgIH0gd2hpbGUgKFxuICAgICAgICAgICAgYm9hcmRDb3B5LnNsaWNlKHN0YXJ0aW5nUm93ICsgc3RhcnRpbmdDb2x1bW4sIHN0YXJ0aW5nUm93ICsgc3RhcnRpbmdDb2x1bW4gKyBzaGlwTGVuZ3RoKVxuICAgICAgICAgICAgLnNvbWUoY2VsbCA9PiBjZWxsLnN0b3JlZFNoaXApXG4gICAgICAgIClcblxuICAgICAgICBjb25zdCBuZXdTaGlwID0gY3JlYXRlU2hpcChzaGlwTGVuZ3RoLCBmYWxzZSk7XG4gICAgICAgIGZvcihsZXQgaSA9IDA7IGkgPCBzaGlwTGVuZ3RoOyBpICs9IDEpIHtcbiAgICAgICAgICAgIGJvYXJkQ29weVtzdGFydGluZ1JvdyArIHN0YXJ0aW5nQ29sdW1uICsgaV0uc3RvcmVkU2hpcCA9IG5ld1NoaXA7XG4gICAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgICBsZXQgc3RhcnRpbmdDb2x1bW47XG4gICAgICAgIGxldCBzdGFydGluZ1JvdztcbiAgICAgICAgbGV0IGhhc1N0b3JlZFNoaXBcblxuICAgICAgICBkbyB7XG4gICAgICAgICAgICBzdGFydGluZ0NvbHVtbiA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDEwKTtcbiAgICAgICAgICAgIHN0YXJ0aW5nUm93ID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogKCgxMCAtIHNoaXBMZW5ndGgpICsgMSkpICogMTA7XG4gICAgICAgIFxuICAgICAgICAgICAgY29uc3Qgc2xpY2VkQXJyYXkgPSBbXTtcbiAgICAgICAgICAgIGZvciAobGV0IGkgPSBzdGFydGluZ1JvdyArIHN0YXJ0aW5nQ29sdW1uOyBpIDwgc3RhcnRpbmdDb2x1bW4gKyBzdGFydGluZ1JvdyArIChzaGlwTGVuZ3RoICogMTApOyBpICs9IDEwKSB7XG4gICAgICAgICAgICAgICAgc2xpY2VkQXJyYXkucHVzaChib2FyZENvcHlbaV0pO1xuICAgICAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgICAgIGhhc1N0b3JlZFNoaXAgPSBzbGljZWRBcnJheS5zb21lKGNlbGwgPT4gY2VsbC5zdG9yZWRTaGlwKTtcbiAgICAgICAgfSB3aGlsZSAoaGFzU3RvcmVkU2hpcCk7XG5cbiAgICAgICAgY29uc3QgbmV3U2hpcCA9IGNyZWF0ZVNoaXAoc2hpcExlbmd0aCwgdHJ1ZSk7XG4gICAgICAgIGZvcihsZXQgaSA9IDA7IGkgPCBzaGlwTGVuZ3RoICogMTA7IGkgKz0gMTApIHtcbiAgICAgICAgICAgIGJvYXJkQ29weVtzdGFydGluZ1JvdyArIHN0YXJ0aW5nQ29sdW1uICsgaV0uc3RvcmVkU2hpcCA9IG5ld1NoaXA7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gYm9hcmRDb3B5O1xufVxuXG5leHBvcnQgZGVmYXVsdCBjcmVhdGVSYW5kb21TaGlwczsiLCJjb25zdCBjcmVhdGVQbGF5ZXIgPSAobmFtZSwgb3BwQm9hcmQpID0+IHtcblxuICAgIGNvbnN0IGF0dGFjayA9IChjb3JkaW5hdGVzLCBib2FyZElkLCBpc0FpQm9hcmQpID0+IHtcbiAgICAgICAgb3BwQm9hcmQucmVjZWl2ZUF0dGFjayhjb3JkaW5hdGVzLCBib2FyZElkLCBpc0FpQm9hcmQpO1xuICAgIH1cblxuICAgIGNvbnN0IGFpQXR0YWNrID0gKCkgPT4ge1xuICAgICAgICBsZXQgcmFuZG9tTnVtYmVyO1xuICAgICAgICBkbyB7XG4gICAgICAgICAgICByYW5kb21OdW1iZXIgPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiA5OSk7XG4gICAgICAgIH0gd2hpbGUgKG9wcEJvYXJkLmJvYXJkW3JhbmRvbU51bWJlcl0uYmVlbkhpdCk7XG5cbiAgICAgICAgb3BwQm9hcmQucmVjZWl2ZUF0dGFjayhyYW5kb21OdW1iZXIsICdwJywgZmFsc2UpO1xuICAgIH1cblxuICAgIHJldHVybiB7IG5hbWUsIG9wcEJvYXJkLCBhdHRhY2ssIGFpQXR0YWNrIH1cbn1cblxuZXhwb3J0IGRlZmF1bHQgY3JlYXRlUGxheWVyOyIsImltcG9ydCB1cGRhdGVCb2FyZCBmcm9tIFwiLi91cGRhdGVCb2FyZFwiO1xuXG5jb25zdCBlbmRHYW1lID0gKHBCb2FyZCwgYWlCb2FyZCwgaXNQbGF5ZXJXb24pID0+IHtcbiAgICBpZihpc1BsYXllcldvbikge1xuICAgICAgICBjb25zdCB3aW5uZXJUZXh0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLndpbm5lclRleHQnKTtcbiAgICAgICAgd2lubmVyVGV4dC50ZXh0Q29udGVudCA9ICdZb3UgV29uIERvIFlvdSBXYW50IFRvIFBsYXkgQWdhaW4/JztcbiAgICB9IGVsc2Uge1xuICAgICAgICBjb25zdCB3aW5uZXJUZXh0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLndpbm5lclRleHQnKTtcbiAgICAgICAgd2lubmVyVGV4dC50ZXh0Q29udGVudCA9ICdBaSBXb24gRG8gWW91IFdhbnQgVG8gUGxheSBBZ2Fpbic7XG4gICAgfVxuXG4gICAgY29uc3Qgd2luQmFja2dyb3VuZCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy53aW5CYWNrZ3JvdW5kJyk7XG4gICAgd2luQmFja2dyb3VuZC5zdHlsZS5kaXNwbGF5ID0gJ2ZsZXgnO1xuXG4gICAgY29uc3QgcmVzdGFydEJ1dHRvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5yZXN0YXJ0QnV0dG9uJyk7XG4gICAgcmVzdGFydEJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHtcbiAgICAgICAgcEJvYXJkLnJlc2V0Qm9hcmQoKTtcbiAgICAgICAgdXBkYXRlQm9hcmQocEJvYXJkLmJvYXJkLCAncCcsIGZhbHNlKTtcblxuICAgICAgICBhaUJvYXJkLnJlc2V0Qm9hcmQoKTtcbiAgICAgICAgdXBkYXRlQm9hcmQoYWlCb2FyZC5ib2FyZCwgJ2FpJywgdHJ1ZSk7XG5cbiAgICAgICAgY29uc3QgYnV0dG9uc0RpdiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5idXR0b25zJyk7XG4gICAgICAgIGJ1dHRvbnNEaXYuc3R5bGUuZGlzcGxheSA9ICdmbGV4JztcblxuICAgICAgICBjb25zdCBzdGFydEJ1dHRvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5zdGFydEJ1dHRvbicpO1xuICAgICAgICBzdGFydEJ1dHRvbi5zdHlsZS5kaXNwbGF5ID0gJ2ZsZXgnO1xuXG4gICAgICAgIGNvbnN0IG1hbnVhbEJ1dHRvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5tYW51YWwnKTtcbiAgICAgICAgbWFudWFsQnV0dG9uLnN0eWxlLmRpc3BsYXkgPSAnZmxleCc7XG4gICAgICAgIG1hbnVhbEJ1dHRvbi5zdHlsZS5yZW1vdmVQcm9wZXJ0eSgnbWFyZ2luLWxlZnQnKTtcblxuICAgICAgICBjb25zdCBwbGFjZVJhbmRvbUJ1dHRvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5yYW5kb20nKTtcbiAgICAgICAgcGxhY2VSYW5kb21CdXR0b24uc3R5bGUuZGlzcGxheSA9ICdmbGV4JztcbiAgICAgICAgcGxhY2VSYW5kb21CdXR0b24uc3R5bGUucmVtb3ZlUHJvcGVydHkoJ21hcmdpbi1sZWZ0Jyk7XG5cbiAgICAgICAgd2luQmFja2dyb3VuZC5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnO1xuICAgIH0pXG59XG5cbmV4cG9ydCBkZWZhdWx0IGVuZEdhbWU7IiwiY29uc3QgZGlzcGxheU1hbnVhbFNoaXBzID0gKGV2ZW50LCBzaGlwTGVuZ3RoLCByZXZlcnQpID0+IHtcbiAgICBjb25zdCBheGlzQnV0dG9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmF4aXNCdXR0b24nKTtcbiAgICBjb25zdCBjZWxsSWQgPSBOdW1iZXIoZXZlbnQudGFyZ2V0LmlkLnNsaWNlKDEpKTtcbiAgICBjb25zdCBjb2x1bW5JbmRleCA9IGNlbGxJZCAlIDEwO1xuICAgIGNvbnN0IHJvd0luZGV4ID0gTWF0aC5mbG9vcihjZWxsSWQgLyAxMCk7XG5cbiAgICBpZihyZXZlcnQpIHtcblxuICAgICAgICBpZihheGlzQnV0dG9uLnRleHRDb250ZW50ID09PSAnSG9yaXpvbnRhbCcpIHtcbiAgICAgICAgICAgIGZvcihsZXQgaSA9IDA7IGkgPCBzaGlwTGVuZ3RoOyBpICs9IDEpIHtcbiAgICAgICAgICAgICAgICBjb25zdCBjZWxsUmV2ZXJ0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihgI3Ake2NlbGxJZCArIGl9YCk7XG4gICAgICAgICAgICAgICAgY2VsbFJldmVydC5zdHlsZS5iYWNrZ3JvdW5kQ29sb3IgPSAnd2hpdGUnO1xuICAgICAgICAgICAgfVxuICAgICAgICB9IGVsc2UgaWYoYXhpc0J1dHRvbi50ZXh0Q29udGVudCA9PT0gJ1ZlcnRpY2FsJykge1xuICAgICAgICAgICAgZm9yKGxldCBpID0gMDsgaSA8IHNoaXBMZW5ndGggKiAxMDsgaSArPSAxMCkge1xuICAgICAgICAgICAgICAgIGNvbnN0IGNlbGxSZXZlcnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGAjcCR7Y2VsbElkICsgaX1gKTtcbiAgICAgICAgICAgICAgICBjZWxsUmV2ZXJ0LnN0eWxlLmJhY2tncm91bmRDb2xvciA9ICd3aGl0ZSc7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgIH0gZWxzZSBpZihheGlzQnV0dG9uLnRleHRDb250ZW50ID09PSAnSG9yaXpvbnRhbCcpIHtcblxuICAgICAgICBjb25zdCB1bnZhbGlkQ2VsbHMgPSBjb2x1bW5JbmRleCAtIHNoaXBMZW5ndGg7XG4gICAgICAgIGlmKGNvbHVtbkluZGV4ID4gKDkgLSBzaGlwTGVuZ3RoKSArIDEpIHtcbiAgICAgICAgICAgIGZvcihsZXQgaSA9IDA7IGkgPCBzaGlwTGVuZ3RoIC0gdW52YWxpZENlbGxzOyBpICs9IDEpIHtcbiAgICAgICAgICAgICAgICBjb25zdCBjZWxsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihgI3Ake2NlbGxJZCArIGl9YCk7XG4gICAgICAgICAgICAgICAgY2VsbC5zdHlsZS5iYWNrZ3JvdW5kID0gJ3JnYigxODUsIDc0LCA3NCknO1xuICAgICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgZm9yKGxldCBpID0gMDsgaSA8IHNoaXBMZW5ndGg7IGkgKz0gMSkge1xuICAgICAgICAgICAgICAgIGNvbnN0IGNlbGwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGAjcCR7Y2VsbElkICsgaX1gKTtcbiAgICAgICAgICAgICAgICBjZWxsLnN0eWxlLmJhY2tncm91bmQgPSAnbGltZSc7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgIH0gZWxzZSBpZihheGlzQnV0dG9uLnRleHRDb250ZW50ID09PSAnVmVydGljYWwnKXtcblxuICAgICAgICBpZihyb3dJbmRleCA+ICg5IC0gc2hpcExlbmd0aCkgKyAxKSB7XG4gICAgICAgICAgICBmb3IobGV0IGkgPSAwOyBpIDwgc2hpcExlbmd0aCAqIDEwOyBpICs9IDEwKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgY2VsbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYCNwJHtjZWxsSWQgKyBpfWApO1xuICAgICAgICAgICAgICAgIGNlbGwuc3R5bGUuYmFja2dyb3VuZCA9ICdyZ2IoMTg1LCA3NCwgNzQpJztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGZvcihsZXQgaSA9IDA7IGkgPCBzaGlwTGVuZ3RoICogMTA7IGkgKz0gMTApIHtcbiAgICAgICAgICAgICAgICBjb25zdCBjZWxsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihgI3Ake2NlbGxJZCArIGl9YCk7XG4gICAgICAgICAgICAgICAgY2VsbC5zdHlsZS5iYWNrZ3JvdW5kID0gJ2xpbWUnO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIFxuICAgIH1cblxufVxuXG5leHBvcnQgZGVmYXVsdCBkaXNwbGF5TWFudWFsU2hpcHM7IiwiaW1wb3J0IGdhbWVCb2FyZCBmcm9tIFwiLi9nYW1lQm9hcmRcIjtcbmltcG9ydCBjcmVhdGVQbGF5ZXIgZnJvbSBcIi4vY3JlYXRlUGxheWVyXCI7XG5pbXBvcnQgZW5kR2FtZSBmcm9tIFwiLi9lbmRHYW1lXCI7XG5pbXBvcnQgYWRkQXhpc0J1dHRvbiBmcm9tIFwiLi9hZGRBeGlzQnV0dG9uXCI7XG5pbXBvcnQgZGlzcGxheU1hbnVhbFNoaXBzIGZyb20gXCIuL2Rpc3BsYXlNYW51YWxTaGlwc1wiO1xuXG5cbmNvbnN0IHBCb2FyZCA9IGdhbWVCb2FyZCgpO1xucEJvYXJkLmNyZWF0ZUJvYXJkKCdwJyk7XG5jb25zdCBhaUJvYXJkID0gZ2FtZUJvYXJkKCk7XG5haUJvYXJkLmNyZWF0ZUJvYXJkKCdhaScpO1xuXG5jb25zdCBwbGF5ZXIgPSBjcmVhdGVQbGF5ZXIoJ3BsYXllcicsIGFpQm9hcmQpO1xuY29uc3QgYWkgPSBjcmVhdGVQbGF5ZXIoJ2FpJywgcEJvYXJkKTtcblxuY29uc3QgcGxhY2VSYW5kb21CdXR0b24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcucmFuZG9tJyk7XG5jb25zdCBwbGFjZU1hbnVhbGx5QnV0dG9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLm1hbnVhbCcpO1xuXG5wbGFjZVJhbmRvbUJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHtcbiAgICBwbGFjZU1hbnVhbGx5QnV0dG9uLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7XG5cbiAgICBwbGFjZVJhbmRvbUJ1dHRvbi5zdHlsZS5tYXJnaW5MZWZ0ID0gJzExNXB4JztcblxuICAgIHBCb2FyZC5yYW5kb21TaGlwcygncCcsIGZhbHNlKTtcbn0pXG5cbmNvbnN0IGhhbmRsZUNsaWNrID0gKGV2ZW50KSA9PiB7XG4gICAgY29uc3QgaW5kZXggPSBOdW1iZXIoZXZlbnQudGFyZ2V0LmlkLnNsaWNlKDIpKVxuICAgIFxuICAgIHBsYXllci5hdHRhY2soaW5kZXgsICdhaScsIHRydWUpO1xuICAgIGNvbnN0IGlzUGxheWVyV29uID0gYWlCb2FyZC5hbGxTaGlwc1N1bmsoKTtcbiAgICBpZihpc1BsYXllcldvbikge1xuICAgICAgICBlbmRHYW1lKHBCb2FyZCwgYWlCb2FyZCwgdHJ1ZSk7XG5cbiAgICAgICAgY29uc3QgYWxsQ2VsbHMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCdkaXYuY2VsbFtpZF49XCJhaVwiXScpO1xuICAgICAgICBhbGxDZWxscy5mb3JFYWNoKChjZWxsKSA9PiB7XG4gICAgICAgICAgICBjZWxsLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgaGFuZGxlQ2xpY2spO1xuICAgICAgICB9KVxuICAgIH1cblxuICAgIGFpLmFpQXR0YWNrKCk7XG4gICAgY29uc3QgaXNBaVdvbiA9IHBCb2FyZC5hbGxTaGlwc1N1bmsoKTtcbiAgICBpZihpc0FpV29uKSB7XG4gICAgICAgIGVuZEdhbWUocEJvYXJkLCBhaUJvYXJkLCBmYWxzZSk7XG5cbiAgICAgICAgY29uc3QgYWxsQ2VsbHMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCdkaXYuY2VsbFtpZF49XCJhaVwiXScpO1xuICAgICAgICBhbGxDZWxscy5mb3JFYWNoKChjZWxsKSA9PiB7XG4gICAgICAgICAgICBjZWxsLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgaGFuZGxlQ2xpY2spO1xuICAgICAgICB9KVxuICAgIH1cbn1cblxuY29uc3Qgc3RhcnRCdXR0b24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuc3RhcnRCdXR0b24nKTtcbnN0YXJ0QnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4ge1xuICAgIGxldCBzaGlwQ2VsbHMgPSAwO1xuICAgIGZvcihsZXQgaSA9IDA7IGkgPCAxMDA7IGkgKz0gMSkge1xuICAgICAgICBpZihwQm9hcmQuYm9hcmRbaV0uc3RvcmVkU2hpcCAhPT0gZmFsc2UpIHtcbiAgICAgICAgICAgIHNoaXBDZWxscyArPSAxO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgLypcbiAgICAgICAgY2hhbmdlIHRoZSBudW1iZXIgYmFjayB0byAxN1xuICAgICovXG4gICAgaWYoc2hpcENlbGxzID09PSA1KSB7XG4gICAgICAgIGNvbnN0IGJ1dHRvbnNEaXYgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuYnV0dG9ucycpO1xuICAgICAgICBidXR0b25zRGl2LnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7XG4gICAgICAgIHN0YXJ0QnV0dG9uLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7XG5cblxuICAgICAgICBhaUJvYXJkLnJhbmRvbVNoaXBzKCdhaScsIHRydWUpO1xuXG4gICAgICAgIGNvbnN0IGFsbENlbGxzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnZGl2LmNlbGxbaWRePVwiYWlcIl0nKTtcbiAgICAgICAgYWxsQ2VsbHMuZm9yRWFjaCgoY2VsbCkgPT4ge1xuICAgICAgICAgICAgY2VsbC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGhhbmRsZUNsaWNrKTtcbiAgICAgICAgfSlcbiAgICB9XG59KVxuXG5wbGFjZU1hbnVhbGx5QnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4ge1xuICAgIHBsYWNlUmFuZG9tQnV0dG9uLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7XG5cbiAgICBjb25zdCBheGlzQnV0dG9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmF4aXNCdXR0b24nKTtcbiAgICBpZihheGlzQnV0dG9uID09PSBudWxsKSB7XG4gICAgICAgIGFkZEF4aXNCdXR0b24oKTtcblxuICAgICAgICBjb25zdCBhbGxQbGF5ZXJDZWxscyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJ2Rpdi5jZWxsW2lkXj1cInBcIl0nKTtcbiAgICAgICAgYWxsUGxheWVyQ2VsbHMuZm9yRWFjaCgoY2VsbCkgPT4ge1xuICAgICAgICAgICAgY2VsbC5hZGRFdmVudExpc3RlbmVyKCdtb3VzZWVudGVyJywgKGV2ZW50KSA9PiB7XG4gICAgICAgICAgICAgICAgZGlzcGxheU1hbnVhbFNoaXBzKGV2ZW50LCA1LCBmYWxzZSk7XG4gICAgICAgICAgICB9KVxuICAgICAgICB9KVxuXG4gICAgICAgIGFsbFBsYXllckNlbGxzLmZvckVhY2goKGNlbGwpID0+IHtcbiAgICAgICAgICAgIGNlbGwuYWRkRXZlbnRMaXN0ZW5lcignbW91c2VsZWF2ZScsIChldmVudCkgPT4ge1xuICAgICAgICAgICAgICAgIGRpc3BsYXlNYW51YWxTaGlwcyhldmVudCwgNSwgdHJ1ZSk7XG4gICAgICAgICAgICB9KVxuICAgICAgICB9KVxuICAgIH1cbn0pXG4iLCJjb25zdCBhZGRBeGlzQnV0dG9uID0gKCkgPT4ge1xuICAgIGNvbnN0IGJ1dHRvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2J1dHRvbicpO1xuICAgIGJ1dHRvbi5jbGFzc0xpc3QuYWRkKCdheGlzQnV0dG9uJyk7XG4gICAgYnV0dG9uLnRleHRDb250ZW50ID0gJ0hvcml6b250YWwnO1xuXG4gICAgYnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4ge1xuICAgICAgICBpZihidXR0b24udGV4dENvbnRlbnQgPT09ICdWZXJ0aWNhbCcpIHtcbiAgICAgICAgICAgIGJ1dHRvbi50ZXh0Q29udGVudCA9ICdIb3Jpem9udGFsJztcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGJ1dHRvbi50ZXh0Q29udGVudCA9ICdWZXJ0aWNhbCc7XG4gICAgICAgIH1cbiAgICB9KVxuXG4gICAgY29uc3QgYnV0dG9uc0RpdiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5idXR0b25zJyk7XG4gICAgYnV0dG9uc0Rpdi5hcHBlbmRDaGlsZChidXR0b24pO1xufVxuXG5leHBvcnQgZGVmYXVsdCBhZGRBeGlzQnV0dG9uOyJdLCJuYW1lcyI6WyJpZCIsInBsYXllciIsImNlbGwiLCJkb2N1bWVudCIsImNyZWF0ZUVsZW1lbnQiLCJjbGFzc0xpc3QiLCJhZGQiLCJxdWVyeVNlbGVjdG9yIiwiYXBwZW5kQ2hpbGQiLCJib2FyZCIsImJvYXJkSWQiLCJpc0FpQm9hcmQiLCJpIiwic3RvcmVkU2hpcCIsImJlZW5IaXQiLCJnZXRFbGVtZW50QnlJZCIsInN0eWxlIiwiYmFja2dyb3VuZENvbG9yIiwibGVuZ3RoIiwiaXNWZXJ0aWNhbCIsImhpdENvdW50Iiwic3VuayIsImhpdCIsImluZGV4IiwiaGl0U2hpcCIsImNyZWF0ZUJvYXJkIiwicGxhY2VTaGlwIiwic2hpcCIsInN0YXJ0IiwicmVjZWl2ZUF0dGFjayIsImNvcmRpbmF0ZXMiLCJhbGxTaGlwc1N1bmsiLCJyYW5kb21TaGlwcyIsImJvYXJkQ29weSIsInNoaXBMZW5ndGgiLCJNYXRoIiwiZmxvb3IiLCJyYW5kb20iLCJzdGFydGluZ0NvbHVtbiIsInN0YXJ0aW5nUm93Iiwic2xpY2UiLCJzb21lIiwibmV3U2hpcCIsImhhc1N0b3JlZFNoaXAiLCJzbGljZWRBcnJheSIsInB1c2giLCJyZXNldEJvYXJkIiwibmFtZSIsIm9wcEJvYXJkIiwiYXR0YWNrIiwiYWlBdHRhY2siLCJyYW5kb21OdW1iZXIiLCJwQm9hcmQiLCJhaUJvYXJkIiwiaXNQbGF5ZXJXb24iLCJ0ZXh0Q29udGVudCIsIndpbkJhY2tncm91bmQiLCJkaXNwbGF5IiwiYWRkRXZlbnRMaXN0ZW5lciIsIm1hbnVhbEJ1dHRvbiIsInJlbW92ZVByb3BlcnR5IiwicGxhY2VSYW5kb21CdXR0b24iLCJldmVudCIsInJldmVydCIsImF4aXNCdXR0b24iLCJjZWxsSWQiLCJOdW1iZXIiLCJ0YXJnZXQiLCJjb2x1bW5JbmRleCIsInJvd0luZGV4IiwidW52YWxpZENlbGxzIiwiYmFja2dyb3VuZCIsImFpIiwicGxhY2VNYW51YWxseUJ1dHRvbiIsIm1hcmdpbkxlZnQiLCJoYW5kbGVDbGljayIsInF1ZXJ5U2VsZWN0b3JBbGwiLCJmb3JFYWNoIiwicmVtb3ZlRXZlbnRMaXN0ZW5lciIsInN0YXJ0QnV0dG9uIiwic2hpcENlbGxzIiwiYnV0dG9uIiwiYWxsUGxheWVyQ2VsbHMiXSwic291cmNlUm9vdCI6IiJ9