(()=>{"use strict";const e=(e,t)=>{const o=document.createElement("div");o.classList.add("cell"),"p"===t?(o.id=`${t}${e}`,document.querySelector(".playerBoard").appendChild(o)):"ai"===t&&(o.id=`${t}${e}`,document.querySelector(".aiBoard").appendChild(o))},t=(e,t,o)=>{if(o)for(let o=0;o<100;o+=1)!1!==e[o].storedShip&&!0===e[o].beenHit?document.getElementById(`${t}${o}`).style.backgroundColor="rgb(133, 255, 179)":!1===e[o].storedShip&&!0===e[o].beenHit?document.getElementById(`${t}${o}`).style.backgroundColor="rgb(255, 133, 133)":document.getElementById(`${t}${o}`).style.backgroundColor="white";else for(let o=0;o<100;o+=1)!1!==e[o].storedShip&&!1===e[o].beenHit?document.getElementById(`${t}${o}`).style.backgroundColor="rgb(68, 68, 68)":!1!==e[o].storedShip&&!0===e[o].beenHit?document.getElementById(`${t}${o}`).style.backgroundColor="rgb(133, 255, 179)":!1===e[o].storedShip&&!0===e[o].beenHit?document.getElementById(`${t}${o}`).style.backgroundColor="rgb(255, 133, 133)":document.getElementById(`${t}${o}`).style.backgroundColor="white"},o=(e,t)=>({length:e,hitCount:0,sunk:!1,hit:(e,t)=>{const o=t[e].storedShip;return o.hitCount<o.length&&(o.hitCount+=1,o.hitCount===o.length&&(o.sunk=!0)),0},isVertical:t}),r=()=>{let r=[];return{board:r,createBoard:t=>{for(let o=0;o<100;o+=1)r[o]={storedShip:!1,beenHit:!1},e(o,t)},placeShip:(e,t)=>{if(e.isVertical)for(let o=t;o<t+10*e.length;o+=10)r[o].storedShip=e;else for(let o=t;o<t+e.length;o+=1)r[o].storedShip=e},receiveAttack:(e,o,n)=>{!1!==r[e].storedShip?(r[e].beenHit=!0,r[e].storedShip.hit(e,r),t(r,o,n)):(r[e].beenHit=!0,t(r,o,n))},allShipsSunk:()=>{for(let e=0;e<100;e+=1)if(!1!==r[e].storedShip&&!1===r[e].beenHit)return!1;return!0},randomShips:(e,n)=>{let l=[...r];for(let e=0;e<100;e+=1)l[e].storedShip=!1;l=((e,t)=>{const r=[...e];if(1===Math.floor(2*Math.random())+1){let e,n;do{e=Math.floor(Math.random()*(10-t+1)),n=10*Math.floor(10*Math.random())}while(r.slice(n+e,n+e+t).some((e=>e.storedShip)));const l=o(t,!1);for(let o=0;o<t;o+=1)r[n+e+o].storedShip=l}else{let e,n,l;do{e=Math.floor(10*Math.random()),n=10*Math.floor(Math.random()*(10-t+1));const o=[];for(let l=n+e;l<e+n+10*t;l+=10)o.push(r[l]);l=o.some((e=>e.storedShip))}while(l);const d=o(t,!0);for(let o=0;o<10*t;o+=10)r[n+e+o].storedShip=d}return r})(r,5),t(l,e,n),r=l},resetBoard:()=>{for(let e=0;e<100;e+=1)r[e].storedShip=!1,r[e].beenHit=!1}}},n=(e,t)=>({name:e,oppBoard:t,attack:(e,o,r)=>{t.receiveAttack(e,o,r)},aiAttack:()=>{let e;do{e=Math.floor(99*Math.random())}while(t.board[e].beenHit);t.receiveAttack(e,"p",!1)}}),l=(e,o,r)=>{document.querySelector(".winnerText").textContent=r?"You Won Do You Want To Play Again?":"Ai Won Do You Want To Play Again";const n=document.querySelector(".winBackground");n.style.display="flex",document.querySelector(".restartButton").addEventListener("click",(()=>{e.resetBoard(),t(e.board,"p",!1),o.resetBoard(),t(o.board,"ai",!0),document.querySelector(".buttons").style.display="flex",document.querySelector(".startButton").style.display="flex";const r=document.querySelector(".manual");r.style.display="flex",r.style.removeProperty("margin-left");const l=document.querySelector(".random");l.style.display="flex",l.style.removeProperty("margin-left"),n.style.display="none"}))},d=r();d.createBoard("p");const i=r();i.createBoard("ai");const a=n("player",i),c=n("ai",d),s=document.querySelector(".random"),u=document.querySelector(".manual");s.addEventListener("click",(()=>{u.style.display="none",s.style.marginLeft="115px",d.randomShips("p",!1)}));const h=e=>{const t=Number(e.target.id.slice(2));a.attack(t,"ai",!0),i.allShipsSunk()&&(l(d,i,!0),document.querySelectorAll('div.cell[id^="ai"]').forEach((e=>{e.removeEventListener("click",h)}))),c.aiAttack(),d.allShipsSunk()&&(l(d,i,!1),document.querySelectorAll('div.cell[id^="ai"]').forEach((e=>{e.removeEventListener("click",h)})))},m=document.querySelector(".startButton");m.addEventListener("click",(()=>{let e=0;for(let t=0;t<100;t+=1)!1!==d.board[t].storedShip&&(e+=1);5===e&&(document.querySelector(".buttons").style.display="none",m.style.display="none",i.randomShips("ai",!0),document.querySelectorAll('div.cell[id^="ai"]').forEach((e=>{e.addEventListener("click",h)})))})),u.addEventListener("click",(()=>{s.style.display="none",null===document.querySelector(".axisButton")&&((()=>{const e=document.createElement("button");e.classList.add("axisButton"),e.textContent="Vertical",e.addEventListener("click",(()=>{"Vertical"===e.textContent?e.textContent="Horizontal":e.textContent="Vertical"})),document.querySelector(".buttons").appendChild(e)})(),document.querySelector('div.cell[id^="p"]').forEach((e=>{e.addEventListener("mouseover",(()=>{}))})))}))})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QkFBaUIsc0JBQ2xDQyxTQUFTcEUsSUFDZEEsRUFBS3FFLG9CQUFvQixRQUFTTixFQUFZLElBRXRELEVBR0VPLEVBQWNyRSxTQUFTSSxjQUFjLGdCQUMzQ2lFLEVBQVlkLGlCQUFpQixTQUFTLEtBQ2xDLElBQUllLEVBQVksRUFDaEIsSUFBSSxJQUFJN0QsRUFBSSxFQUFHQSxFQUFJLElBQUtBLEdBQUssR0FDUyxJQUEvQndDLEVBQU8zQyxNQUFNRyxHQUFHQyxhQUNmNEQsR0FBYSxHQU9KLElBQWRBLElBQ29CdEUsU0FBU0ksY0FBYyxZQUMvQlMsTUFBTXlDLFFBQVUsT0FDM0JlLEVBQVl4RCxNQUFNeUMsUUFBVSxPQUc1QkosRUFBUXJCLFlBQVksTUFBTSxHQUVUN0IsU0FBU2tFLGlCQUFpQixzQkFDbENDLFNBQVNwRSxJQUNkQSxFQUFLd0QsaUJBQWlCLFFBQVNPLEVBQVksSUFFbkQsSUFHSkYsRUFBb0JMLGlCQUFpQixTQUFTLEtBQzFDRyxFQUFrQjdDLE1BQU15QyxRQUFVLE9BR2hCLE9BREN0RCxTQUFTSSxjQUFjLGlCQ2pGeEIsTUFDbEIsTUFBTW1FLEVBQVN2RSxTQUFTQyxjQUFjLFVBQ3RDc0UsRUFBT3JFLFVBQVVDLElBQUksY0FDckJvRSxFQUFPbkIsWUFBYyxXQUVyQm1CLEVBQU9oQixpQkFBaUIsU0FBUyxLQUNILGFBQXZCZ0IsRUFBT25CLFlBQ05tQixFQUFPbkIsWUFBYyxhQUVyQm1CLEVBQU9uQixZQUFjLFVBQ3pCLElBR2VwRCxTQUFTSSxjQUFjLFlBQy9CQyxZQUFZa0UsRUFBTyxFRHFFMUIsR0FFdUJ2RSxTQUFTSSxjQUFjLHFCQUMvQitELFNBQVNwRSxJQUNwQkEsRUFBS3dELGlCQUFpQixhQUFhLFFBRWxDLElBRVQsRyIsInNvdXJjZXMiOlsid2VicGFjazovL2JhdHRsZXNoaXAvLi9zcmMvZGlzcGxheUJvYXJkLmpzIiwid2VicGFjazovL2JhdHRsZXNoaXAvLi9zcmMvdXBkYXRlQm9hcmQuanMiLCJ3ZWJwYWNrOi8vYmF0dGxlc2hpcC8uL3NyYy9jcmVhdGVTaGlwLmpzIiwid2VicGFjazovL2JhdHRsZXNoaXAvLi9zcmMvZ2FtZUJvYXJkLmpzIiwid2VicGFjazovL2JhdHRsZXNoaXAvLi9zcmMvY3JlYXRlUmFuZG9tU2hpcHMuanMiLCJ3ZWJwYWNrOi8vYmF0dGxlc2hpcC8uL3NyYy9jcmVhdGVQbGF5ZXIuanMiLCJ3ZWJwYWNrOi8vYmF0dGxlc2hpcC8uL3NyYy9lbmRHYW1lLmpzIiwid2VicGFjazovL2JhdHRsZXNoaXAvLi9zcmMvaW5kZXguanMiLCJ3ZWJwYWNrOi8vYmF0dGxlc2hpcC8uL3NyYy9hZGRBeGlzQnV0dG9uLmpzIl0sInNvdXJjZXNDb250ZW50IjpbImNvbnN0IGRpc3BsYXlCb2FyZCA9IChpZCwgcGxheWVyKSA9PiB7XG4gICAgY29uc3QgY2VsbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgIGNlbGwuY2xhc3NMaXN0LmFkZCgnY2VsbCcpO1xuXG4gICAgaWYocGxheWVyID09PSAncCcpIHtcbiAgICAgICAgY2VsbC5pZCA9IGAke3BsYXllcn0ke2lkfWA7XG5cbiAgICAgICAgY29uc3QgcGxheWVyQm9hcmQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcucGxheWVyQm9hcmQnKTtcbiAgICAgICAgcGxheWVyQm9hcmQuYXBwZW5kQ2hpbGQoY2VsbCk7XG4gICAgfSBlbHNlIGlmKHBsYXllciA9PT0gJ2FpJykge1xuICAgICAgICBjZWxsLmlkID0gYCR7cGxheWVyfSR7aWR9YDtcblxuICAgICAgICBjb25zdCBhaUJvYXJkID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmFpQm9hcmQnKTtcbiAgICAgICAgYWlCb2FyZC5hcHBlbmRDaGlsZChjZWxsKTtcbiAgICB9XG59XG5cbmV4cG9ydCBkZWZhdWx0IGRpc3BsYXlCb2FyZDsiLCJjb25zdCB1cGRhdGVCb2FyZCA9IChib2FyZCwgYm9hcmRJZCwgaXNBaUJvYXJkKSA9PiB7XG4gIGlmIChpc0FpQm9hcmQpIHtcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IDEwMDsgaSArPSAxKSB7XG4gICAgICBpZiAoYm9hcmRbaV0uc3RvcmVkU2hpcCAhPT0gZmFsc2UgJiYgYm9hcmRbaV0uYmVlbkhpdCA9PT0gdHJ1ZSkge1xuICAgICAgICBjb25zdCBjZWxsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoYCR7Ym9hcmRJZH0ke2l9YCk7XG4gICAgICAgIGNlbGwuc3R5bGUuYmFja2dyb3VuZENvbG9yID0gXCJyZ2IoMTMzLCAyNTUsIDE3OSlcIjtcbiAgICAgIH0gZWxzZSBpZiAoYm9hcmRbaV0uc3RvcmVkU2hpcCA9PT0gZmFsc2UgJiYgYm9hcmRbaV0uYmVlbkhpdCA9PT0gdHJ1ZSkge1xuICAgICAgICBjb25zdCBjZWxsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoYCR7Ym9hcmRJZH0ke2l9YCk7XG4gICAgICAgIGNlbGwuc3R5bGUuYmFja2dyb3VuZENvbG9yID0gXCJyZ2IoMjU1LCAxMzMsIDEzMylcIjtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGNvbnN0IGNlbGwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChgJHtib2FyZElkfSR7aX1gKTtcbiAgICAgICAgY2VsbC5zdHlsZS5iYWNrZ3JvdW5kQ29sb3IgPSBcIndoaXRlXCI7XG4gICAgICB9XG4gICAgfVxuICB9IGVsc2Uge1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgMTAwOyBpICs9IDEpIHtcbiAgICAgIGlmIChib2FyZFtpXS5zdG9yZWRTaGlwICE9PSBmYWxzZSAmJiBib2FyZFtpXS5iZWVuSGl0ID09PSBmYWxzZSkge1xuICAgICAgICBjb25zdCBjZWxsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoYCR7Ym9hcmRJZH0ke2l9YCk7XG4gICAgICAgIGNlbGwuc3R5bGUuYmFja2dyb3VuZENvbG9yID0gXCJyZ2IoNjgsIDY4LCA2OClcIjtcbiAgICAgIH0gZWxzZSBpZiAoYm9hcmRbaV0uc3RvcmVkU2hpcCAhPT0gZmFsc2UgJiYgYm9hcmRbaV0uYmVlbkhpdCA9PT0gdHJ1ZSkge1xuICAgICAgICBjb25zdCBjZWxsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoYCR7Ym9hcmRJZH0ke2l9YCk7XG4gICAgICAgIGNlbGwuc3R5bGUuYmFja2dyb3VuZENvbG9yID0gXCJyZ2IoMTMzLCAyNTUsIDE3OSlcIjtcbiAgICAgIH0gZWxzZSBpZiAoYm9hcmRbaV0uc3RvcmVkU2hpcCA9PT0gZmFsc2UgJiYgYm9hcmRbaV0uYmVlbkhpdCA9PT0gdHJ1ZSkge1xuICAgICAgICBjb25zdCBjZWxsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoYCR7Ym9hcmRJZH0ke2l9YCk7XG4gICAgICAgIGNlbGwuc3R5bGUuYmFja2dyb3VuZENvbG9yID0gXCJyZ2IoMjU1LCAxMzMsIDEzMylcIjtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGNvbnN0IGNlbGwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChgJHtib2FyZElkfSR7aX1gKTtcbiAgICAgICAgY2VsbC5zdHlsZS5iYWNrZ3JvdW5kQ29sb3IgPSBcIndoaXRlXCI7XG4gICAgICB9XG4gICAgfVxuICB9XG59O1xuXG5leHBvcnQgZGVmYXVsdCB1cGRhdGVCb2FyZDtcbiIsImNvbnN0IGNyZWF0ZVNoaXAgPSAobGVuZ3RoLCBpc1ZlcnRpY2FsKSA9PiB7XG4gIGNvbnN0IGhpdENvdW50ID0gMDtcbiAgY29uc3Qgc3VuayA9IGZhbHNlO1xuXG4gIGNvbnN0IGhpdCA9IChpbmRleCwgYm9hcmQpID0+IHtcbiAgICBjb25zdCBoaXRTaGlwID0gYm9hcmRbaW5kZXhdLnN0b3JlZFNoaXA7XG5cbiAgICBpZiAoaGl0U2hpcC5oaXRDb3VudCA8IGhpdFNoaXAubGVuZ3RoKSB7XG4gICAgICAgIGhpdFNoaXAuaGl0Q291bnQgKz0gMTtcbiAgICAgICAgaWYgKGhpdFNoaXAuaGl0Q291bnQgPT09IGhpdFNoaXAubGVuZ3RoKSB7XG4gICAgICAgICAgICBoaXRTaGlwLnN1bmsgPSB0cnVlO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIGhpdENvdW50O1xuICB9O1xuXG4gIHJldHVybiB7IGxlbmd0aCwgaGl0Q291bnQsIHN1bmssIGhpdCwgaXNWZXJ0aWNhbH07XG59O1xuXG5leHBvcnQgZGVmYXVsdCBjcmVhdGVTaGlwOyIsImltcG9ydCBkaXNwbGF5Qm9hcmQgZnJvbSBcIi4vZGlzcGxheUJvYXJkXCI7XG5pbXBvcnQgdXBkYXRlQm9hcmQgZnJvbSBcIi4vdXBkYXRlQm9hcmRcIjtcbmltcG9ydCBjcmVhdGVSYW5kb21TaGlwcyBmcm9tIFwiLi9jcmVhdGVSYW5kb21TaGlwc1wiO1xuXG5jb25zdCBnYW1lQm9hcmQgPSAoKSA9PiB7XG4gIGxldCBib2FyZCA9IFtdO1xuXG4gIGNvbnN0IGNyZWF0ZUJvYXJkID0gKHBsYXllcikgPT4ge1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgMTAwOyBpICs9IDEpIHtcbiAgICAgIGJvYXJkW2ldID0geyBzdG9yZWRTaGlwOiBmYWxzZSwgYmVlbkhpdDogZmFsc2UgfTtcbiAgICAgIGRpc3BsYXlCb2FyZChpLCBwbGF5ZXIpO1xuICAgIH1cbiAgfTtcblxuICBjb25zdCBwbGFjZVNoaXAgPSAoc2hpcCwgc3RhcnQpID0+IHtcbiAgICBpZiAoc2hpcC5pc1ZlcnRpY2FsKSB7XG4gICAgICBmb3IgKGxldCBpID0gc3RhcnQ7IGkgPCBzdGFydCArIHNoaXAubGVuZ3RoICogMTA7IGkgKz0gMTApIHtcbiAgICAgICAgYm9hcmRbaV0uc3RvcmVkU2hpcCA9IHNoaXA7XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIGZvciAobGV0IGkgPSBzdGFydDsgaSA8IHN0YXJ0ICsgc2hpcC5sZW5ndGg7IGkgKz0gMSkge1xuICAgICAgICBib2FyZFtpXS5zdG9yZWRTaGlwID0gc2hpcDtcbiAgICAgIH1cbiAgICB9XG4gIH07XG5cbiAgY29uc3QgcmFuZG9tU2hpcHMgPSAoYm9hcmRJZCwgaXNBaUJvYXJkKSA9PiB7XG4gICAgbGV0IGJvYXJkQ29weSA9IFsuLi5ib2FyZF07XG5cbiAgICBmb3IobGV0IGkgPSAwOyBpIDwgMTAwOyBpICs9IDEpIHtcbiAgICAgIGJvYXJkQ29weVtpXS5zdG9yZWRTaGlwID0gZmFsc2U7XG4gICAgfVxuXG4gICAgYm9hcmRDb3B5ID0gY3JlYXRlUmFuZG9tU2hpcHMoYm9hcmQsIDUpO1xuICAgIC8qXG4gICAgYm9hcmRDb3B5ID0gY3JlYXRlUmFuZG9tU2hpcHMoYm9hcmQsIDQpO1xuICAgIGJvYXJkQ29weSA9IGNyZWF0ZVJhbmRvbVNoaXBzKGJvYXJkLCAzKTtcbiAgICBib2FyZENvcHkgPSBjcmVhdGVSYW5kb21TaGlwcyhib2FyZCwgMyk7XG4gICAgYm9hcmRDb3B5ID0gY3JlYXRlUmFuZG9tU2hpcHMoYm9hcmQsIDIpO1xuICAgICovXG5cbiAgICB1cGRhdGVCb2FyZChib2FyZENvcHksIGJvYXJkSWQsIGlzQWlCb2FyZCk7XG4gICAgYm9hcmQgPSBib2FyZENvcHk7XG4gIH1cblxuICBjb25zdCByZWNlaXZlQXR0YWNrID0gKGNvcmRpbmF0ZXMsIGJvYXJkSWQsIGlzQWlCb2FyZCkgPT4ge1xuICAgIGlmIChib2FyZFtjb3JkaW5hdGVzXS5zdG9yZWRTaGlwICE9PSBmYWxzZSkge1xuICAgICAgYm9hcmRbY29yZGluYXRlc10uYmVlbkhpdCA9IHRydWU7XG4gICAgICBib2FyZFtjb3JkaW5hdGVzXS5zdG9yZWRTaGlwLmhpdChjb3JkaW5hdGVzLCBib2FyZCk7XG4gICAgICB1cGRhdGVCb2FyZChib2FyZCwgYm9hcmRJZCwgaXNBaUJvYXJkKTtcbiAgICB9IGVsc2Uge1xuICAgICAgYm9hcmRbY29yZGluYXRlc10uYmVlbkhpdCA9IHRydWU7XG4gICAgICB1cGRhdGVCb2FyZChib2FyZCwgYm9hcmRJZCwgaXNBaUJvYXJkKTtcbiAgICB9XG4gIH07XG5cbiAgY29uc3QgYWxsU2hpcHNTdW5rID0gKCkgPT4ge1xuICAgIGZvcihsZXQgaT0wOyBpIDwgMTAwOyBpICs9IDEpIHtcbiAgICAgIGlmKGJvYXJkW2ldLnN0b3JlZFNoaXAgIT09IGZhbHNlICYmIGJvYXJkW2ldLmJlZW5IaXQgPT09IGZhbHNlKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gdHJ1ZTtcbiAgfVxuXG4gIGNvbnN0IHJlc2V0Qm9hcmQgPSAoKSA9PiB7XG4gICAgZm9yKGxldCBpPTA7IGkgPCAxMDA7IGkgKz0gMSkge1xuICAgICAgYm9hcmRbaV0uc3RvcmVkU2hpcCA9IGZhbHNlO1xuICAgICAgYm9hcmRbaV0uYmVlbkhpdCA9IGZhbHNlO1xuICAgIH1cbiAgfVxuXG4gIHJldHVybiB7IGJvYXJkLCBjcmVhdGVCb2FyZCwgcGxhY2VTaGlwLCByZWNlaXZlQXR0YWNrLCBhbGxTaGlwc1N1bmssIHJhbmRvbVNoaXBzLCByZXNldEJvYXJkIH07XG59O1xuXG5leHBvcnQgZGVmYXVsdCBnYW1lQm9hcmQ7IiwiaW1wb3J0IGNyZWF0ZVNoaXAgZnJvbSBcIi4vY3JlYXRlU2hpcFwiO1xuXG5jb25zdCBjcmVhdGVSYW5kb21TaGlwcyA9IChib2FyZCwgc2hpcExlbmd0aCkgPT4ge1xuICAgIGNvbnN0IGF4aXNEZWNpZGVyID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogMikgKyAxO1xuICAgIGNvbnN0IGJvYXJkQ29weSA9IFsuLi5ib2FyZF07XG5cbiAgICBpZihheGlzRGVjaWRlciA9PT0gMSkge1xuICAgICAgICBsZXQgc3RhcnRpbmdDb2x1bW47XG4gICAgICAgIGxldCBzdGFydGluZ1JvdztcblxuICAgICAgICBkbyB7XG4gICAgICAgICAgICBzdGFydGluZ0NvbHVtbiA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqICgoMTAgLSBzaGlwTGVuZ3RoKSArIDEpKTtcbiAgICAgICAgICAgIHN0YXJ0aW5nUm93ID0gKE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDEwKSkgKiAxMDtcbiAgICAgICAgfSB3aGlsZSAoXG4gICAgICAgICAgICBib2FyZENvcHkuc2xpY2Uoc3RhcnRpbmdSb3cgKyBzdGFydGluZ0NvbHVtbiwgc3RhcnRpbmdSb3cgKyBzdGFydGluZ0NvbHVtbiArIHNoaXBMZW5ndGgpXG4gICAgICAgICAgICAuc29tZShjZWxsID0+IGNlbGwuc3RvcmVkU2hpcClcbiAgICAgICAgKVxuXG4gICAgICAgIGNvbnN0IG5ld1NoaXAgPSBjcmVhdGVTaGlwKHNoaXBMZW5ndGgsIGZhbHNlKTtcbiAgICAgICAgZm9yKGxldCBpID0gMDsgaSA8IHNoaXBMZW5ndGg7IGkgKz0gMSkge1xuICAgICAgICAgICAgYm9hcmRDb3B5W3N0YXJ0aW5nUm93ICsgc3RhcnRpbmdDb2x1bW4gKyBpXS5zdG9yZWRTaGlwID0gbmV3U2hpcDtcbiAgICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICAgIGxldCBzdGFydGluZ0NvbHVtbjtcbiAgICAgICAgbGV0IHN0YXJ0aW5nUm93O1xuICAgICAgICBsZXQgaGFzU3RvcmVkU2hpcFxuXG4gICAgICAgIGRvIHtcbiAgICAgICAgICAgIHN0YXJ0aW5nQ29sdW1uID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogMTApO1xuICAgICAgICAgICAgc3RhcnRpbmdSb3cgPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAoKDEwIC0gc2hpcExlbmd0aCkgKyAxKSkgKiAxMDtcbiAgICAgICAgXG4gICAgICAgICAgICBjb25zdCBzbGljZWRBcnJheSA9IFtdO1xuICAgICAgICAgICAgZm9yIChsZXQgaSA9IHN0YXJ0aW5nUm93ICsgc3RhcnRpbmdDb2x1bW47IGkgPCBzdGFydGluZ0NvbHVtbiArIHN0YXJ0aW5nUm93ICsgKHNoaXBMZW5ndGggKiAxMCk7IGkgKz0gMTApIHtcbiAgICAgICAgICAgICAgICBzbGljZWRBcnJheS5wdXNoKGJvYXJkQ29weVtpXSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICAgICAgaGFzU3RvcmVkU2hpcCA9IHNsaWNlZEFycmF5LnNvbWUoY2VsbCA9PiBjZWxsLnN0b3JlZFNoaXApO1xuICAgICAgICB9IHdoaWxlIChoYXNTdG9yZWRTaGlwKTtcblxuICAgICAgICBjb25zdCBuZXdTaGlwID0gY3JlYXRlU2hpcChzaGlwTGVuZ3RoLCB0cnVlKTtcbiAgICAgICAgZm9yKGxldCBpID0gMDsgaSA8IHNoaXBMZW5ndGggKiAxMDsgaSArPSAxMCkge1xuICAgICAgICAgICAgYm9hcmRDb3B5W3N0YXJ0aW5nUm93ICsgc3RhcnRpbmdDb2x1bW4gKyBpXS5zdG9yZWRTaGlwID0gbmV3U2hpcDtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiBib2FyZENvcHk7XG59XG5cbmV4cG9ydCBkZWZhdWx0IGNyZWF0ZVJhbmRvbVNoaXBzOyIsImNvbnN0IGNyZWF0ZVBsYXllciA9IChuYW1lLCBvcHBCb2FyZCkgPT4ge1xuXG4gICAgY29uc3QgYXR0YWNrID0gKGNvcmRpbmF0ZXMsIGJvYXJkSWQsIGlzQWlCb2FyZCkgPT4ge1xuICAgICAgICBvcHBCb2FyZC5yZWNlaXZlQXR0YWNrKGNvcmRpbmF0ZXMsIGJvYXJkSWQsIGlzQWlCb2FyZCk7XG4gICAgfVxuXG4gICAgY29uc3QgYWlBdHRhY2sgPSAoKSA9PiB7XG4gICAgICAgIGxldCByYW5kb21OdW1iZXI7XG4gICAgICAgIGRvIHtcbiAgICAgICAgICAgIHJhbmRvbU51bWJlciA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDk5KTtcbiAgICAgICAgfSB3aGlsZSAob3BwQm9hcmQuYm9hcmRbcmFuZG9tTnVtYmVyXS5iZWVuSGl0KTtcblxuICAgICAgICBvcHBCb2FyZC5yZWNlaXZlQXR0YWNrKHJhbmRvbU51bWJlciwgJ3AnLCBmYWxzZSk7XG4gICAgfVxuXG4gICAgcmV0dXJuIHsgbmFtZSwgb3BwQm9hcmQsIGF0dGFjaywgYWlBdHRhY2sgfVxufVxuXG5leHBvcnQgZGVmYXVsdCBjcmVhdGVQbGF5ZXI7IiwiaW1wb3J0IHVwZGF0ZUJvYXJkIGZyb20gXCIuL3VwZGF0ZUJvYXJkXCI7XG5cbmNvbnN0IGVuZEdhbWUgPSAocEJvYXJkLCBhaUJvYXJkLCBpc1BsYXllcldvbikgPT4ge1xuICAgIGlmKGlzUGxheWVyV29uKSB7XG4gICAgICAgIGNvbnN0IHdpbm5lclRleHQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcud2lubmVyVGV4dCcpO1xuICAgICAgICB3aW5uZXJUZXh0LnRleHRDb250ZW50ID0gJ1lvdSBXb24gRG8gWW91IFdhbnQgVG8gUGxheSBBZ2Fpbj8nO1xuICAgIH0gZWxzZSB7XG4gICAgICAgIGNvbnN0IHdpbm5lclRleHQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcud2lubmVyVGV4dCcpO1xuICAgICAgICB3aW5uZXJUZXh0LnRleHRDb250ZW50ID0gJ0FpIFdvbiBEbyBZb3UgV2FudCBUbyBQbGF5IEFnYWluJztcbiAgICB9XG5cbiAgICBjb25zdCB3aW5CYWNrZ3JvdW5kID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLndpbkJhY2tncm91bmQnKTtcbiAgICB3aW5CYWNrZ3JvdW5kLnN0eWxlLmRpc3BsYXkgPSAnZmxleCc7XG5cbiAgICBjb25zdCByZXN0YXJ0QnV0dG9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnJlc3RhcnRCdXR0b24nKTtcbiAgICByZXN0YXJ0QnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4ge1xuICAgICAgICBwQm9hcmQucmVzZXRCb2FyZCgpO1xuICAgICAgICB1cGRhdGVCb2FyZChwQm9hcmQuYm9hcmQsICdwJywgZmFsc2UpO1xuXG4gICAgICAgIGFpQm9hcmQucmVzZXRCb2FyZCgpO1xuICAgICAgICB1cGRhdGVCb2FyZChhaUJvYXJkLmJvYXJkLCAnYWknLCB0cnVlKTtcblxuICAgICAgICBjb25zdCBidXR0b25zRGl2ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmJ1dHRvbnMnKTtcbiAgICAgICAgYnV0dG9uc0Rpdi5zdHlsZS5kaXNwbGF5ID0gJ2ZsZXgnO1xuXG4gICAgICAgIGNvbnN0IHN0YXJ0QnV0dG9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnN0YXJ0QnV0dG9uJyk7XG4gICAgICAgIHN0YXJ0QnV0dG9uLnN0eWxlLmRpc3BsYXkgPSAnZmxleCc7XG5cbiAgICAgICAgY29uc3QgbWFudWFsQnV0dG9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLm1hbnVhbCcpO1xuICAgICAgICBtYW51YWxCdXR0b24uc3R5bGUuZGlzcGxheSA9ICdmbGV4JztcbiAgICAgICAgbWFudWFsQnV0dG9uLnN0eWxlLnJlbW92ZVByb3BlcnR5KCdtYXJnaW4tbGVmdCcpO1xuXG4gICAgICAgIGNvbnN0IHBsYWNlUmFuZG9tQnV0dG9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnJhbmRvbScpO1xuICAgICAgICBwbGFjZVJhbmRvbUJ1dHRvbi5zdHlsZS5kaXNwbGF5ID0gJ2ZsZXgnO1xuICAgICAgICBwbGFjZVJhbmRvbUJ1dHRvbi5zdHlsZS5yZW1vdmVQcm9wZXJ0eSgnbWFyZ2luLWxlZnQnKTtcblxuICAgICAgICB3aW5CYWNrZ3JvdW5kLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7XG4gICAgfSlcbn1cblxuZXhwb3J0IGRlZmF1bHQgZW5kR2FtZTsiLCJpbXBvcnQgZ2FtZUJvYXJkIGZyb20gXCIuL2dhbWVCb2FyZFwiO1xuaW1wb3J0IGNyZWF0ZVBsYXllciBmcm9tIFwiLi9jcmVhdGVQbGF5ZXJcIjtcbmltcG9ydCBlbmRHYW1lIGZyb20gXCIuL2VuZEdhbWVcIjtcbmltcG9ydCBhZGRBeGlzQnV0dG9uIGZyb20gXCIuL2FkZEF4aXNCdXR0b25cIjtcblxuXG5jb25zdCBwQm9hcmQgPSBnYW1lQm9hcmQoKTtcbnBCb2FyZC5jcmVhdGVCb2FyZCgncCcpO1xuY29uc3QgYWlCb2FyZCA9IGdhbWVCb2FyZCgpO1xuYWlCb2FyZC5jcmVhdGVCb2FyZCgnYWknKTtcblxuY29uc3QgcGxheWVyID0gY3JlYXRlUGxheWVyKCdwbGF5ZXInLCBhaUJvYXJkKTtcbmNvbnN0IGFpID0gY3JlYXRlUGxheWVyKCdhaScsIHBCb2FyZCk7XG5cbmNvbnN0IHBsYWNlUmFuZG9tQnV0dG9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnJhbmRvbScpO1xuY29uc3QgcGxhY2VNYW51YWxseUJ1dHRvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5tYW51YWwnKTtcblxucGxhY2VSYW5kb21CdXR0b24uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7XG4gICAgcGxhY2VNYW51YWxseUJ1dHRvbi5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnO1xuXG4gICAgcGxhY2VSYW5kb21CdXR0b24uc3R5bGUubWFyZ2luTGVmdCA9ICcxMTVweCc7XG5cbiAgICBwQm9hcmQucmFuZG9tU2hpcHMoJ3AnLCBmYWxzZSk7XG59KVxuXG5jb25zdCBoYW5kbGVDbGljayA9IChldmVudCkgPT4ge1xuICAgIGNvbnN0IGluZGV4ID0gTnVtYmVyKGV2ZW50LnRhcmdldC5pZC5zbGljZSgyKSlcbiAgICBcbiAgICBwbGF5ZXIuYXR0YWNrKGluZGV4LCAnYWknLCB0cnVlKTtcbiAgICBjb25zdCBpc1BsYXllcldvbiA9IGFpQm9hcmQuYWxsU2hpcHNTdW5rKCk7XG4gICAgaWYoaXNQbGF5ZXJXb24pIHtcbiAgICAgICAgZW5kR2FtZShwQm9hcmQsIGFpQm9hcmQsIHRydWUpO1xuXG4gICAgICAgIGNvbnN0IGFsbENlbGxzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnZGl2LmNlbGxbaWRePVwiYWlcIl0nKTtcbiAgICAgICAgYWxsQ2VsbHMuZm9yRWFjaCgoY2VsbCkgPT4ge1xuICAgICAgICAgICAgY2VsbC5yZW1vdmVFdmVudExpc3RlbmVyKCdjbGljaycsIGhhbmRsZUNsaWNrKTtcbiAgICAgICAgfSlcbiAgICB9XG5cbiAgICBhaS5haUF0dGFjaygpO1xuICAgIGNvbnN0IGlzQWlXb24gPSBwQm9hcmQuYWxsU2hpcHNTdW5rKCk7XG4gICAgaWYoaXNBaVdvbikge1xuICAgICAgICBlbmRHYW1lKHBCb2FyZCwgYWlCb2FyZCwgZmFsc2UpO1xuXG4gICAgICAgIGNvbnN0IGFsbENlbGxzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnZGl2LmNlbGxbaWRePVwiYWlcIl0nKTtcbiAgICAgICAgYWxsQ2VsbHMuZm9yRWFjaCgoY2VsbCkgPT4ge1xuICAgICAgICAgICAgY2VsbC5yZW1vdmVFdmVudExpc3RlbmVyKCdjbGljaycsIGhhbmRsZUNsaWNrKTtcbiAgICAgICAgfSlcbiAgICB9XG59XG5cbmNvbnN0IHN0YXJ0QnV0dG9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnN0YXJ0QnV0dG9uJyk7XG5zdGFydEJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHtcbiAgICBsZXQgc2hpcENlbGxzID0gMDtcbiAgICBmb3IobGV0IGkgPSAwOyBpIDwgMTAwOyBpICs9IDEpIHtcbiAgICAgICAgaWYocEJvYXJkLmJvYXJkW2ldLnN0b3JlZFNoaXAgIT09IGZhbHNlKSB7XG4gICAgICAgICAgICBzaGlwQ2VsbHMgKz0gMTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qXG4gICAgICAgIGNoYW5nZSB0aGUgbnVtYmVyIGJhY2sgdG8gMTdcbiAgICAqL1xuICAgIGlmKHNoaXBDZWxscyA9PT0gNSkge1xuICAgICAgICBjb25zdCBidXR0b25zRGl2ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmJ1dHRvbnMnKTtcbiAgICAgICAgYnV0dG9uc0Rpdi5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnO1xuICAgICAgICBzdGFydEJ1dHRvbi5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnO1xuXG5cbiAgICAgICAgYWlCb2FyZC5yYW5kb21TaGlwcygnYWknLCB0cnVlKTtcblxuICAgICAgICBjb25zdCBhbGxDZWxscyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJ2Rpdi5jZWxsW2lkXj1cImFpXCJdJyk7XG4gICAgICAgIGFsbENlbGxzLmZvckVhY2goKGNlbGwpID0+IHtcbiAgICAgICAgICAgIGNlbGwuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBoYW5kbGVDbGljayk7XG4gICAgICAgIH0pXG4gICAgfVxufSlcblxucGxhY2VNYW51YWxseUJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHtcbiAgICBwbGFjZVJhbmRvbUJ1dHRvbi5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnO1xuXG4gICAgY29uc3QgYXhpc0J1dHRvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5heGlzQnV0dG9uJyk7XG4gICAgaWYoYXhpc0J1dHRvbiA9PT0gbnVsbCkge1xuICAgICAgICBhZGRBeGlzQnV0dG9uKCk7XG5cbiAgICAgICAgY29uc3QgYWxsUGxheWVyQ2VsbHMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCdkaXYuY2VsbFtpZF49XCJwXCJdJyk7XG4gICAgICAgIGFsbFBsYXllckNlbGxzLmZvckVhY2goKGNlbGwpID0+IHtcbiAgICAgICAgICAgIGNlbGwuYWRkRXZlbnRMaXN0ZW5lcignbW91c2VvdmVyJywgKCkgPT4ge1xuICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgfSlcbiAgICAgICAgfSlcbiAgICB9XG59KSIsImNvbnN0IGFkZEF4aXNCdXR0b24gPSAoKSA9PiB7XG4gICAgY29uc3QgYnV0dG9uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYnV0dG9uJyk7XG4gICAgYnV0dG9uLmNsYXNzTGlzdC5hZGQoJ2F4aXNCdXR0b24nKTtcbiAgICBidXR0b24udGV4dENvbnRlbnQgPSAnVmVydGljYWwnO1xuXG4gICAgYnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4ge1xuICAgICAgICBpZihidXR0b24udGV4dENvbnRlbnQgPT09ICdWZXJ0aWNhbCcpIHtcbiAgICAgICAgICAgIGJ1dHRvbi50ZXh0Q29udGVudCA9ICdIb3Jpem9udGFsJztcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGJ1dHRvbi50ZXh0Q29udGVudCA9ICdWZXJ0aWNhbCc7XG4gICAgICAgIH1cbiAgICB9KVxuXG4gICAgY29uc3QgYnV0dG9uc0RpdiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5idXR0b25zJyk7XG4gICAgYnV0dG9uc0Rpdi5hcHBlbmRDaGlsZChidXR0b24pO1xufVxuXG5leHBvcnQgZGVmYXVsdCBhZGRBeGlzQnV0dG9uOyJdLCJuYW1lcyI6WyJpZCIsInBsYXllciIsImNlbGwiLCJkb2N1bWVudCIsImNyZWF0ZUVsZW1lbnQiLCJjbGFzc0xpc3QiLCJhZGQiLCJxdWVyeVNlbGVjdG9yIiwiYXBwZW5kQ2hpbGQiLCJib2FyZCIsImJvYXJkSWQiLCJpc0FpQm9hcmQiLCJpIiwic3RvcmVkU2hpcCIsImJlZW5IaXQiLCJnZXRFbGVtZW50QnlJZCIsInN0eWxlIiwiYmFja2dyb3VuZENvbG9yIiwibGVuZ3RoIiwiaXNWZXJ0aWNhbCIsImhpdENvdW50Iiwic3VuayIsImhpdCIsImluZGV4IiwiaGl0U2hpcCIsImNyZWF0ZUJvYXJkIiwicGxhY2VTaGlwIiwic2hpcCIsInN0YXJ0IiwicmVjZWl2ZUF0dGFjayIsImNvcmRpbmF0ZXMiLCJhbGxTaGlwc1N1bmsiLCJyYW5kb21TaGlwcyIsImJvYXJkQ29weSIsInNoaXBMZW5ndGgiLCJNYXRoIiwiZmxvb3IiLCJyYW5kb20iLCJzdGFydGluZ0NvbHVtbiIsInN0YXJ0aW5nUm93Iiwic2xpY2UiLCJzb21lIiwibmV3U2hpcCIsImhhc1N0b3JlZFNoaXAiLCJzbGljZWRBcnJheSIsInB1c2giLCJyZXNldEJvYXJkIiwibmFtZSIsIm9wcEJvYXJkIiwiYXR0YWNrIiwiYWlBdHRhY2siLCJyYW5kb21OdW1iZXIiLCJwQm9hcmQiLCJhaUJvYXJkIiwiaXNQbGF5ZXJXb24iLCJ0ZXh0Q29udGVudCIsIndpbkJhY2tncm91bmQiLCJkaXNwbGF5IiwiYWRkRXZlbnRMaXN0ZW5lciIsIm1hbnVhbEJ1dHRvbiIsInJlbW92ZVByb3BlcnR5IiwicGxhY2VSYW5kb21CdXR0b24iLCJhaSIsInBsYWNlTWFudWFsbHlCdXR0b24iLCJtYXJnaW5MZWZ0IiwiaGFuZGxlQ2xpY2siLCJldmVudCIsIk51bWJlciIsInRhcmdldCIsInF1ZXJ5U2VsZWN0b3JBbGwiLCJmb3JFYWNoIiwicmVtb3ZlRXZlbnRMaXN0ZW5lciIsInN0YXJ0QnV0dG9uIiwic2hpcENlbGxzIiwiYnV0dG9uIl0sInNvdXJjZVJvb3QiOiIifQ==